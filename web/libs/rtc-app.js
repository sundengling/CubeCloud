$(document).ready(function(a){$("#default_btn_videocall").removeAttr("disabled");$("#default_btn_voicecall").removeAttr("disabled","disabled");$("#default_btn_terminate").attr("disabled","disabled");$("#default_btn_mute").attr("disabled","disabled");$("#conference_btn_call").removeAttr("disabled");$("#conference_btn_terminate").attr("disabled","disabled");$("#conference_btn_mute").attr("disabled","disabled");$("#conference_btn_camera").attr("disabled","disabled");$("#conference_btn_microphone").attr("disabled","disabled");$("#conference_btn_volume_down").attr("disabled","disabled");$("#conference_btn_volume_up").attr("disabled","disabled");$("#conference_btn_whiteboard").attr("disabled","disabled");$("#conference_btn_messager").attr("disabled","disabled");$("#conference_btn_lock").attr("disabled","disabled");$("#conference_btn_invite").attr("disabled","disabled");if(window.cube.startup(window._debug)){if(window.peer){window.cube.loadSignaling("local_video","remote_video","remove_audio")}else{window.cube.loadConference("local_video","remote_video","remote_audio")}window.cube.setRegistrationListener(new SimpleRegistrationListener());window.cube.setCallListener(new SimpleCallListener())}else{alert("Cube Engine 启动失败！")}$(window).resize(function(b){app.resize()});app.init();$("#operation").tooltip({selector:'[data-toggle="tooltip"]',container:"body"});$("#conference_operation").tooltip({selector:'[data-toggle="tooltip"]',container:"body"});window.app.resize()});(function(b){var j=$("#remote_video");var c=$("#local_video");b.peer=false;b._debug=null;var f=window.utils.getUrlParams();var a=f.debug;if(a!==undefined){b._debug=a}var g=f.cn;var k=f.cgn;if(k===undefined){k=f.pcn;b.peer=true}var e=f.csid;if(e===undefined){e=null}var d=f.token;var i=null;var h=0;b.app={collapsedLock:false,collapsed:true,full:false,pushpined:false,init:function(){this.bindMediaController();if(null!=e){this.loadChannel()}else{window.cube.autoAnswer(true);window.cube.registerAccount(g,"123456")}},resize:function(){var l=this;if(h>0){clearTimeout(h)}h=setTimeout(function(){clearTimeout(h);h=0;var m=window.innerWidth;var n=100;if(l.full){n=window.innerHeight;$("#lvc").width(160);$("#lvc").height(120);$("#lvc")[0].style.left=(m-160-20)+"px";$("#lvc")[0].style.top=(n-120-20)+"px"}else{n=window.innerHeight-$("#operation").height()-2;if(null==e){n=182;$("#lvc").width(m);$("#lvc").height(n);$("#lvc")[0].style.top=185+"px";$("#lvc")[0].style.left=0+"px";$("#operation")[0].style.top="370px"}else{$("#lvc").width(parseInt(m*0.5));$("#lvc").height(parseInt(n*0.5));$("#lvc")[0].style.top=0+"px";$("#lvc")[0].style.left=0+"px";$("#operation")[0].style.top="186px"}}$("#rvc").width(m);$("#rvc").height(n)},60)},bindMediaController:function(){var l=this;$("#default_btn_videocall").click(function(m){l.makeCall(true)});$("#default_btn_voicecall").click(function(m){l.makeCall(false)});$("#default_btn_terminate").click(function(m){l.terminateCall()});$("#default_btn_mute").click(function(m){l.toggleVoice()});$("#conference_btn_call").click(function(m){l.makeCall(true)});$("#conference_btn_terminate").click(function(m){l.terminateCall()});$("#conference_btn_mute").click(function(m){l.toggleVoice()});$("#conference_btn_pushpin").click(function(m){if(!l.pushpined){l.pushpined=true;l.collapsed=true;l.toggleConferenceController();$("#btn_conference_controller").hide()}else{l.pushpined=false;l.collapsed=false;l.toggleConferenceController();$("#btn_conference_controller").show()}});$("#btn_conference_controller").mouseover(function(m){l.toggleConferenceController()})},loadChannel:function(){var l=this;$.get("channel",{token:d,csid:e},function(n,o,m){if(n.state==200){i=n.data;$("#coop_display_name").text(i.displayName);l.updateMemberPanels()}else{}},"json")},makeCall:function(l){if(g===undefined){return}if(window.peer){window.cube.makeCall(k,l)}else{window.cube.registerAccount(g,"123456")}},terminateCall:function(){window.cube.terminateCall()},updateMemberPanels:function(){var n=i.members.length;if(n<=1){$(".user-container")[0].style.visibility="hidden";return}for(var l=0;l<n;++l){var o=i.members[l];var m=['<div class="col-sm-1 item-col">','<div class="panel panel-default">','<div class="panel-body">','<div class="btn-group">','<button type="button" class="btn btn-default" data-toggle="tooltip" data-placement="bottom" title="视频">','<span class="glyphicon glyphicon-facetime-video" aria-hidden="true"></span>',"</button>",'<button type="button" class="btn btn-default" data-toggle="tooltip" data-placement="bottom" title="静音">','<span class="glyphicon glyphicon-volume-off" aria-hidden="true"></span>',"</button>","</div>",'<div class="info">','<div class="name">',o,"</div>","</div>","</div>","</div>","</div>"].join("");$(".user-container .items").width((l+1)*200);$("#panel_can").append(m)}$(".user-container")[0].style.visibility="visible"},toggleVoiceHandler:function(){},toggleConferenceController:function(){if(this.collapsedLock){return}this.collapsedLock=true;var l=0;if(this.collapsed){this.collapsed=false;l=0;$("#btn_conference_controller").removeClass("btn-collapse-down").addClass("btn-collapse-up")}else{this.collapsed=true;l=-34;$("#btn_conference_controller").removeClass("btn-collapse-up").addClass("btn-collapse-down")}var m=this;$(".conference-media-control").animate({top:l},200,function(){m.collapsedLock=false})}};b.onLayoutChanged=function(l){if(l=="default"){b.app.collapsed=true;b.app.full=false;$(".conference-media-control").find(".btn-collapse-up").removeClass("btn-collapse-up").addClass("btn-collapse-down");$(".conference-media-control").hide();$(".user-container").hide();$(".info-layer").hide();$("#operation").show()}else{if(l=="conference"){b.app.full=true;var m=$(".conference-media-control");m.show();m[0].style.left=parseInt((window.innerWidth-m.width())*0.5)+"px";m[0].style.top=-34+"px";$(".user-container").show();$(".info-layer").show();$("#operation").hide()}}};b.SimpleRegistrationListener=Class(CubeRegistrationListener,{ctor:function(){},onRegistrationProgress:function(l){},onRegistrationOk:function(l){if(window.peer){}else{window.cube.makeCall(k,true)}},onRegistrationCleared:function(l){},onRegistrationFailed:function(l){}});b.SimpleCallListener=Class(CubeCallListener,{ctor:function(){},onNewCall:function(n,m,l){$("#default_btn_videocall").attr("disabled","disabled");$("#default_btn_voicecall").attr("disabled","disabled");$("#default_btn_terminate").removeAttr("disabled");$("#default_btn_mute").removeAttr("disabled");$("#conference_btn_call").attr("disabled","disabled");$("#conference_btn_terminate").removeAttr("disabled");$("#conference_btn_mute").removeAttr("disabled");$("#default_btn_videocall").tooltip("hide");$("#default_btn_voicecall").tooltip("hide");$("#conference_btn_call").tooltip("hide")},onInProgress:function(l){},onCallRinging:function(l){},onCallConnected:function(l){},onCallEnded:function(l){$("#default_btn_videocall").removeAttr("disabled");$("#default_btn_voicecall").removeAttr("disabled");$("#default_btn_terminate").attr("disabled","disabled");$("#default_btn_mute").attr("disabled","disabled");$("#conference_btn_call").removeAttr("disabled");$("#conference_btn_terminate").attr("disabled","disabled");$("#conference_btn_mute").attr("disabled","disabled");$("#default_btn_terminate").tooltip("hide");$("#conference_btn_terminate").tooltip("hide");if(window.peer){}else{window.cube.unregisterAccount()}},onCallFailed:function(m,l){if(window.peer){}else{window.cube.unregisterAccount()}}})})(window);