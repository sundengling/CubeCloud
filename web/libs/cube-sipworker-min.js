!function(b){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=b()}else{if("function"==typeof define&&define.amd){define([],b)}else{var a;a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,a.JsSIP=b()}}}(function(){var b;return function a(h,j,g){function f(l,m){if(!j[l]){if(!h[l]){var k="function"==typeof require&&require;if(!m&&k){return k(l,!0)}if(c){return c(l,!0)}var e=new Error("Cannot find module '"+l+"'");throw e.code="MODULE_NOT_FOUND",e}var n=j[l]={exports:{}};h[l][0].call(n.exports,function(i){var o=h[l][1][i];return f(o?o:i)},n,n.exports,a,h,j,g)}return j[l].exports}for(var c="function"==typeof require&&require,d=0;d<g.length;d++){f(g[d])}return f}({1:[function(g,c,h){var f=g("../package.json"),d={USER_AGENT:f.title+" "+f.version,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",MISSING_SDP:"Missing SDP",AUTHENTICATION_ERROR:"Authentication Error",BYE:"Terminated",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",DIALOG_ERROR:"Dialog Error",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"JsSIP Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},ALLOWED_METHODS:"INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS",ACCEPTED_BODY_TYPES:"application/sdp, application/dtmf-relay",MAX_FORWARDS:69,SESSION_EXPIRES:90,MIN_SESSION_EXPIRES:60};c.exports=d},{"../package.json":46}],2:[function(j,p,f){function c(s,i,v,l){var u;return this.uac_pending_reply=!1,this.uas_pending_reply=!1,i.hasHeader("contact")?(l=i instanceof h.IncomingResponse?i.status_code<200?q.STATUS_EARLY:q.STATUS_CONFIRMED:l||q.STATUS_CONFIRMED,u=i.parseHeader("contact"),"UAS"===v?(this.id={call_id:i.call_id,local_tag:i.to_tag,remote_tag:i.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=l,this.remote_seqnum=i.cseq,this.local_uri=i.parseHeader("to").uri,this.remote_uri=i.parseHeader("from").uri,this.remote_target=u.uri,this.route_set=i.getHeaders("record-route")):"UAC"===v&&(this.id={call_id:i.call_id,local_tag:i.from_tag,remote_tag:i.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=l,this.local_seqnum=i.cseq,this.local_uri=i.parseHeader("from").uri,this.remote_uri=i.parseHeader("to").uri,this.remote_target=u.uri,this.route_set=i.getHeaders("record-route").reverse()),this.owner=s,s.ua.dialogs[this.id.toString()]=this,void g("new "+v+" dialog created with status "+(this.state===q.STATUS_EARLY?"EARLY":"CONFIRMED"))):{error:"unable to create a Dialog without Contact header field"}}p.exports=c;var q={STATUS_EARLY:1,STATUS_CONFIRMED:2};c.C=q;var g=j("debug")("JsSIP:Dialog"),h=j("./SIPMessage"),d=j("./Constants"),m=j("./Transactions"),k=j("./Dialog/RequestSender");c.prototype={update:function(l,i){this.state=q.STATUS_CONFIRMED,g("dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===i&&(this.route_set=l.getHeaders("record-route").reverse())},terminate:function(){g("dialog "+this.id.toString()+" deleted"),delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(u,i,v){var o,l;return i=i&&i.slice()||[],this.local_seqnum||(this.local_seqnum=Math.floor(10000*Math.random())),o=u===d.CANCEL||u===d.ACK?this.local_seqnum:this.local_seqnum+=1,l=new h.OutgoingRequest(u,this.remote_target,this.owner.ua,{cseq:o,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},i,v),l.dialog=this,l},checkInDialogRequest:function(o){var i=this;if(this.remote_seqnum){if(o.cseq<this.remote_seqnum){return o.method!==d.ACK&&o.reply(500),!1}o.cseq>this.remote_seqnum&&(this.remote_seqnum=o.cseq)}else{this.remote_seqnum=o.cseq}if(o.method===d.INVITE||o.method===d.UPDATE&&o.body){if(this.uac_pending_reply===!0){o.reply(491)}else{if(this.uas_pending_reply===!0){var s=(10*Math.random()|0)+1;return o.reply(500,null,["Retry-After:"+s]),!1}this.uas_pending_reply=!0,o.server_transaction.on("stateChanged",function l(){(this.state===m.C.STATUS_ACCEPTED||this.state===m.C.STATUS_COMPLETED||this.state===m.C.STATUS_TERMINATED)&&(o.server_transaction.removeListener("stateChanged",l),i.uas_pending_reply=!1)})}o.hasHeader("contact")&&o.server_transaction.on("stateChanged",function(){this.state===m.C.STATUS_ACCEPTED&&(i.remote_target=o.parseHeader("contact").uri)})}else{o.method===d.NOTIFY&&o.hasHeader("contact")&&o.server_transaction.on("stateChanged",function(){this.state===m.C.STATUS_COMPLETED&&(i.remote_target=o.parseHeader("contact").uri)})}return !0},sendRequest:function(y,v,z){z=z||{};var x=z.extraHeaders&&z.extraHeaders.slice()||[],w=z.body||null,o=this.createRequest(v,x,w),u=new k(this,y,o);u.send()},receiveRequest:function(i){this.checkInDialogRequest(i)&&this.owner.receiveRequest(i)}}},{"./Constants":1,"./Dialog/RequestSender":3,"./SIPMessage":16,"./Transactions":18,debug:29}],3:[function(j,f,m){function h(l,i,o){this.dialog=l,this.applicant=i,this.request=o,this.reattempt=!1,this.reattemptTimer=null}f.exports=h;var g=j("../Constants"),c=j("../Transactions"),d=j("../RTCSession"),k=j("../RequestSender");h.prototype={send:function(){var l=this,i=new k(this,this.dialog.owner.ua);i.send(),(this.request.method===g.INVITE||this.request.method===g.UPDATE&&this.request.body)&&i.clientTransaction.state!==c.C.STATUS_TERMINATED&&(this.dialog.uac_pending_reply=!0,i.clientTransaction.on("stateChanged",function o(){(this.state===c.C.STATUS_ACCEPTED||this.state===c.C.STATUS_COMPLETED||this.state===c.C.STATUS_TERMINATED)&&(i.clientTransaction.removeListener("stateChanged",o),l.dialog.uac_pending_reply=!1)}))},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(l){var i=this;408===l.status_code||481===l.status_code?this.applicant.onDialogError(l):l.method===g.INVITE&&491===l.status_code?this.reattempt?this.applicant.receiveResponse(l):(this.request.cseq.value=this.dialog.local_seqnum+=1,this.reattemptTimer=setTimeout(function(){i.applicant.owner.status!==d.C.STATUS_TERMINATED&&(i.reattempt=!0,i.request_sender.send())},1000)):this.applicant.receiveResponse(l)}}},{"../Constants":1,"../RTCSession":11,"../RequestSender":15,"../Transactions":18}],4:[function(h,d,i){function g(j){this.username=j.configuration.authorization_user,this.password=j.configuration.password,this.cnonce=null,this.nc=0,this.ncHex="00000000",this.response=null}d.exports=g;var f=h("debug")("JsSIP:DigestAuthentication"),c=h("./Utils");g.prototype.authenticate=function(k,j){if(this.algorithm=j.algorithm,this.realm=j.realm,this.nonce=j.nonce,this.opaque=j.opaque,this.stale=j.stale,this.algorithm){if("MD5"!==this.algorithm){return f('challenge with Digest algorithm different than "MD5", authentication aborted'),!1}}else{this.algorithm="MD5"}if(!this.realm){return f("challenge without Digest realm, authentication aborted"),!1}if(!this.nonce){return f("challenge without Digest nonce, authentication aborted"),!1}if(j.qop){if(j.qop.indexOf("auth")>-1){this.qop="auth"}else{if(!(j.qop.indexOf("auth-int")>-1)){return f('challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1}this.qop="auth-int"}}else{this.qop=null}return this.method=k.method,this.uri=k.ruri,this.cnonce=c.createRandomToken(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(),!0},g.prototype.calculateResponse=function(){var k,j;k=c.calculateMD5(this.username+":"+this.realm+":"+this.password),"auth"===this.qop?(j=c.calculateMD5(this.method+":"+this.uri),this.response=c.calculateMD5(k+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+j)):"auth-int"===this.qop?(j=c.calculateMD5(this.method+":"+this.uri+":"+c.calculateMD5(this.body?this.body:"")),this.response=c.calculateMD5(k+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+j)):null===this.qop&&(j=c.calculateMD5(this.method+":"+this.uri),this.response=c.calculateMD5(k+":"+this.nonce+":"+j))},g.prototype.toString=function(){var j=[];if(!this.response){throw new Error("response field does not exist, cannot generate Authorization header")}return j.push("algorithm="+this.algorithm),j.push('username="'+this.username+'"'),j.push('realm="'+this.realm+'"'),j.push('nonce="'+this.nonce+'"'),j.push('uri="'+this.uri+'"'),j.push('response="'+this.response+'"'),this.opaque&&j.push('opaque="'+this.opaque+'"'),this.qop&&(j.push("qop="+this.qop),j.push('cnonce="'+this.cnonce+'"'),j.push("nc="+this.ncHex)),"Digest "+j.join(", ")},g.prototype.updateNcHex=function(){var j=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-j.length)+j}},{"./Utils":22,debug:29}],5:[function(f,c,g){var d={ConfigurationError:function(){var h=function(j,i){this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=j,this.value=i,this.message=this.value?"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return h.prototype=new Error,h}(),InvalidStateError:function(){var h=function(i){this.code=2,this.name="INVALID_STATE_ERROR",this.status=i,this.message="Invalid status: "+i};return h.prototype=new Error,h}(),NotSupportedError:function(){var h=function(i){this.code=3,this.name="NOT_SUPPORTED_ERROR",this.message=i};return h.prototype=new Error,h}(),NotReadyError:function(){var h=function(i){this.code=4,this.name="NOT_READY_ERROR",this.message=i};return h.prototype=new Error,h}()};c.exports=d},{}],6:[function(d,c,f){c.exports=function(){function e(h){return'"'+h.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var g={parse:function(cq,ck){function cj(h){cv>dY||(dY>cv&&(cv=dY,aN=[]),aN.push(h))}function cw(){var h;return"\r\n"===cq.substr(dY,2)?(h="\r\n",dY+=2):(h=null,0===aJ&&cj('"\\r\\n"')),h}function cB(){var h;return/^[0-9]/.test(cq.charAt(dY))?(h=cq.charAt(dY),dY++):(h=null,0===aJ&&cj("[0-9]")),h}function cp(){var h;return/^[a-zA-Z]/.test(cq.charAt(dY))?(h=cq.charAt(dY),dY++):(h=null,0===aJ&&cj("[a-zA-Z]")),h}function cg(){var h;return/^[0-9a-fA-F]/.test(cq.charAt(dY))?(h=cq.charAt(dY),dY++):(h=null,0===aJ&&cj("[0-9a-fA-F]")),h}function cK(){var h;return h=cH(),null===h&&(h=co()),h}function cI(){var h;return/^[\0-\xFF]/.test(cq.charAt(dY))?(h=cq.charAt(dY),dY++):(h=null,0===aJ&&cj("[\\0-\\xFF]")),h}function cD(){var h;return/^["]/.test(cq.charAt(dY))?(h=cq.charAt(dY),dY++):(h=null,0===aJ&&cj('["]')),h}function cH(){var h;return 32===cq.charCodeAt(dY)?(h=" ",dY++):(h=null,0===aJ&&cj('" "')),h}function co(){var h;return 9===cq.charCodeAt(dY)?(h="	",dY++):(h=null,0===aJ&&cj('"\\t"')),h}function cF(){var h;return/^[a-zA-Z0-9]/.test(cq.charAt(dY))?(h=cq.charAt(dY),dY++):(h=null,0===aJ&&cj("[a-zA-Z0-9]")),h}function cu(){var h;return 59===cq.charCodeAt(dY)?(h=";",dY++):(h=null,0===aJ&&cj('";"')),null===h&&(47===cq.charCodeAt(dY)?(h="/",dY++):(h=null,0===aJ&&cj('"/"')),null===h&&(63===cq.charCodeAt(dY)?(h="?",dY++):(h=null,0===aJ&&cj('"?"')),null===h&&(58===cq.charCodeAt(dY)?(h=":",dY++):(h=null,0===aJ&&cj('":"')),null===h&&(64===cq.charCodeAt(dY)?(h="@",dY++):(h=null,0===aJ&&cj('"@"')),null===h&&(38===cq.charCodeAt(dY)?(h="&",dY++):(h=null,0===aJ&&cj('"&"')),null===h&&(61===cq.charCodeAt(dY)?(h="=",dY++):(h=null,0===aJ&&cj('"="')),null===h&&(43===cq.charCodeAt(dY)?(h="+",dY++):(h=null,0===aJ&&cj('"+"')),null===h&&(36===cq.charCodeAt(dY)?(h="$",dY++):(h=null,0===aJ&&cj('"$"')),null===h&&(44===cq.charCodeAt(dY)?(h=",",dY++):(h=null,0===aJ&&cj('","'))))))))))),h}function cE(){var h;return h=cF(),null===h&&(h=cY()),h}function cY(){var h;return 45===cq.charCodeAt(dY)?(h="-",dY++):(h=null,0===aJ&&cj('"-"')),null===h&&(95===cq.charCodeAt(dY)?(h="_",dY++):(h=null,0===aJ&&cj('"_"')),null===h&&(46===cq.charCodeAt(dY)?(h=".",dY++):(h=null,0===aJ&&cj('"."')),null===h&&(33===cq.charCodeAt(dY)?(h="!",dY++):(h=null,0===aJ&&cj('"!"')),null===h&&(126===cq.charCodeAt(dY)?(h="~",dY++):(h=null,0===aJ&&cj('"~"')),null===h&&(42===cq.charCodeAt(dY)?(h="*",dY++):(h=null,0===aJ&&cj('"*"')),null===h&&(39===cq.charCodeAt(dY)?(h="'",dY++):(h=null,0===aJ&&cj('"\'"')),null===h&&(40===cq.charCodeAt(dY)?(h="(",dY++):(h=null,0===aJ&&cj('"("')),null===h&&(41===cq.charCodeAt(dY)?(h=")",dY++):(h=null,0===aJ&&cj('")"')))))))))),h}function cN(){var n,k,m,h,j;return h=dY,j=dY,37===cq.charCodeAt(dY)?(n="%",dY++):(n=null,0===aJ&&cj('"%"')),null!==n?(k=cg(),null!==k?(m=cg(),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(l,i){return i.join("")}(h,n)),null===n&&(dY=h),n}function cf(){var m,j,o,l,k,h;for(l=dY,k=dY,h=dY,m=[],j=cK();null!==j;){m.push(j),j=cK()}if(null!==m?(j=cw(),null!==j?m=[m,j]:(m=null,dY=h)):(m=null,dY=h),m=null!==m?m:"",null!==m){if(o=cK(),null!==o){for(j=[];null!==o;){j.push(o),o=cK()}}else{j=null}null!==j?m=[m,j]:(m=null,dY=k)}else{m=null,dY=k}return null!==m&&(m=function(i){return" "}(l)),null===m&&(dY=l),m}function dv(){var h;return h=cf(),h=null!==h?h:""}function c0(){var n,k,m,h,j;for(h=dY,j=dY,n=[],k=cH(),null===k&&(k=co());null!==k;){n.push(k),k=cH(),null===k&&(k=co())}return null!==n?(58===cq.charCodeAt(dY)?(k=":",dY++):(k=null,0===aJ&&cj('":"')),null!==k?(m=dv(),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(i){return":"}(h)),null===n&&(dY=h),n}function dy(){var p,k,n,m,h,j,q;if(h=dY,j=dY,k=dp(),null!==k){for(p=[];null!==k;){p.push(k),k=dp()}}else{p=null}if(null!==p){for(k=[],q=dY,n=[],m=cf();null!==m;){n.push(m),m=cf()}for(null!==n?(m=dp(),null!==m?n=[n,m]:(n=null,dY=q)):(n=null,dY=q);null!==n;){for(k.push(n),q=dY,n=[],m=cf();null!==m;){n.push(m),m=cf()}null!==n?(m=dp(),null!==m?n=[n,m]:(n=null,dY=q)):(n=null,dY=q)}null!==k?p=[p,k]:(p=null,dY=j)}else{p=null,dY=j}return null!==p&&(p=function(i){return cq.substring(dY,i)}(h)),null===p&&(dY=h),p}function dp(){var h;return/^[!-~]/.test(cq.charAt(dY))?(h=cq.charAt(dY),dY++):(h=null,0===aJ&&cj("[!-~]")),null===h&&(h=b9()),h}function b9(){var h;return/^[\x80-\uFFFF]/.test(cq.charAt(dY))?(h=cq.charAt(dY),dY++):(h=null,0===aJ&&cj("[\\x80-\\uFFFF]")),h}function c1(){var h;return/^[\x80-\xBF]/.test(cq.charAt(dY))?(h=cq.charAt(dY),dY++):(h=null,0===aJ&&cj("[\\x80-\\xBF]")),h}function cJ(){var h;return h=cB(),null===h&&(/^[a-f]/.test(cq.charAt(dY))?(h=cq.charAt(dY),dY++):(h=null,0===aJ&&cj("[a-f]"))),h}function cd(){var j,h,i;if(i=dY,h=cF(),null===h&&(45===cq.charCodeAt(dY)?(h="-",dY++):(h=null,0===aJ&&cj('"-"')),null===h&&(46===cq.charCodeAt(dY)?(h=".",dY++):(h=null,0===aJ&&cj('"."')),null===h&&(33===cq.charCodeAt(dY)?(h="!",dY++):(h=null,0===aJ&&cj('"!"')),null===h&&(37===cq.charCodeAt(dY)?(h="%",dY++):(h=null,0===aJ&&cj('"%"')),null===h&&(42===cq.charCodeAt(dY)?(h="*",dY++):(h=null,0===aJ&&cj('"*"')),null===h&&(95===cq.charCodeAt(dY)?(h="_",dY++):(h=null,0===aJ&&cj('"_"')),null===h&&(43===cq.charCodeAt(dY)?(h="+",dY++):(h=null,0===aJ&&cj('"+"')),null===h&&(96===cq.charCodeAt(dY)?(h="`",dY++):(h=null,0===aJ&&cj('"`"')),null===h&&(39===cq.charCodeAt(dY)?(h="'",dY++):(h=null,0===aJ&&cj('"\'"')),null===h&&(126===cq.charCodeAt(dY)?(h="~",dY++):(h=null,0===aJ&&cj('"~"')))))))))))),null!==h){for(j=[];null!==h;){j.push(h),h=cF(),null===h&&(45===cq.charCodeAt(dY)?(h="-",dY++):(h=null,0===aJ&&cj('"-"')),null===h&&(46===cq.charCodeAt(dY)?(h=".",dY++):(h=null,0===aJ&&cj('"."')),null===h&&(33===cq.charCodeAt(dY)?(h="!",dY++):(h=null,0===aJ&&cj('"!"')),null===h&&(37===cq.charCodeAt(dY)?(h="%",dY++):(h=null,0===aJ&&cj('"%"')),null===h&&(42===cq.charCodeAt(dY)?(h="*",dY++):(h=null,0===aJ&&cj('"*"')),null===h&&(95===cq.charCodeAt(dY)?(h="_",dY++):(h=null,0===aJ&&cj('"_"')),null===h&&(43===cq.charCodeAt(dY)?(h="+",dY++):(h=null,0===aJ&&cj('"+"')),null===h&&(96===cq.charCodeAt(dY)?(h="`",dY++):(h=null,0===aJ&&cj('"`"')),null===h&&(39===cq.charCodeAt(dY)?(h="'",dY++):(h=null,0===aJ&&cj('"\'"')),null===h&&(126===cq.charCodeAt(dY)?(h="~",dY++):(h=null,0===aJ&&cj('"~"'))))))))))))}}else{j=null}return null!==j&&(j=function(k){return cq.substring(dY,k)}(i)),null===j&&(dY=i),j}function di(){var j,h,i;if(i=dY,h=cF(),null===h&&(45===cq.charCodeAt(dY)?(h="-",dY++):(h=null,0===aJ&&cj('"-"')),null===h&&(33===cq.charCodeAt(dY)?(h="!",dY++):(h=null,0===aJ&&cj('"!"')),null===h&&(37===cq.charCodeAt(dY)?(h="%",dY++):(h=null,0===aJ&&cj('"%"')),null===h&&(42===cq.charCodeAt(dY)?(h="*",dY++):(h=null,0===aJ&&cj('"*"')),null===h&&(95===cq.charCodeAt(dY)?(h="_",dY++):(h=null,0===aJ&&cj('"_"')),null===h&&(43===cq.charCodeAt(dY)?(h="+",dY++):(h=null,0===aJ&&cj('"+"')),null===h&&(96===cq.charCodeAt(dY)?(h="`",dY++):(h=null,0===aJ&&cj('"`"')),null===h&&(39===cq.charCodeAt(dY)?(h="'",dY++):(h=null,0===aJ&&cj('"\'"')),null===h&&(126===cq.charCodeAt(dY)?(h="~",dY++):(h=null,0===aJ&&cj('"~"'))))))))))),null!==h){for(j=[];null!==h;){j.push(h),h=cF(),null===h&&(45===cq.charCodeAt(dY)?(h="-",dY++):(h=null,0===aJ&&cj('"-"')),null===h&&(33===cq.charCodeAt(dY)?(h="!",dY++):(h=null,0===aJ&&cj('"!"')),null===h&&(37===cq.charCodeAt(dY)?(h="%",dY++):(h=null,0===aJ&&cj('"%"')),null===h&&(42===cq.charCodeAt(dY)?(h="*",dY++):(h=null,0===aJ&&cj('"*"')),null===h&&(95===cq.charCodeAt(dY)?(h="_",dY++):(h=null,0===aJ&&cj('"_"')),null===h&&(43===cq.charCodeAt(dY)?(h="+",dY++):(h=null,0===aJ&&cj('"+"')),null===h&&(96===cq.charCodeAt(dY)?(h="`",dY++):(h=null,0===aJ&&cj('"`"')),null===h&&(39===cq.charCodeAt(dY)?(h="'",dY++):(h=null,0===aJ&&cj('"\'"')),null===h&&(126===cq.charCodeAt(dY)?(h="~",dY++):(h=null,0===aJ&&cj('"~"')))))))))))}}else{j=null}return null!==j&&(j=function(k){return cq.substring(dY,k)}(i)),null===j&&(dY=i),j}function c7(){var h;return 40===cq.charCodeAt(dY)?(h="(",dY++):(h=null,0===aJ&&cj('"("')),null===h&&(41===cq.charCodeAt(dY)?(h=")",dY++):(h=null,0===aJ&&cj('")"')),null===h&&(60===cq.charCodeAt(dY)?(h="<",dY++):(h=null,0===aJ&&cj('"<"')),null===h&&(62===cq.charCodeAt(dY)?(h=">",dY++):(h=null,0===aJ&&cj('">"')),null===h&&(64===cq.charCodeAt(dY)?(h="@",dY++):(h=null,0===aJ&&cj('"@"')),null===h&&(44===cq.charCodeAt(dY)?(h=",",dY++):(h=null,0===aJ&&cj('","')),null===h&&(59===cq.charCodeAt(dY)?(h=";",dY++):(h=null,0===aJ&&cj('";"')),null===h&&(58===cq.charCodeAt(dY)?(h=":",dY++):(h=null,0===aJ&&cj('":"')),null===h&&(92===cq.charCodeAt(dY)?(h="\\",dY++):(h=null,0===aJ&&cj('"\\\\"')),null===h&&(h=cD(),null===h&&(47===cq.charCodeAt(dY)?(h="/",dY++):(h=null,0===aJ&&cj('"/"')),null===h&&(91===cq.charCodeAt(dY)?(h="[",dY++):(h=null,0===aJ&&cj('"["')),null===h&&(93===cq.charCodeAt(dY)?(h="]",dY++):(h=null,0===aJ&&cj('"]"')),null===h&&(63===cq.charCodeAt(dY)?(h="?",dY++):(h=null,0===aJ&&cj('"?"')),null===h&&(61===cq.charCodeAt(dY)?(h="=",dY++):(h=null,0===aJ&&cj('"="')),null===h&&(123===cq.charCodeAt(dY)?(h="{",dY++):(h=null,0===aJ&&cj('"{"')),null===h&&(125===cq.charCodeAt(dY)?(h="}",dY++):(h=null,0===aJ&&cj('"}"')),null===h&&(h=cH(),null===h&&(h=co())))))))))))))))))),h}function ds(){var j,h,i;if(i=dY,h=cF(),null===h&&(45===cq.charCodeAt(dY)?(h="-",dY++):(h=null,0===aJ&&cj('"-"')),null===h&&(46===cq.charCodeAt(dY)?(h=".",dY++):(h=null,0===aJ&&cj('"."')),null===h&&(33===cq.charCodeAt(dY)?(h="!",dY++):(h=null,0===aJ&&cj('"!"')),null===h&&(37===cq.charCodeAt(dY)?(h="%",dY++):(h=null,0===aJ&&cj('"%"')),null===h&&(42===cq.charCodeAt(dY)?(h="*",dY++):(h=null,0===aJ&&cj('"*"')),null===h&&(95===cq.charCodeAt(dY)?(h="_",dY++):(h=null,0===aJ&&cj('"_"')),null===h&&(43===cq.charCodeAt(dY)?(h="+",dY++):(h=null,0===aJ&&cj('"+"')),null===h&&(96===cq.charCodeAt(dY)?(h="`",dY++):(h=null,0===aJ&&cj('"`"')),null===h&&(39===cq.charCodeAt(dY)?(h="'",dY++):(h=null,0===aJ&&cj('"\'"')),null===h&&(126===cq.charCodeAt(dY)?(h="~",dY++):(h=null,0===aJ&&cj('"~"')),null===h&&(40===cq.charCodeAt(dY)?(h="(",dY++):(h=null,0===aJ&&cj('"("')),null===h&&(41===cq.charCodeAt(dY)?(h=")",dY++):(h=null,0===aJ&&cj('")"')),null===h&&(60===cq.charCodeAt(dY)?(h="<",dY++):(h=null,0===aJ&&cj('"<"')),null===h&&(62===cq.charCodeAt(dY)?(h=">",dY++):(h=null,0===aJ&&cj('">"')),null===h&&(58===cq.charCodeAt(dY)?(h=":",dY++):(h=null,0===aJ&&cj('":"')),null===h&&(92===cq.charCodeAt(dY)?(h="\\",dY++):(h=null,0===aJ&&cj('"\\\\"')),null===h&&(h=cD(),null===h&&(47===cq.charCodeAt(dY)?(h="/",dY++):(h=null,0===aJ&&cj('"/"')),null===h&&(91===cq.charCodeAt(dY)?(h="[",dY++):(h=null,0===aJ&&cj('"["')),null===h&&(93===cq.charCodeAt(dY)?(h="]",dY++):(h=null,0===aJ&&cj('"]"')),null===h&&(63===cq.charCodeAt(dY)?(h="?",dY++):(h=null,0===aJ&&cj('"?"')),null===h&&(123===cq.charCodeAt(dY)?(h="{",dY++):(h=null,0===aJ&&cj('"{"')),null===h&&(125===cq.charCodeAt(dY)?(h="}",dY++):(h=null,0===aJ&&cj('"}"'))))))))))))))))))))))))),null!==h){for(j=[];null!==h;){j.push(h),h=cF(),null===h&&(45===cq.charCodeAt(dY)?(h="-",dY++):(h=null,0===aJ&&cj('"-"')),null===h&&(46===cq.charCodeAt(dY)?(h=".",dY++):(h=null,0===aJ&&cj('"."')),null===h&&(33===cq.charCodeAt(dY)?(h="!",dY++):(h=null,0===aJ&&cj('"!"')),null===h&&(37===cq.charCodeAt(dY)?(h="%",dY++):(h=null,0===aJ&&cj('"%"')),null===h&&(42===cq.charCodeAt(dY)?(h="*",dY++):(h=null,0===aJ&&cj('"*"')),null===h&&(95===cq.charCodeAt(dY)?(h="_",dY++):(h=null,0===aJ&&cj('"_"')),null===h&&(43===cq.charCodeAt(dY)?(h="+",dY++):(h=null,0===aJ&&cj('"+"')),null===h&&(96===cq.charCodeAt(dY)?(h="`",dY++):(h=null,0===aJ&&cj('"`"')),null===h&&(39===cq.charCodeAt(dY)?(h="'",dY++):(h=null,0===aJ&&cj('"\'"')),null===h&&(126===cq.charCodeAt(dY)?(h="~",dY++):(h=null,0===aJ&&cj('"~"')),null===h&&(40===cq.charCodeAt(dY)?(h="(",dY++):(h=null,0===aJ&&cj('"("')),null===h&&(41===cq.charCodeAt(dY)?(h=")",dY++):(h=null,0===aJ&&cj('")"')),null===h&&(60===cq.charCodeAt(dY)?(h="<",dY++):(h=null,0===aJ&&cj('"<"')),null===h&&(62===cq.charCodeAt(dY)?(h=">",dY++):(h=null,0===aJ&&cj('">"')),null===h&&(58===cq.charCodeAt(dY)?(h=":",dY++):(h=null,0===aJ&&cj('":"')),null===h&&(92===cq.charCodeAt(dY)?(h="\\",dY++):(h=null,0===aJ&&cj('"\\\\"')),null===h&&(h=cD(),null===h&&(47===cq.charCodeAt(dY)?(h="/",dY++):(h=null,0===aJ&&cj('"/"')),null===h&&(91===cq.charCodeAt(dY)?(h="[",dY++):(h=null,0===aJ&&cj('"["')),null===h&&(93===cq.charCodeAt(dY)?(h="]",dY++):(h=null,0===aJ&&cj('"]"')),null===h&&(63===cq.charCodeAt(dY)?(h="?",dY++):(h=null,0===aJ&&cj('"?"')),null===h&&(123===cq.charCodeAt(dY)?(h="{",dY++):(h=null,0===aJ&&cj('"{"')),null===h&&(125===cq.charCodeAt(dY)?(h="}",dY++):(h=null,0===aJ&&cj('"}"')))))))))))))))))))))))))}}else{j=null}return null!==j&&(j=function(k){return cq.substring(dY,k)}(i)),null===j&&(dY=i),j}function cW(){var n,k,m,h,j;return h=dY,j=dY,n=dv(),null!==n?(42===cq.charCodeAt(dY)?(k="*",dY++):(k=null,0===aJ&&cj('"*"')),null!==k?(m=dv(),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(i){return"*"}(h)),null===n&&(dY=h),n}function c5(){var n,k,m,h,j;return h=dY,j=dY,n=dv(),null!==n?(47===cq.charCodeAt(dY)?(k="/",dY++):(k=null,0===aJ&&cj('"/"')),null!==k?(m=dv(),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(i){return"/"}(h)),null===n&&(dY=h),n}function cb(){var n,k,m,h,j;return h=dY,j=dY,n=dv(),null!==n?(61===cq.charCodeAt(dY)?(k="=",dY++):(k=null,0===aJ&&cj('"="')),null!==k?(m=dv(),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(i){return"="}(h)),null===n&&(dY=h),n}function da(){var n,k,m,h,j;return h=dY,j=dY,n=dv(),null!==n?(40===cq.charCodeAt(dY)?(k="(",dY++):(k=null,0===aJ&&cj('"("')),null!==k?(m=dv(),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(i){return"("}(h)),null===n&&(dY=h),n}function c4(){var n,k,m,h,j;return h=dY,j=dY,n=dv(),null!==n?(41===cq.charCodeAt(dY)?(k=")",dY++):(k=null,0===aJ&&cj('")"')),null!==k?(m=dv(),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(i){return")"}(h)),null===n&&(dY=h),n}function db(){var k,i,j,h;return j=dY,h=dY,62===cq.charCodeAt(dY)?(k=">",dY++):(k=null,0===aJ&&cj('">"')),null!==k?(i=dv(),null!==i?k=[k,i]:(k=null,dY=h)):(k=null,dY=h),null!==k&&(k=function(l){return">"}(j)),null===k&&(dY=j),k}function cl(){var k,i,j,h;return j=dY,h=dY,k=dv(),null!==k?(60===cq.charCodeAt(dY)?(i="<",dY++):(i=null,0===aJ&&cj('"<"')),null!==i?k=[k,i]:(k=null,dY=h)):(k=null,dY=h),null!==k&&(k=function(l){return"<"}(j)),null===k&&(dY=j),k}function cx(){var n,k,m,h,j;return h=dY,j=dY,n=dv(),null!==n?(44===cq.charCodeAt(dY)?(k=",",dY++):(k=null,0===aJ&&cj('","')),null!==k?(m=dv(),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(i){return","}(h)),null===n&&(dY=h),n}function dj(){var n,k,m,h,j;return h=dY,j=dY,n=dv(),null!==n?(59===cq.charCodeAt(dY)?(k=";",dY++):(k=null,0===aJ&&cj('";"')),null!==k?(m=dv(),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(i){return";"}(h)),null===n&&(dY=h),n}function dk(){var n,k,m,h,j;return h=dY,j=dY,n=dv(),null!==n?(58===cq.charCodeAt(dY)?(k=":",dY++):(k=null,0===aJ&&cj('":"')),null!==k?(m=dv(),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(i){return":"}(h)),null===n&&(dY=h),n}function dl(){var j,h,k,i;return k=dY,i=dY,j=dv(),null!==j?(h=cD(),null!==h?j=[j,h]:(j=null,dY=i)):(j=null,dY=i),null!==j&&(j=function(l){return'"'}(k)),null===j&&(dY=k),j}function cz(){var j,h,k,i;return k=dY,i=dY,j=cD(),null!==j?(h=dv(),null!==h?j=[j,h]:(j=null,dY=i)):(j=null,dY=i),null!==j&&(j=function(l){return'"'}(k)),null===j&&(dY=k),j}function cT(){var j,h,k,i;if(i=dY,j=da(),null!==j){for(h=[],k=b8(),null===k&&(k=dd(),null===k&&(k=cT()));null!==k;){h.push(k),k=b8(),null===k&&(k=dd(),null===k&&(k=cT()))}null!==h?(k=c4(),null!==k?j=[j,h,k]:(j=null,dY=i)):(j=null,dY=i)}else{j=null,dY=i}return j}function b8(){var h;return/^[!-']/.test(cq.charAt(dY))?(h=cq.charAt(dY),dY++):(h=null,0===aJ&&cj("[!-']")),null===h&&(/^[*-[]/.test(cq.charAt(dY))?(h=cq.charAt(dY),dY++):(h=null,0===aJ&&cj("[*-[]")),null===h&&(/^[\]-~]/.test(cq.charAt(dY))?(h=cq.charAt(dY),dY++):(h=null,0===aJ&&cj("[\\]-~]")),null===h&&(h=b9(),null===h&&(h=cf())))),h}function dw(){var o,k,n,m,h,j;if(h=dY,j=dY,o=dv(),null!==o){if(k=cD(),null!==k){for(n=[],m=cR(),null===m&&(m=dd());null!==m;){n.push(m),m=cR(),null===m&&(m=dd())}null!==n?(m=cD(),null!==m?o=[o,k,n,m]:(o=null,dY=j)):(o=null,dY=j)}else{o=null,dY=j}}else{o=null,dY=j}return null!==o&&(o=function(i){return cq.substring(dY,i)}(h)),null===o&&(dY=h),o}function cU(){var o,k,n,m,h,j;if(h=dY,j=dY,o=dv(),null!==o){if(k=cD(),null!==k){for(n=[],m=cR(),null===m&&(m=dd());null!==m;){n.push(m),m=cR(),null===m&&(m=dd())}null!==n?(m=cD(),null!==m?o=[o,k,n,m]:(o=null,dY=j)):(o=null,dY=j)}else{o=null,dY=j}}else{o=null,dY=j}return null!==o&&(o=function(i){return cq.substring(dY-1,i+1)}(h)),null===o&&(dY=h),o}function cR(){var h;return h=cf(),null===h&&(33===cq.charCodeAt(dY)?(h="!",dY++):(h=null,0===aJ&&cj('"!"')),null===h&&(/^[#-[]/.test(cq.charAt(dY))?(h=cq.charAt(dY),dY++):(h=null,0===aJ&&cj("[#-[]")),null===h&&(/^[\]-~]/.test(cq.charAt(dY))?(h=cq.charAt(dY),dY++):(h=null,0===aJ&&cj("[\\]-~]")),null===h&&(h=b9())))),h}function dd(){var j,h,i;return i=dY,92===cq.charCodeAt(dY)?(j="\\",dY++):(j=null,0===aJ&&cj('"\\\\"')),null!==j?(/^[\0-\t]/.test(cq.charAt(dY))?(h=cq.charAt(dY),dY++):(h=null,0===aJ&&cj("[\\0-\\t]")),null===h&&(/^[\x0B-\f]/.test(cq.charAt(dY))?(h=cq.charAt(dY),dY++):(h=null,0===aJ&&cj("[\\x0B-\\f]")),null===h&&(/^[\x0E-]/.test(cq.charAt(dY))?(h=cq.charAt(dY),dY++):(h=null,0===aJ&&cj("[\\x0E-]")))),null!==h?j=[j,h]:(j=null,dY=i)):(j=null,dY=i),j}function dg(){var n,k,m,h,j,p;return j=dY,p=dY,n=dP(),null!==n?(58===cq.charCodeAt(dY)?(k=":",dY++):(k=null,0===aJ&&cj('":"')),null!==k?(m=cP(),m=null!==m?m:"",null!==m?(h=dA(),null!==h?n=[n,k,m,h]:(n=null,dY=p)):(n=null,dY=p)):(n=null,dY=p)):(n=null,dY=p),null!==n&&(n=function(l){try{aW.uri=new dD(aW.scheme,aW.user,aW.host,aW.port),delete aW.scheme,delete aW.user,delete aW.host,delete aW.host_type,delete aW.port}catch(i){aW=-1}}(j)),null===n&&(dY=j),n}function cS(){var p,n,j,m,q,k,h,r;return h=dY,r=dY,p=dP(),null!==p?(58===cq.charCodeAt(dY)?(n=":",dY++):(n=null,0===aJ&&cj('":"')),null!==n?(j=cP(),j=null!==j?j:"",null!==j?(m=dA(),null!==m?(q=bB(),null!==q?(k=au(),k=null!==k?k:"",null!==k?p=[p,n,j,m,q,k]:(p=null,dY=r)):(p=null,dY=r)):(p=null,dY=r)):(p=null,dY=r)):(p=null,dY=r)):(p=null,dY=r),null!==p&&(p=function(l){try{aW.uri=new dD(aW.scheme,aW.user,aW.host,aW.port,aW.uri_params,aW.uri_headers),delete aW.scheme,delete aW.user,delete aW.host,delete aW.host_type,delete aW.port,delete aW.uri_params,"SIP_URI"===ck&&(aW=aW.uri)}catch(i){aW=-1}}(h)),null===p&&(dY=h),p}function dP(){var i,h;return"sip"===cq.substr(dY,3).toLowerCase()?(i=cq.substr(dY,3),dY+=3):(i=null,0===aJ&&cj('"sip"')),null===i&&(h=dY,"sips"===cq.substr(dY,4).toLowerCase()?(i=cq.substr(dY,4),dY+=4):(i=null,0===aJ&&cj('"sips"')),null!==i&&(i=function(j){aW.scheme=uri_scheme.toLowerCase()}(h)),null===i&&(dY=h)),i}function cP(){var n,k,m,h,j,p;return h=dY,j=dY,n=c2(),null!==n?(p=dY,58===cq.charCodeAt(dY)?(k=":",dY++):(k=null,0===aJ&&cj('":"')),null!==k?(m=a7(),null!==m?k=[k,m]:(k=null,dY=p)):(k=null,dY=p),k=null!==k?k:"",null!==k?(64===cq.charCodeAt(dY)?(m="@",dY++):(m=null,0===aJ&&cj('"@"')),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(i){aW.user=decodeURIComponent(cq.substring(dY-1,i))}(h)),null===n&&(dY=h),n}function c2(){var i,h;if(h=cE(),null===h&&(h=cN(),null===h&&(h=bO())),null!==h){for(i=[];null!==h;){i.push(h),h=cE(),null===h&&(h=cN(),null===h&&(h=bO()))}}else{i=null}return i}function bO(){var h;return 38===cq.charCodeAt(dY)?(h="&",dY++):(h=null,0===aJ&&cj('"&"')),null===h&&(61===cq.charCodeAt(dY)?(h="=",dY++):(h=null,0===aJ&&cj('"="')),null===h&&(43===cq.charCodeAt(dY)?(h="+",dY++):(h=null,0===aJ&&cj('"+"')),null===h&&(36===cq.charCodeAt(dY)?(h="$",dY++):(h=null,0===aJ&&cj('"$"')),null===h&&(44===cq.charCodeAt(dY)?(h=",",dY++):(h=null,0===aJ&&cj('","')),null===h&&(59===cq.charCodeAt(dY)?(h=";",dY++):(h=null,0===aJ&&cj('";"')),null===h&&(63===cq.charCodeAt(dY)?(h="?",dY++):(h=null,0===aJ&&cj('"?"')),null===h&&(47===cq.charCodeAt(dY)?(h="/",dY++):(h=null,0===aJ&&cj('"/"'))))))))),h}function a7(){var j,h,i;for(i=dY,j=[],h=cE(),null===h&&(h=cN(),null===h&&(38===cq.charCodeAt(dY)?(h="&",dY++):(h=null,0===aJ&&cj('"&"')),null===h&&(61===cq.charCodeAt(dY)?(h="=",dY++):(h=null,0===aJ&&cj('"="')),null===h&&(43===cq.charCodeAt(dY)?(h="+",dY++):(h=null,0===aJ&&cj('"+"')),null===h&&(36===cq.charCodeAt(dY)?(h="$",dY++):(h=null,0===aJ&&cj('"$"')),null===h&&(44===cq.charCodeAt(dY)?(h=",",dY++):(h=null,0===aJ&&cj('","'))))))));null!==h;){j.push(h),h=cE(),null===h&&(h=cN(),null===h&&(38===cq.charCodeAt(dY)?(h="&",dY++):(h=null,0===aJ&&cj('"&"')),null===h&&(61===cq.charCodeAt(dY)?(h="=",dY++):(h=null,0===aJ&&cj('"="')),null===h&&(43===cq.charCodeAt(dY)?(h="+",dY++):(h=null,0===aJ&&cj('"+"')),null===h&&(36===cq.charCodeAt(dY)?(h="$",dY++):(h=null,0===aJ&&cj('"$"')),null===h&&(44===cq.charCodeAt(dY)?(h=",",dY++):(h=null,0===aJ&&cj('","'))))))))}return null!==j&&(j=function(k){aW.password=cq.substring(dY,k)}(i)),null===j&&(dY=i),j}function dA(){var n,k,m,h,j;return h=dY,n=bG(),null!==n?(j=dY,58===cq.charCodeAt(dY)?(k=":",dY++):(k=null,0===aJ&&cj('":"')),null!==k?(m=b7(),null!==m?k=[k,m]:(k=null,dY=j)):(k=null,dY=j),k=null!==k?k:"",null!==k?n=[n,k]:(n=null,dY=h)):(n=null,dY=h),n}function bG(){var i,h;return h=dY,i=a4(),null===i&&(i=cO(),null===i&&(i=bo())),null!==i&&(i=function(j){return aW.host=cq.substring(dY,j).toLowerCase(),aW.host}(h)),null===i&&(dY=h),i}function bo(){var n,k,m,h,j,p;for(h=dY,j=dY,n=[],p=dY,k=d5(),null!==k?(46===cq.charCodeAt(dY)?(m=".",dY++):(m=null,0===aJ&&cj('"."')),null!==m?k=[k,m]:(k=null,dY=p)):(k=null,dY=p);null!==k;){n.push(k),p=dY,k=d5(),null!==k?(46===cq.charCodeAt(dY)?(m=".",dY++):(m=null,0===aJ&&cj('"."')),null!==m?k=[k,m]:(k=null,dY=p)):(k=null,dY=p)}return null!==n?(k=aQ(),null!==k?(46===cq.charCodeAt(dY)?(m=".",dY++):(m=null,0===aJ&&cj('"."')),m=null!==m?m:"",null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(i){return aW.host_type="domain",cq.substring(dY,i)}(h)),null===n&&(dY=h),n}function d5(){var i,h;if(/^[a-zA-Z0-9_\-]/.test(cq.charAt(dY))?(h=cq.charAt(dY),dY++):(h=null,0===aJ&&cj("[a-zA-Z0-9_\\-]")),null!==h){for(i=[];null!==h;){i.push(h),/^[a-zA-Z0-9_\-]/.test(cq.charAt(dY))?(h=cq.charAt(dY),dY++):(h=null,0===aJ&&cj("[a-zA-Z0-9_\\-]"))}}else{i=null}return i}function aQ(){var i,h;if(/^[a-zA-Z0-9_\-]/.test(cq.charAt(dY))?(h=cq.charAt(dY),dY++):(h=null,0===aJ&&cj("[a-zA-Z0-9_\\-]")),null!==h){for(i=[];null!==h;){i.push(h),/^[a-zA-Z0-9_\-]/.test(cq.charAt(dY))?(h=cq.charAt(dY),dY++):(h=null,0===aJ&&cj("[a-zA-Z0-9_\\-]"))}}else{i=null}return i}function cO(){var n,k,m,h,j;return h=dY,j=dY,91===cq.charCodeAt(dY)?(n="[",dY++):(n=null,0===aJ&&cj('"["')),null!==n?(k=aT(),null!==k?(93===cq.charCodeAt(dY)?(m="]",dY++):(m=null,0===aJ&&cj('"]"')),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(i){return aW.host_type="IPv6",cq.substring(dY,i)}(h)),null===n&&(dY=h),n}function aT(){var A,F,j,s,w,n,E,D,C,x,B,k,z,q,y,v;return q=dY,y=dY,A=dL(),null!==A?(58===cq.charCodeAt(dY)?(F=":",dY++):(F=null,0===aJ&&cj('":"')),null!==F?(j=dL(),null!==j?(58===cq.charCodeAt(dY)?(s=":",dY++):(s=null,0===aJ&&cj('":"')),null!==s?(w=dL(),null!==w?(58===cq.charCodeAt(dY)?(n=":",dY++):(n=null,0===aJ&&cj('":"')),null!==n?(E=dL(),null!==E?(58===cq.charCodeAt(dY)?(D=":",dY++):(D=null,0===aJ&&cj('":"')),null!==D?(C=dL(),null!==C?(58===cq.charCodeAt(dY)?(x=":",dY++):(x=null,0===aJ&&cj('":"')),null!==x?(B=dL(),null!==B?(58===cq.charCodeAt(dY)?(k=":",dY++):(k=null,0===aJ&&cj('":"')),null!==k?(z=cA(),null!==z?A=[A,F,j,s,w,n,E,D,C,x,B,k,z]:(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y),null===A&&(y=dY,"::"===cq.substr(dY,2)?(A="::",dY+=2):(A=null,0===aJ&&cj('"::"')),null!==A?(F=dL(),null!==F?(58===cq.charCodeAt(dY)?(j=":",dY++):(j=null,0===aJ&&cj('":"')),null!==j?(s=dL(),null!==s?(58===cq.charCodeAt(dY)?(w=":",dY++):(w=null,0===aJ&&cj('":"')),null!==w?(n=dL(),null!==n?(58===cq.charCodeAt(dY)?(E=":",dY++):(E=null,0===aJ&&cj('":"')),null!==E?(D=dL(),null!==D?(58===cq.charCodeAt(dY)?(C=":",dY++):(C=null,0===aJ&&cj('":"')),null!==C?(x=dL(),null!==x?(58===cq.charCodeAt(dY)?(B=":",dY++):(B=null,0===aJ&&cj('":"')),null!==B?(k=cA(),null!==k?A=[A,F,j,s,w,n,E,D,C,x,B,k]:(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y),null===A&&(y=dY,"::"===cq.substr(dY,2)?(A="::",dY+=2):(A=null,0===aJ&&cj('"::"')),null!==A?(F=dL(),null!==F?(58===cq.charCodeAt(dY)?(j=":",dY++):(j=null,0===aJ&&cj('":"')),null!==j?(s=dL(),null!==s?(58===cq.charCodeAt(dY)?(w=":",dY++):(w=null,0===aJ&&cj('":"')),null!==w?(n=dL(),null!==n?(58===cq.charCodeAt(dY)?(E=":",dY++):(E=null,0===aJ&&cj('":"')),null!==E?(D=dL(),null!==D?(58===cq.charCodeAt(dY)?(C=":",dY++):(C=null,0===aJ&&cj('":"')),null!==C?(x=cA(),null!==x?A=[A,F,j,s,w,n,E,D,C,x]:(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y),null===A&&(y=dY,"::"===cq.substr(dY,2)?(A="::",dY+=2):(A=null,0===aJ&&cj('"::"')),null!==A?(F=dL(),null!==F?(58===cq.charCodeAt(dY)?(j=":",dY++):(j=null,0===aJ&&cj('":"')),null!==j?(s=dL(),null!==s?(58===cq.charCodeAt(dY)?(w=":",dY++):(w=null,0===aJ&&cj('":"')),null!==w?(n=dL(),null!==n?(58===cq.charCodeAt(dY)?(E=":",dY++):(E=null,0===aJ&&cj('":"')),null!==E?(D=cA(),null!==D?A=[A,F,j,s,w,n,E,D]:(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y),null===A&&(y=dY,"::"===cq.substr(dY,2)?(A="::",dY+=2):(A=null,0===aJ&&cj('"::"')),null!==A?(F=dL(),null!==F?(58===cq.charCodeAt(dY)?(j=":",dY++):(j=null,0===aJ&&cj('":"')),null!==j?(s=dL(),null!==s?(58===cq.charCodeAt(dY)?(w=":",dY++):(w=null,0===aJ&&cj('":"')),null!==w?(n=cA(),null!==n?A=[A,F,j,s,w,n]:(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y),null===A&&(y=dY,"::"===cq.substr(dY,2)?(A="::",dY+=2):(A=null,0===aJ&&cj('"::"')),null!==A?(F=dL(),null!==F?(58===cq.charCodeAt(dY)?(j=":",dY++):(j=null,0===aJ&&cj('":"')),null!==j?(s=cA(),null!==s?A=[A,F,j,s]:(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y),null===A&&(y=dY,"::"===cq.substr(dY,2)?(A="::",dY+=2):(A=null,0===aJ&&cj('"::"')),null!==A?(F=cA(),null!==F?A=[A,F]:(A=null,dY=y)):(A=null,dY=y),null===A&&(y=dY,"::"===cq.substr(dY,2)?(A="::",dY+=2):(A=null,0===aJ&&cj('"::"')),null!==A?(F=dL(),null!==F?A=[A,F]:(A=null,dY=y)):(A=null,dY=y),null===A&&(y=dY,A=dL(),null!==A?("::"===cq.substr(dY,2)?(F="::",dY+=2):(F=null,0===aJ&&cj('"::"')),null!==F?(j=dL(),null!==j?(58===cq.charCodeAt(dY)?(s=":",dY++):(s=null,0===aJ&&cj('":"')),null!==s?(w=dL(),null!==w?(58===cq.charCodeAt(dY)?(n=":",dY++):(n=null,0===aJ&&cj('":"')),null!==n?(E=dL(),null!==E?(58===cq.charCodeAt(dY)?(D=":",dY++):(D=null,0===aJ&&cj('":"')),null!==D?(C=dL(),null!==C?(58===cq.charCodeAt(dY)?(x=":",dY++):(x=null,0===aJ&&cj('":"')),null!==x?(B=cA(),null!==B?A=[A,F,j,s,w,n,E,D,C,x,B]:(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y),null===A&&(y=dY,A=dL(),null!==A?(v=dY,58===cq.charCodeAt(dY)?(F=":",dY++):(F=null,0===aJ&&cj('":"')),null!==F?(j=dL(),null!==j?F=[F,j]:(F=null,dY=v)):(F=null,dY=v),F=null!==F?F:"",null!==F?("::"===cq.substr(dY,2)?(j="::",dY+=2):(j=null,0===aJ&&cj('"::"')),null!==j?(s=dL(),null!==s?(58===cq.charCodeAt(dY)?(w=":",dY++):(w=null,0===aJ&&cj('":"')),null!==w?(n=dL(),null!==n?(58===cq.charCodeAt(dY)?(E=":",dY++):(E=null,0===aJ&&cj('":"')),null!==E?(D=dL(),null!==D?(58===cq.charCodeAt(dY)?(C=":",dY++):(C=null,0===aJ&&cj('":"')),null!==C?(x=cA(),null!==x?A=[A,F,j,s,w,n,E,D,C,x]:(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y),null===A&&(y=dY,A=dL(),null!==A?(v=dY,58===cq.charCodeAt(dY)?(F=":",dY++):(F=null,0===aJ&&cj('":"')),null!==F?(j=dL(),null!==j?F=[F,j]:(F=null,dY=v)):(F=null,dY=v),F=null!==F?F:"",null!==F?(v=dY,58===cq.charCodeAt(dY)?(j=":",dY++):(j=null,0===aJ&&cj('":"')),null!==j?(s=dL(),null!==s?j=[j,s]:(j=null,dY=v)):(j=null,dY=v),j=null!==j?j:"",null!==j?("::"===cq.substr(dY,2)?(s="::",dY+=2):(s=null,0===aJ&&cj('"::"')),null!==s?(w=dL(),null!==w?(58===cq.charCodeAt(dY)?(n=":",dY++):(n=null,0===aJ&&cj('":"')),null!==n?(E=dL(),null!==E?(58===cq.charCodeAt(dY)?(D=":",dY++):(D=null,0===aJ&&cj('":"')),null!==D?(C=cA(),null!==C?A=[A,F,j,s,w,n,E,D,C]:(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y),null===A&&(y=dY,A=dL(),null!==A?(v=dY,58===cq.charCodeAt(dY)?(F=":",dY++):(F=null,0===aJ&&cj('":"')),null!==F?(j=dL(),null!==j?F=[F,j]:(F=null,dY=v)):(F=null,dY=v),F=null!==F?F:"",null!==F?(v=dY,58===cq.charCodeAt(dY)?(j=":",dY++):(j=null,0===aJ&&cj('":"')),null!==j?(s=dL(),null!==s?j=[j,s]:(j=null,dY=v)):(j=null,dY=v),j=null!==j?j:"",null!==j?(v=dY,58===cq.charCodeAt(dY)?(s=":",dY++):(s=null,0===aJ&&cj('":"')),null!==s?(w=dL(),null!==w?s=[s,w]:(s=null,dY=v)):(s=null,dY=v),s=null!==s?s:"",null!==s?("::"===cq.substr(dY,2)?(w="::",dY+=2):(w=null,0===aJ&&cj('"::"')),null!==w?(n=dL(),null!==n?(58===cq.charCodeAt(dY)?(E=":",dY++):(E=null,0===aJ&&cj('":"')),null!==E?(D=cA(),null!==D?A=[A,F,j,s,w,n,E,D]:(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y),null===A&&(y=dY,A=dL(),null!==A?(v=dY,58===cq.charCodeAt(dY)?(F=":",dY++):(F=null,0===aJ&&cj('":"')),null!==F?(j=dL(),null!==j?F=[F,j]:(F=null,dY=v)):(F=null,dY=v),F=null!==F?F:"",null!==F?(v=dY,58===cq.charCodeAt(dY)?(j=":",dY++):(j=null,0===aJ&&cj('":"')),null!==j?(s=dL(),null!==s?j=[j,s]:(j=null,dY=v)):(j=null,dY=v),j=null!==j?j:"",null!==j?(v=dY,58===cq.charCodeAt(dY)?(s=":",dY++):(s=null,0===aJ&&cj('":"')),null!==s?(w=dL(),null!==w?s=[s,w]:(s=null,dY=v)):(s=null,dY=v),s=null!==s?s:"",null!==s?(v=dY,58===cq.charCodeAt(dY)?(w=":",dY++):(w=null,0===aJ&&cj('":"')),null!==w?(n=dL(),null!==n?w=[w,n]:(w=null,dY=v)):(w=null,dY=v),w=null!==w?w:"",null!==w?("::"===cq.substr(dY,2)?(n="::",dY+=2):(n=null,0===aJ&&cj('"::"')),null!==n?(E=cA(),null!==E?A=[A,F,j,s,w,n,E]:(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y),null===A&&(y=dY,A=dL(),null!==A?(v=dY,58===cq.charCodeAt(dY)?(F=":",dY++):(F=null,0===aJ&&cj('":"')),null!==F?(j=dL(),null!==j?F=[F,j]:(F=null,dY=v)):(F=null,dY=v),F=null!==F?F:"",null!==F?(v=dY,58===cq.charCodeAt(dY)?(j=":",dY++):(j=null,0===aJ&&cj('":"')),null!==j?(s=dL(),null!==s?j=[j,s]:(j=null,dY=v)):(j=null,dY=v),j=null!==j?j:"",null!==j?(v=dY,58===cq.charCodeAt(dY)?(s=":",dY++):(s=null,0===aJ&&cj('":"')),null!==s?(w=dL(),null!==w?s=[s,w]:(s=null,dY=v)):(s=null,dY=v),s=null!==s?s:"",null!==s?(v=dY,58===cq.charCodeAt(dY)?(w=":",dY++):(w=null,0===aJ&&cj('":"')),null!==w?(n=dL(),null!==n?w=[w,n]:(w=null,dY=v)):(w=null,dY=v),w=null!==w?w:"",null!==w?(v=dY,58===cq.charCodeAt(dY)?(n=":",dY++):(n=null,0===aJ&&cj('":"')),null!==n?(E=dL(),null!==E?n=[n,E]:(n=null,dY=v)):(n=null,dY=v),n=null!==n?n:"",null!==n?("::"===cq.substr(dY,2)?(E="::",dY+=2):(E=null,0===aJ&&cj('"::"')),null!==E?(D=dL(),null!==D?A=[A,F,j,s,w,n,E,D]:(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y),null===A&&(y=dY,A=dL(),null!==A?(v=dY,58===cq.charCodeAt(dY)?(F=":",dY++):(F=null,0===aJ&&cj('":"')),null!==F?(j=dL(),null!==j?F=[F,j]:(F=null,dY=v)):(F=null,dY=v),F=null!==F?F:"",null!==F?(v=dY,58===cq.charCodeAt(dY)?(j=":",dY++):(j=null,0===aJ&&cj('":"')),null!==j?(s=dL(),null!==s?j=[j,s]:(j=null,dY=v)):(j=null,dY=v),j=null!==j?j:"",null!==j?(v=dY,58===cq.charCodeAt(dY)?(s=":",dY++):(s=null,0===aJ&&cj('":"')),null!==s?(w=dL(),null!==w?s=[s,w]:(s=null,dY=v)):(s=null,dY=v),s=null!==s?s:"",null!==s?(v=dY,58===cq.charCodeAt(dY)?(w=":",dY++):(w=null,0===aJ&&cj('":"')),null!==w?(n=dL(),null!==n?w=[w,n]:(w=null,dY=v)):(w=null,dY=v),w=null!==w?w:"",null!==w?(v=dY,58===cq.charCodeAt(dY)?(n=":",dY++):(n=null,0===aJ&&cj('":"')),null!==n?(E=dL(),null!==E?n=[n,E]:(n=null,dY=v)):(n=null,dY=v),n=null!==n?n:"",null!==n?(v=dY,58===cq.charCodeAt(dY)?(E=":",dY++):(E=null,0===aJ&&cj('":"')),null!==E?(D=dL(),null!==D?E=[E,D]:(E=null,dY=v)):(E=null,dY=v),E=null!==E?E:"",null!==E?("::"===cq.substr(dY,2)?(D="::",dY+=2):(D=null,0===aJ&&cj('"::"')),null!==D?A=[A,F,j,s,w,n,E,D]:(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y)):(A=null,dY=y))))))))))))))),null!==A&&(A=function(h){return aW.host_type="IPv6",cq.substring(dY,h)}(q)),null===A&&(dY=q),A}function dL(){var k,h,l,j,i;return i=dY,k=cg(),null!==k?(h=cg(),h=null!==h?h:"",null!==h?(l=cg(),l=null!==l?l:"",null!==l?(j=cg(),j=null!==j?j:"",null!==j?k=[k,h,l,j]:(k=null,dY=i)):(k=null,dY=i)):(k=null,dY=i)):(k=null,dY=i),k}function cA(){var k,i,j,h;return h=dY,k=dL(),null!==k?(58===cq.charCodeAt(dY)?(i=":",dY++):(i=null,0===aJ&&cj('":"')),null!==i?(j=dL(),null!==j?k=[k,i,j]:(k=null,dY=h)):(k=null,dY=h)):(k=null,dY=h),null===k&&(k=a4()),k}function a4(){var n,v,h,k,m,j,s,q,p;return q=dY,p=dY,n=b2(),null!==n?(46===cq.charCodeAt(dY)?(v=".",dY++):(v=null,0===aJ&&cj('"."')),null!==v?(h=b2(),null!==h?(46===cq.charCodeAt(dY)?(k=".",dY++):(k=null,0===aJ&&cj('"."')),null!==k?(m=b2(),null!==m?(46===cq.charCodeAt(dY)?(j=".",dY++):(j=null,0===aJ&&cj('"."')),null!==j?(s=b2(),null!==s?n=[n,v,h,k,m,j,s]:(n=null,dY=p)):(n=null,dY=p)):(n=null,dY=p)):(n=null,dY=p)):(n=null,dY=p)):(n=null,dY=p)):(n=null,dY=p),null!==n&&(n=function(i){return aW.host_type="IPv4",cq.substring(dY,i)}(q)),null===n&&(dY=q),n}function b2(){var k,i,j,h;return h=dY,"25"===cq.substr(dY,2)?(k="25",dY+=2):(k=null,0===aJ&&cj('"25"')),null!==k?(/^[0-5]/.test(cq.charAt(dY))?(i=cq.charAt(dY),dY++):(i=null,0===aJ&&cj("[0-5]")),null!==i?k=[k,i]:(k=null,dY=h)):(k=null,dY=h),null===k&&(h=dY,50===cq.charCodeAt(dY)?(k="2",dY++):(k=null,0===aJ&&cj('"2"')),null!==k?(/^[0-4]/.test(cq.charAt(dY))?(i=cq.charAt(dY),dY++):(i=null,0===aJ&&cj("[0-4]")),null!==i?(j=cB(),null!==j?k=[k,i,j]:(k=null,dY=h)):(k=null,dY=h)):(k=null,dY=h),null===k&&(h=dY,49===cq.charCodeAt(dY)?(k="1",dY++):(k=null,0===aJ&&cj('"1"')),null!==k?(i=cB(),null!==i?(j=cB(),null!==j?k=[k,i,j]:(k=null,dY=h)):(k=null,dY=h)):(k=null,dY=h),null===k&&(h=dY,/^[1-9]/.test(cq.charAt(dY))?(k=cq.charAt(dY),dY++):(k=null,0===aJ&&cj("[1-9]")),null!==k?(i=cB(),null!==i?k=[k,i]:(k=null,dY=h)):(k=null,dY=h),null===k&&(k=cB())))),k}function b7(){var m,i,q,k,j,h,p;return h=dY,p=dY,m=cB(),m=null!==m?m:"",null!==m?(i=cB(),i=null!==i?i:"",null!==i?(q=cB(),q=null!==q?q:"",null!==q?(k=cB(),k=null!==k?k:"",null!==k?(j=cB(),j=null!==j?j:"",null!==j?m=[m,i,q,k,j]:(m=null,dY=p)):(m=null,dY=p)):(m=null,dY=p)):(m=null,dY=p)):(m=null,dY=p),null!==m&&(m=function(n,l){return l=parseInt(l.join("")),aW.port=l,l}(h,m)),null===m&&(dY=h),m}function bB(){var k,i,j,h;for(k=[],h=dY,59===cq.charCodeAt(dY)?(i=";",dY++):(i=null,0===aJ&&cj('";"')),null!==i?(j=dS(),null!==j?i=[i,j]:(i=null,dY=h)):(i=null,dY=h);null!==i;){k.push(i),h=dY,59===cq.charCodeAt(dY)?(i=";",dY++):(i=null,0===aJ&&cj('";"')),null!==i?(j=dS(),null!==j?i=[i,j]:(i=null,dY=h)):(i=null,dY=h)}return k}function dS(){var h;return h=bi(),null===h&&(h=dU(),null===h&&(h=ah(),null===h&&(h=aG(),null===h&&(h=a2(),null===h&&(h=aa(),null===h&&(h=bz())))))),h}function bi(){var k,i,j,h;return j=dY,h=dY,"transport="===cq.substr(dY,10).toLowerCase()?(k=cq.substr(dY,10),dY+=10):(k=null,0===aJ&&cj('"transport="')),null!==k?("udp"===cq.substr(dY,3).toLowerCase()?(i=cq.substr(dY,3),dY+=3):(i=null,0===aJ&&cj('"udp"')),null===i&&("tcp"===cq.substr(dY,3).toLowerCase()?(i=cq.substr(dY,3),dY+=3):(i=null,0===aJ&&cj('"tcp"')),null===i&&("sctp"===cq.substr(dY,4).toLowerCase()?(i=cq.substr(dY,4),dY+=4):(i=null,0===aJ&&cj('"sctp"')),null===i&&("tls"===cq.substr(dY,3).toLowerCase()?(i=cq.substr(dY,3),dY+=3):(i=null,0===aJ&&cj('"tls"')),null===i&&(i=cd())))),null!==i?k=[k,i]:(k=null,dY=h)):(k=null,dY=h),null!==k&&(k=function(m,l){aW.uri_params||(aW.uri_params={}),aW.uri_params.transport=l.toLowerCase()}(j,k[1])),null===k&&(dY=j),k}function dU(){var k,i,j,h;return j=dY,h=dY,"user="===cq.substr(dY,5).toLowerCase()?(k=cq.substr(dY,5),dY+=5):(k=null,0===aJ&&cj('"user="')),null!==k?("phone"===cq.substr(dY,5).toLowerCase()?(i=cq.substr(dY,5),dY+=5):(i=null,0===aJ&&cj('"phone"')),null===i&&("ip"===cq.substr(dY,2).toLowerCase()?(i=cq.substr(dY,2),dY+=2):(i=null,0===aJ&&cj('"ip"')),null===i&&(i=cd())),null!==i?k=[k,i]:(k=null,dY=h)):(k=null,dY=h),null!==k&&(k=function(m,l){aW.uri_params||(aW.uri_params={}),aW.uri_params.user=l.toLowerCase()}(j,k[1])),null===k&&(dY=j),k}function ah(){var k,i,j,h;return j=dY,h=dY,"method="===cq.substr(dY,7).toLowerCase()?(k=cq.substr(dY,7),dY+=7):(k=null,0===aJ&&cj('"method="')),null!==k?(i=aI(),null!==i?k=[k,i]:(k=null,dY=h)):(k=null,dY=h),null!==k&&(k=function(m,l){aW.uri_params||(aW.uri_params={}),aW.uri_params.method=l}(j,k[1])),null===k&&(dY=j),k}function aG(){var k,i,j,h;return j=dY,h=dY,"ttl="===cq.substr(dY,4).toLowerCase()?(k=cq.substr(dY,4),dY+=4):(k=null,0===aJ&&cj('"ttl="')),null!==k?(i=ay(),null!==i?k=[k,i]:(k=null,dY=h)):(k=null,dY=h),null!==k&&(k=function(m,l){aW.params||(aW.params={}),aW.params.ttl=l}(j,k[1])),null===k&&(dY=j),k}function a2(){var k,i,j,h;return j=dY,h=dY,"maddr="===cq.substr(dY,6).toLowerCase()?(k=cq.substr(dY,6),dY+=6):(k=null,0===aJ&&cj('"maddr="')),null!==k?(i=bG(),null!==i?k=[k,i]:(k=null,dY=h)):(k=null,dY=h),null!==k&&(k=function(m,l){aW.uri_params||(aW.uri_params={}),aW.uri_params.maddr=l}(j,k[1])),null===k&&(dY=j),k}function aa(){var n,k,m,h,j,p;return h=dY,j=dY,"lr"===cq.substr(dY,2).toLowerCase()?(n=cq.substr(dY,2),dY+=2):(n=null,0===aJ&&cj('"lr"')),null!==n?(p=dY,61===cq.charCodeAt(dY)?(k="=",dY++):(k=null,0===aJ&&cj('"="')),null!==k?(m=cd(),null!==m?k=[k,m]:(k=null,dY=p)):(k=null,dY=p),k=null!==k?k:"",null!==k?n=[n,k]:(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(i){aW.uri_params||(aW.uri_params={}),aW.uri_params.lr=void 0}(h)),null===n&&(dY=h),n}function bz(){var n,k,m,h,j,p;return h=dY,j=dY,n=aB(),null!==n?(p=dY,61===cq.charCodeAt(dY)?(k="=",dY++):(k=null,0===aJ&&cj('"="')),null!==k?(m=dV(),null!==m?k=[k,m]:(k=null,dY=p)):(k=null,dY=p),k=null!==k?k:"",null!==k?n=[n,k]:(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(l,i,o){aW.uri_params||(aW.uri_params={}),o="undefined"==typeof o?void 0:o[1],aW.uri_params[i.toLowerCase()]=o&&o.toLowerCase()}(h,n[0],n[1])),null===n&&(dY=h),n}function aB(){var i,h,j;if(j=dY,h=aq(),null!==h){for(i=[];null!==h;){i.push(h),h=aq()}}else{i=null}return null!==i&&(i=function(l,k){return k.join("")}(j,i)),null===i&&(dY=j),i}function dV(){var i,h,j;if(j=dY,h=aq(),null!==h){for(i=[];null!==h;){i.push(h),h=aq()}}else{i=null}return null!==i&&(i=function(l,k){return k.join("")}(j,i)),null===i&&(dY=j),i}function aq(){var h;return h=df(),null===h&&(h=cE(),null===h&&(h=cN())),h}function df(){var h;return 91===cq.charCodeAt(dY)?(h="[",dY++):(h=null,0===aJ&&cj('"["')),null===h&&(93===cq.charCodeAt(dY)?(h="]",dY++):(h=null,0===aJ&&cj('"]"')),null===h&&(47===cq.charCodeAt(dY)?(h="/",dY++):(h=null,0===aJ&&cj('"/"')),null===h&&(58===cq.charCodeAt(dY)?(h=":",dY++):(h=null,0===aJ&&cj('":"')),null===h&&(38===cq.charCodeAt(dY)?(h="&",dY++):(h=null,0===aJ&&cj('"&"')),null===h&&(43===cq.charCodeAt(dY)?(h="+",dY++):(h=null,0===aJ&&cj('"+"')),null===h&&(36===cq.charCodeAt(dY)?(h="$",dY++):(h=null,0===aJ&&cj('"$"')))))))),h}function au(){var p,m,n,h,k,q,j;if(q=dY,63===cq.charCodeAt(dY)?(p="?",dY++):(p=null,0===aJ&&cj('"?"')),null!==p){if(m=dx(),null!==m){for(n=[],j=dY,38===cq.charCodeAt(dY)?(h="&",dY++):(h=null,0===aJ&&cj('"&"')),null!==h?(k=dx(),null!==k?h=[h,k]:(h=null,dY=j)):(h=null,dY=j);null!==h;){n.push(h),j=dY,38===cq.charCodeAt(dY)?(h="&",dY++):(h=null,0===aJ&&cj('"&"')),null!==h?(k=dx(),null!==k?h=[h,k]:(h=null,dY=j)):(h=null,dY=j)}null!==n?p=[p,m,n]:(p=null,dY=q)}else{p=null,dY=q}}else{p=null,dY=q}return p}function dx(){var n,k,m,h,j;return h=dY,j=dY,n=bl(),null!==n?(61===cq.charCodeAt(dY)?(k="=",dY++):(k=null,0===aJ&&cj('"="')),null!==k?(m=aO(),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(l,i,o){i=i.join("").toLowerCase(),o=o.join(""),aW.uri_headers||(aW.uri_headers={}),aW.uri_headers[i]?aW.uri_headers[i].push(o):aW.uri_headers[i]=[o]}(h,n[0],n[2])),null===n&&(dY=h),n}function bl(){var i,h;if(h=dE(),null===h&&(h=cE(),null===h&&(h=cN())),null!==h){for(i=[];null!==h;){i.push(h),h=dE(),null===h&&(h=cE(),null===h&&(h=cN()))}}else{i=null}return i}function aO(){var i,h;for(i=[],h=dE(),null===h&&(h=cE(),null===h&&(h=cN()));null!==h;){i.push(h),h=dE(),null===h&&(h=cE(),null===h&&(h=cN()))}return i}function dE(){var h;return 91===cq.charCodeAt(dY)?(h="[",dY++):(h=null,0===aJ&&cj('"["')),null===h&&(93===cq.charCodeAt(dY)?(h="]",dY++):(h=null,0===aJ&&cj('"]"')),null===h&&(47===cq.charCodeAt(dY)?(h="/",dY++):(h=null,0===aJ&&cj('"/"')),null===h&&(63===cq.charCodeAt(dY)?(h="?",dY++):(h=null,0===aJ&&cj('"?"')),null===h&&(58===cq.charCodeAt(dY)?(h=":",dY++):(h=null,0===aJ&&cj('":"')),null===h&&(43===cq.charCodeAt(dY)?(h="+",dY++):(h=null,0===aJ&&cj('"+"')),null===h&&(36===cq.charCodeAt(dY)?(h="$",dY++):(h=null,0===aJ&&cj('"$"')))))))),h}function a6(){var h;return h=cs(),null===h&&(h=ac()),h}function ac(){var m,i,o,k,j,h;return h=dY,m=aI(),null!==m?(i=cH(),null!==i?(o=bE(),null!==o?(k=cH(),null!==k?(j=du(),null!==j?m=[m,i,o,k,j]:(m=null,dY=h)):(m=null,dY=h)):(m=null,dY=h)):(m=null,dY=h)):(m=null,dY=h),m}function bE(){var h;return h=cS(),null===h&&(h=aS()),h}function aS(){var k,i,j,h;return h=dY,k=cV(),null!==k?(58===cq.charCodeAt(dY)?(i=":",dY++):(i=null,0===aJ&&cj('":"')),null!==i?(j=bR(),null===j&&(j=dQ()),null!==j?k=[k,i,j]:(k=null,dY=h)):(k=null,dY=h)):(k=null,dY=h),k}function bR(){var n,k,m,h,j;return h=dY,n=bT(),null===n&&(n=ao()),null!==n?(j=dY,63===cq.charCodeAt(dY)?(k="?",dY++):(k=null,0===aJ&&cj('"?"')),null!==k?(m=bW(),null!==m?k=[k,m]:(k=null,dY=j)):(k=null,dY=j),k=null!==k?k:"",null!==k?n=[n,k]:(n=null,dY=h)):(n=null,dY=h),n}function bT(){var k,i,j,h;return h=dY,"//"===cq.substr(dY,2)?(k="//",dY+=2):(k=null,0===aJ&&cj('"//"')),null!==k?(i=bJ(),null!==i?(j=ao(),j=null!==j?j:"",null!==j?k=[k,i,j]:(k=null,dY=h)):(k=null,dY=h)):(k=null,dY=h),k}function ao(){var j,h,i;return i=dY,47===cq.charCodeAt(dY)?(j="/",dY++):(j=null,0===aJ&&cj('"/"')),null!==j?(h=aD(),null!==h?j=[j,h]:(j=null,dY=i)):(j=null,dY=i),j}function dQ(){var j,h,k,i;if(i=dY,j=al(),null!==j){for(h=[],k=d3();null!==k;){h.push(k),k=d3()}null!==h?j=[j,h]:(j=null,dY=i)}else{j=null,dY=i}return j}function d3(){var h;return h=cu(),null===h&&(h=cE(),null===h&&(h=cN())),h}function al(){var h;return h=cE(),null===h&&(h=cN(),null===h&&(59===cq.charCodeAt(dY)?(h=";",dY++):(h=null,0===aJ&&cj('";"')),null===h&&(63===cq.charCodeAt(dY)?(h="?",dY++):(h=null,0===aJ&&cj('"?"')),null===h&&(58===cq.charCodeAt(dY)?(h=":",dY++):(h=null,0===aJ&&cj('":"')),null===h&&(64===cq.charCodeAt(dY)?(h="@",dY++):(h=null,0===aJ&&cj('"@"')),null===h&&(38===cq.charCodeAt(dY)?(h="&",dY++):(h=null,0===aJ&&cj('"&"')),null===h&&(61===cq.charCodeAt(dY)?(h="=",dY++):(h=null,0===aJ&&cj('"="')),null===h&&(43===cq.charCodeAt(dY)?(h="+",dY++):(h=null,0===aJ&&cj('"+"')),null===h&&(36===cq.charCodeAt(dY)?(h="$",dY++):(h=null,0===aJ&&cj('"$"')),null===h&&(44===cq.charCodeAt(dY)?(h=",",dY++):(h=null,0===aJ&&cj('","')))))))))))),h}function aD(){var n,k,m,h,j,p;if(j=dY,n=ch(),null!==n){for(k=[],p=dY,47===cq.charCodeAt(dY)?(m="/",dY++):(m=null,0===aJ&&cj('"/"')),null!==m?(h=ch(),null!==h?m=[m,h]:(m=null,dY=p)):(m=null,dY=p);null!==m;){k.push(m),p=dY,47===cq.charCodeAt(dY)?(m="/",dY++):(m=null,0===aJ&&cj('"/"')),null!==m?(h=ch(),null!==h?m=[m,h]:(m=null,dY=p)):(m=null,dY=p)}null!==k?n=[n,k]:(n=null,dY=j)}else{n=null,dY=j}return n}function ch(){var n,k,m,h,j,p;for(j=dY,n=[],k=bg();null!==k;){n.push(k),k=bg()}if(null!==n){for(k=[],p=dY,59===cq.charCodeAt(dY)?(m=";",dY++):(m=null,0===aJ&&cj('";"')),null!==m?(h=dG(),null!==h?m=[m,h]:(m=null,dY=p)):(m=null,dY=p);null!==m;){k.push(m),p=dY,59===cq.charCodeAt(dY)?(m=";",dY++):(m=null,0===aJ&&cj('";"')),null!==m?(h=dG(),null!==h?m=[m,h]:(m=null,dY=p)):(m=null,dY=p)}null!==k?n=[n,k]:(n=null,dY=j)}else{n=null,dY=j}return n}function dG(){var i,h;for(i=[],h=bg();null!==h;){i.push(h),h=bg()}return i}function bg(){var h;return h=cE(),null===h&&(h=cN(),null===h&&(58===cq.charCodeAt(dY)?(h=":",dY++):(h=null,0===aJ&&cj('":"')),null===h&&(64===cq.charCodeAt(dY)?(h="@",dY++):(h=null,0===aJ&&cj('"@"')),null===h&&(38===cq.charCodeAt(dY)?(h="&",dY++):(h=null,0===aJ&&cj('"&"')),null===h&&(61===cq.charCodeAt(dY)?(h="=",dY++):(h=null,0===aJ&&cj('"="')),null===h&&(43===cq.charCodeAt(dY)?(h="+",dY++):(h=null,0===aJ&&cj('"+"')),null===h&&(36===cq.charCodeAt(dY)?(h="$",dY++):(h=null,0===aJ&&cj('"$"')),null===h&&(44===cq.charCodeAt(dY)?(h=",",dY++):(h=null,0===aJ&&cj('","')))))))))),h}function cV(){var m,j,k,h,i;if(h=dY,i=dY,m=cp(),null!==m){for(j=[],k=cp(),null===k&&(k=cB(),null===k&&(43===cq.charCodeAt(dY)?(k="+",dY++):(k=null,0===aJ&&cj('"+"')),null===k&&(45===cq.charCodeAt(dY)?(k="-",dY++):(k=null,0===aJ&&cj('"-"')),null===k&&(46===cq.charCodeAt(dY)?(k=".",dY++):(k=null,0===aJ&&cj('"."'))))));null!==k;){j.push(k),k=cp(),null===k&&(k=cB(),null===k&&(43===cq.charCodeAt(dY)?(k="+",dY++):(k=null,0===aJ&&cj('"+"')),null===k&&(45===cq.charCodeAt(dY)?(k="-",dY++):(k=null,0===aJ&&cj('"-"')),null===k&&(46===cq.charCodeAt(dY)?(k=".",dY++):(k=null,0===aJ&&cj('"."'))))))}null!==j?m=[m,j]:(m=null,dY=i)}else{m=null,dY=i}return null!==m&&(m=function(l){aW.scheme=cq.substring(dY,l)}(h)),null===m&&(dY=h),m}function bJ(){var h;return h=b5(),null===h&&(h=cL()),h}function b5(){var k,i,j,h;return j=dY,h=dY,k=cP(),null!==k?(64===cq.charCodeAt(dY)?(i="@",dY++):(i=null,0===aJ&&cj('"@"')),null!==i?k=[k,i]:(k=null,dY=h)):(k=null,dY=h),k=null!==k?k:"",null!==k?(i=dA(),null!==i?k=[k,i]:(k=null,dY=j)):(k=null,dY=j),k=null!==k?k:""}function cL(){var i,h;if(h=cE(),null===h&&(h=cN(),null===h&&(36===cq.charCodeAt(dY)?(h="$",dY++):(h=null,0===aJ&&cj('"$"')),null===h&&(44===cq.charCodeAt(dY)?(h=",",dY++):(h=null,0===aJ&&cj('","')),null===h&&(59===cq.charCodeAt(dY)?(h=";",dY++):(h=null,0===aJ&&cj('";"')),null===h&&(58===cq.charCodeAt(dY)?(h=":",dY++):(h=null,0===aJ&&cj('":"')),null===h&&(64===cq.charCodeAt(dY)?(h="@",dY++):(h=null,0===aJ&&cj('"@"')),null===h&&(38===cq.charCodeAt(dY)?(h="&",dY++):(h=null,0===aJ&&cj('"&"')),null===h&&(61===cq.charCodeAt(dY)?(h="=",dY++):(h=null,0===aJ&&cj('"="')),null===h&&(43===cq.charCodeAt(dY)?(h="+",dY++):(h=null,0===aJ&&cj('"+"'))))))))))),null!==h){for(i=[];null!==h;){i.push(h),h=cE(),null===h&&(h=cN(),null===h&&(36===cq.charCodeAt(dY)?(h="$",dY++):(h=null,0===aJ&&cj('"$"')),null===h&&(44===cq.charCodeAt(dY)?(h=",",dY++):(h=null,0===aJ&&cj('","')),null===h&&(59===cq.charCodeAt(dY)?(h=";",dY++):(h=null,0===aJ&&cj('";"')),null===h&&(58===cq.charCodeAt(dY)?(h=":",dY++):(h=null,0===aJ&&cj('":"')),null===h&&(64===cq.charCodeAt(dY)?(h="@",dY++):(h=null,0===aJ&&cj('"@"')),null===h&&(38===cq.charCodeAt(dY)?(h="&",dY++):(h=null,0===aJ&&cj('"&"')),null===h&&(61===cq.charCodeAt(dY)?(h="=",dY++):(h=null,0===aJ&&cj('"="')),null===h&&(43===cq.charCodeAt(dY)?(h="+",dY++):(h=null,0===aJ&&cj('"+"')))))))))))}}else{i=null}return i}function bW(){var i,h;for(i=[],h=d3();null!==h;){i.push(h),h=d3()}return i}function du(){var n,k,m,i,p,j,h,q;if(h=dY,q=dY,"sip"===cq.substr(dY,3).toLowerCase()?(n=cq.substr(dY,3),dY+=3):(n=null,0===aJ&&cj('"SIP"')),null!==n){if(47===cq.charCodeAt(dY)?(k="/",dY++):(k=null,0===aJ&&cj('"/"')),null!==k){if(i=cB(),null!==i){for(m=[];null!==i;){m.push(i),i=cB()}}else{m=null}if(null!==m){if(46===cq.charCodeAt(dY)?(i=".",dY++):(i=null,0===aJ&&cj('"."')),null!==i){if(j=cB(),null!==j){for(p=[];null!==j;){p.push(j),j=cB()}}else{p=null}null!==p?n=[n,k,m,i,p]:(n=null,dY=q)}else{n=null,dY=q}}else{n=null,dY=q}}else{n=null,dY=q}}else{n=null,dY=q}return null!==n&&(n=function(l){aW.sip_version=cq.substring(dY,l)}(h)),null===n&&(dY=h),n}function bu(){var h;return"INVITE"===cq.substr(dY,6)?(h="INVITE",dY+=6):(h=null,0===aJ&&cj('"INVITE"')),h}function aF(){var h;return"ACK"===cq.substr(dY,3)?(h="ACK",dY+=3):(h=null,0===aJ&&cj('"ACK"')),h}function bH(){var h;return"OPTIONS"===cq.substr(dY,7)?(h="OPTIONS",dY+=7):(h=null,0===aJ&&cj('"OPTIONS"')),h}function a0(){var h;return"BYE"===cq.substr(dY,3)?(h="BYE",dY+=3):(h=null,0===aJ&&cj('"BYE"')),h}function c6(){var h;return"CANCEL"===cq.substr(dY,6)?(h="CANCEL",dY+=6):(h=null,0===aJ&&cj('"CANCEL"')),h}function bx(){var h;return"REGISTER"===cq.substr(dY,8)?(h="REGISTER",dY+=8):(h=null,0===aJ&&cj('"REGISTER"')),h}function bd(){var h;return"SUBSCRIBE"===cq.substr(dY,9)?(h="SUBSCRIBE",dY+=9):(h=null,0===aJ&&cj('"SUBSCRIBE"')),h}function dX(){var h;return"NOTIFY"===cq.substr(dY,6)?(h="NOTIFY",dY+=6):(h=null,0===aJ&&cj('"NOTIFY"')),h}function aI(){var i,h;return h=dY,i=bu(),null===i&&(i=aF(),null===i&&(i=bH(),null===i&&(i=a0(),null===i&&(i=c6(),null===i&&(i=bx(),null===i&&(i=bd(),null===i&&(i=dX(),null===i&&(i=cd())))))))),null!==i&&(i=function(j){return aW.method=cq.substring(dY,j),aW.method}(h)),null===i&&(dY=h),i}function cs(){var m,i,o,k,j,h;return h=dY,m=du(),null!==m?(i=cH(),null!==i?(o=aM(),null!==o?(k=cH(),null!==k?(j=ca(),null!==j?m=[m,i,o,k,j]:(m=null,dY=h)):(m=null,dY=h)):(m=null,dY=h)):(m=null,dY=h)):(m=null,dY=h),m}function aM(){var i,h;return h=dY,i=dC(),null!==i&&(i=function(k,j){aW.status_code=parseInt(j.join(""))}(h,i)),null===i&&(dY=h),i}function dC(){var j,h,k,i;return i=dY,j=cB(),null!==j?(h=cB(),null!==h?(k=cB(),null!==k?j=[j,h,k]:(j=null,dY=i)):(j=null,dY=i)):(j=null,dY=i),j}function ca(){var j,h,i;for(i=dY,j=[],h=cu(),null===h&&(h=cE(),null===h&&(h=cN(),null===h&&(h=b9(),null===h&&(h=c1(),null===h&&(h=cH(),null===h&&(h=co()))))));null!==h;){j.push(h),h=cu(),null===h&&(h=cE(),null===h&&(h=cN(),null===h&&(h=b9(),null===h&&(h=c1(),null===h&&(h=cH(),null===h&&(h=co()))))))}return null!==j&&(j=function(k){aW.reason_phrase=cq.substring(dY,k)}(i)),null===j&&(dY=i),j}function aV(){var m,i,o,k,j,h;if(j=dY,m=dq(),null!==m){for(i=[],h=dY,o=cx(),null!==o?(k=dq(),null!==k?o=[o,k]:(o=null,dY=h)):(o=null,dY=h);null!==o;){i.push(o),h=dY,o=cx(),null!==o?(k=dq(),null!==k?o=[o,k]:(o=null,dY=h)):(o=null,dY=h)}null!==i?m=[m,i]:(m=null,dY=j)}else{m=null,dY=j}return m}function bU(){var n,k,m,h,j,p;return h=dY,j=dY,n=ds(),null!==n?(p=dY,64===cq.charCodeAt(dY)?(k="@",dY++):(k=null,0===aJ&&cj('"@"')),null!==k?(m=ds(),null!==m?k=[k,m]:(k=null,dY=p)):(k=null,dY=p),k=null!==k?k:"",null!==k?n=[n,k]:(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(i){aW=cq.substring(dY,i)}(h)),null===n&&(dY=h),n}function bZ(){var p,k,q,o,m,h,j;if(m=dY,p=cW(),null===p){if(h=dY,p=bq(),null!==p){for(k=[],j=dY,q=cx(),null!==q?(o=bq(),null!==o?q=[q,o]:(q=null,dY=j)):(q=null,dY=j);null!==q;){k.push(q),j=dY,q=cx(),null!==q?(o=bq(),null!==o?q=[q,o]:(q=null,dY=j)):(q=null,dY=j)}null!==k?p=[p,k]:(p=null,dY=h)}else{p=null,dY=h}}return null!==p&&(p=function(l){var i,r;for(r=aW.multi_header.length,i=0;r>i;i++){if(null===aW.multi_header[i].parsed){aW=null;break}}aW=null!==aW?aW.multi_header:-1}(m)),null===p&&(dY=m),p}function bq(){var p,k,q,o,m,h,j;if(m=dY,h=dY,p=dg(),null===p&&(p=dI()),null!==p){for(k=[],j=dY,q=dj(),null!==q?(o=dN(),null!==o?q=[q,o]:(q=null,dY=j)):(q=null,dY=j);null!==q;){k.push(q),j=dY,q=dj(),null!==q?(o=dN(),null!==o?q=[q,o]:(q=null,dY=j)):(q=null,dY=j)}null!==k?p=[p,k]:(p=null,dY=h)}else{p=null,dY=h}return null!==p&&(p=function(l){var i;aW.multi_header||(aW.multi_header=[]);try{i=new cc(aW.uri,aW.display_name,aW.params),delete aW.uri,delete aW.display_name,delete aW.params}catch(r){i=null}aW.multi_header.push({possition:dY,offset:l,parsed:i})}(m)),null===p&&(dY=m),p}function dI(){var k,h,l,j,i;return i=dY,k=a9(),k=null!==k?k:"",null!==k?(h=cl(),null!==h?(l=cS(),null!==l?(j=db(),null!==j?k=[k,h,l,j]:(k=null,dY=i)):(k=null,dY=i)):(k=null,dY=i)):(k=null,dY=i),k}function a9(){var p,k,n,m,h,j,q;if(h=dY,j=dY,p=cd(),null!==p){for(k=[],q=dY,n=cf(),null!==n?(m=cd(),null!==m?n=[n,m]:(n=null,dY=q)):(n=null,dY=q);null!==n;){k.push(n),q=dY,n=cf(),null!==n?(m=cd(),null!==m?n=[n,m]:(n=null,dY=q)):(n=null,dY=q)}null!==k?p=[p,k]:(p=null,dY=j)}else{p=null,dY=j}return null===p&&(p=dw()),null!==p&&(p=function(l,i){i=cq.substring(dY,l).trim(),'"'===i[0]&&(i=i.substring(1,i.length-1)),aW.display_name=i}(h,p)),null===p&&(dY=h),p}function dN(){var h;return h=t(),null===h&&(h=aA(),null===h&&(h=bp())),h}function t(){var n,k,m,h,j;return h=dY,j=dY,"q"===cq.substr(dY,1).toLowerCase()?(n=cq.substr(dY,1),dY++):(n=null,0===aJ&&cj('"q"')),null!==n?(k=cb(),null!==k?(m=d1(),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(l,i){aW.params||(aW.params={}),aW.params.q=i}(h,n[2])),null===n&&(dY=h),n}function aA(){var n,k,m,h,j;return h=dY,j=dY,"expires"===cq.substr(dY,7).toLowerCase()?(n=cq.substr(dY,7),dY+=7):(n=null,0===aJ&&cj('"expires"')),null!==n?(k=cb(),null!==k?(m=aU(),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(l,i){aW.params||(aW.params={}),aW.params.expires=i}(h,n[2])),null===n&&(dY=h),n}function aU(){var i,h,j;if(j=dY,h=cB(),null!==h){for(i=[];null!==h;){i.push(h),h=cB()}}else{i=null}return null!==i&&(i=function(l,k){return parseInt(k.join(""))}(j,i)),null===i&&(dY=j),i}function d1(){var n,k,m,i,p,j,h,q;return j=dY,h=dY,48===cq.charCodeAt(dY)?(n="0",dY++):(n=null,0===aJ&&cj('"0"')),null!==n?(q=dY,46===cq.charCodeAt(dY)?(k=".",dY++):(k=null,0===aJ&&cj('"."')),null!==k?(m=cB(),m=null!==m?m:"",null!==m?(i=cB(),i=null!==i?i:"",null!==i?(p=cB(),p=null!==p?p:"",null!==p?k=[k,m,i,p]:(k=null,dY=q)):(k=null,dY=q)):(k=null,dY=q)):(k=null,dY=q),k=null!==k?k:"",null!==k?n=[n,k]:(n=null,dY=h)):(n=null,dY=h),null!==n&&(n=function(l){return parseFloat(cq.substring(dY,l))}(j)),null===n&&(dY=j),n}function bp(){var m,i,o,k,j,h;return k=dY,j=dY,m=cd(),null!==m?(h=dY,i=cb(),null!==i?(o=av(),null!==o?i=[i,o]:(i=null,dY=h)):(i=null,dY=h),i=null!==i?i:"",null!==i?m=[m,i]:(m=null,dY=j)):(m=null,dY=j),null!==m&&(m=function(p,l,q){aW.params||(aW.params={}),q="undefined"==typeof q?void 0:q[1],aW.params[l.toLowerCase()]=q}(k,m[0],m[1])),null===m&&(dY=k),m}function av(){var h;return h=cd(),null===h&&(h=bG(),null===h&&(h=dw())),h}function dO(){var m,i,o,k,j,h;if(j=dY,m=aj(),null!==m){for(i=[],h=dY,o=dj(),null!==o?(k=cQ(),null!==k?o=[o,k]:(o=null,dY=h)):(o=null,dY=h);null!==o;){i.push(o),h=dY,o=dj(),null!==o?(k=cQ(),null!==k?o=[o,k]:(o=null,dY=h)):(o=null,dY=h)}null!==i?m=[m,i]:(m=null,dY=j)}else{m=null,dY=j}return m}function aj(){var h;return"render"===cq.substr(dY,6).toLowerCase()?(h=cq.substr(dY,6),dY+=6):(h=null,0===aJ&&cj('"render"')),null===h&&("session"===cq.substr(dY,7).toLowerCase()?(h=cq.substr(dY,7),dY+=7):(h=null,0===aJ&&cj('"session"')),null===h&&("icon"===cq.substr(dY,4).toLowerCase()?(h=cq.substr(dY,4),dY+=4):(h=null,0===aJ&&cj('"icon"')),null===h&&("alert"===cq.substr(dY,5).toLowerCase()?(h=cq.substr(dY,5),dY+=5):(h=null,0===aJ&&cj('"alert"')),null===h&&(h=cd())))),h}function cQ(){var h;return h=ak(),null===h&&(h=bp()),h}function ak(){var k,i,j,h;return h=dY,"handling"===cq.substr(dY,8).toLowerCase()?(k=cq.substr(dY,8),dY+=8):(k=null,0===aJ&&cj('"handling"')),null!==k?(i=cb(),null!==i?("optional"===cq.substr(dY,8).toLowerCase()?(j=cq.substr(dY,8),dY+=8):(j=null,0===aJ&&cj('"optional"')),null===j&&("required"===cq.substr(dY,8).toLowerCase()?(j=cq.substr(dY,8),dY+=8):(j=null,0===aJ&&cj('"required"')),null===j&&(j=cd())),null!==j?k=[k,i,j]:(k=null,dY=h)):(k=null,dY=h)):(k=null,dY=h),k}function c3(){var m,i,o,k,j,h;if(j=dY,m=cd(),null!==m){for(i=[],h=dY,o=cx(),null!==o?(k=cd(),null!==k?o=[o,k]:(o=null,dY=h)):(o=null,dY=h);null!==o;){i.push(o),h=dY,o=cx(),null!==o?(k=cd(),null!==k?o=[o,k]:(o=null,dY=h)):(o=null,dY=h)}null!==i?m=[m,i]:(m=null,dY=j)}else{m=null,dY=j}return m}function bc(){var i,h,j;if(j=dY,h=cB(),null!==h){for(i=[];null!==h;){i.push(h),h=cB()}}else{i=null}return null!==i&&(i=function(l,k){aW=parseInt(k.join(""))}(j,i)),null===i&&(dY=j),i}function aH(){var i,h;return h=dY,i=dm(),null!==i&&(i=function(j){aW=cq.substring(dY,j)}(h)),null===i&&(dY=h),i}function dm(){var q,k,v,p,m,h,j,u;if(j=dY,q=aZ(),null!==q){if(k=c5(),null!==k){if(v=bM(),null!==v){for(p=[],u=dY,m=dj(),null!==m?(h=af(),null!==h?m=[m,h]:(m=null,dY=u)):(m=null,dY=u);null!==m;){p.push(m),u=dY,m=dj(),null!==m?(h=af(),null!==h?m=[m,h]:(m=null,dY=u)):(m=null,dY=u)}null!==p?q=[q,k,v,p]:(q=null,dY=j)}else{q=null,dY=j}}else{q=null,dY=j}}else{q=null,dY=j}return q}function aZ(){var h;return h=d2(),null===h&&(h=bw()),h}function d2(){var h;return"text"===cq.substr(dY,4).toLowerCase()?(h=cq.substr(dY,4),dY+=4):(h=null,0===aJ&&cj('"text"')),null===h&&("image"===cq.substr(dY,5).toLowerCase()?(h=cq.substr(dY,5),dY+=5):(h=null,0===aJ&&cj('"image"')),null===h&&("audio"===cq.substr(dY,5).toLowerCase()?(h=cq.substr(dY,5),dY+=5):(h=null,0===aJ&&cj('"audio"')),null===h&&("video"===cq.substr(dY,5).toLowerCase()?(h=cq.substr(dY,5),dY+=5):(h=null,0===aJ&&cj('"video"')),null===h&&("application"===cq.substr(dY,11).toLowerCase()?(h=cq.substr(dY,11),dY+=11):(h=null,0===aJ&&cj('"application"')),null===h&&(h=aL()))))),h}function bw(){var h;return"message"===cq.substr(dY,7).toLowerCase()?(h=cq.substr(dY,7),dY+=7):(h=null,0===aJ&&cj('"message"')),null===h&&("multipart"===cq.substr(dY,9).toLowerCase()?(h=cq.substr(dY,9),dY+=9):(h=null,0===aJ&&cj('"multipart"')),null===h&&(h=aL())),h}function aL(){var h;return h=cd(),null===h&&(h=bL()),h}function bL(){var j,h,i;return i=dY,"x-"===cq.substr(dY,2).toLowerCase()?(j=cq.substr(dY,2),dY+=2):(j=null,0===aJ&&cj('"x-"')),null!==j?(h=cd(),null!==h?j=[j,h]:(j=null,dY=i)):(j=null,dY=i),j}function bM(){var h;return h=aL(),null===h&&(h=cd()),h}function af(){var j,h,k,i;return i=dY,j=cd(),null!==j?(h=cb(),null!==h?(k=dH(),null!==k?j=[j,h,k]:(j=null,dY=i)):(j=null,dY=i)):(j=null,dY=i),j}function dH(){var h;return h=cd(),null===h&&(h=dw()),h}function dW(){var j,h,k,i;return i=dY,j=ad(),null!==j?(h=cf(),null!==h?(k=aI(),null!==k?j=[j,h,k]:(j=null,dY=i)):(j=null,dY=i)):(j=null,dY=i),j}function ad(){var i,h,j;if(j=dY,h=cB(),null!==h){for(i=[];null!==h;){i.push(h),h=cB()}}else{i=null}return null!==i&&(i=function(l,k){aW.value=parseInt(k.join(""))}(j,i)),null===i&&(dY=j),i}function aw(){var i,h;return h=dY,i=aU(),null!==i&&(i=function(k,j){aW=j}(h,i)),null===i&&(dY=h),i}function b4(){var p,k,q,o,m,h,j;if(m=dY,h=dY,p=dq(),null!==p){for(k=[],j=dY,q=dj(),null!==q?(o=bp(),null!==o?q=[q,o]:(q=null,dY=j)):(q=null,dY=j);null!==q;){k.push(q),j=dY,q=dj(),null!==q?(o=bp(),null!==o?q=[q,o]:(q=null,dY=j)):(q=null,dY=j)}null!==k?p=[p,k]:(p=null,dY=h)}else{p=null,dY=h}return null!==p&&(p=function(l,i){aW.event=i.join("").toLowerCase()}(m,p[0])),null===p&&(dY=m),p}function dq(){var n,k,m,h,j,p;if(j=dY,n=di(),null!==n){for(k=[],p=dY,46===cq.charCodeAt(dY)?(m=".",dY++):(m=null,0===aJ&&cj('"."')),null!==m?(h=di(),null!==h?m=[m,h]:(m=null,dY=p)):(m=null,dY=p);null!==m;){k.push(m),p=dY,46===cq.charCodeAt(dY)?(m=".",dY++):(m=null,0===aJ&&cj('"."')),null!==m?(h=di(),null!==h?m=[m,h]:(m=null,dY=p)):(m=null,dY=p)}null!==k?n=[n,k]:(n=null,dY=j)}else{n=null,dY=j}return n}function a8(){var p,k,q,o,m,h,j;if(m=dY,h=dY,p=dg(),null===p&&(p=dI()),null!==p){for(k=[],j=dY,q=dj(),null!==q?(o=cG(),null!==o?q=[q,o]:(q=null,dY=j)):(q=null,dY=j);null!==q;){k.push(q),j=dY,q=dj(),null!==q?(o=cG(),null!==o?q=[q,o]:(q=null,dY=j)):(q=null,dY=j)}null!==k?p=[p,k]:(p=null,dY=h)}else{p=null,dY=h}return null!==p&&(p=function(l){var i=aW.tag;try{aW=new cc(aW.uri,aW.display_name,aW.params),i&&aW.setParam("tag",i)}catch(r){aW=-1}}(m)),null===p&&(dY=m),p}function cG(){var h;return h=bD(),null===h&&(h=bp()),h}function bD(){var n,k,m,h,j;return h=dY,j=dY,"tag"===cq.substr(dY,3).toLowerCase()?(n=cq.substr(dY,3),dY+=3):(n=null,0===aJ&&cj('"tag"')),null!==n?(k=cb(),null!==k?(m=cd(),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(l,i){aW.tag=i}(h,n[2])),null===n&&(dY=h),n}function bY(){var i,h,j;if(j=dY,h=cB(),null!==h){for(i=[];null!==h;){i.push(h),h=cB()}}else{i=null}return null!==i&&(i=function(l,k){aW=parseInt(k.join(""))}(j,i)),null===i&&(dY=j),i}function cm(){var i,h;return h=dY,i=aU(),null!==i&&(i=function(k,j){aW=j}(h,i)),null===i&&(dY=h),i}function bQ(){var q,x,k,h,y,m,p,j,w,v;for(j=dY,w=dY,q=[],x=a9();null!==x;){q.push(x),x=a9()}if(null!==q){if(x=cl(),null!==x){if(k=cS(),null!==k){if(h=db(),null!==h){for(y=[],v=dY,m=dj(),null!==m?(p=bp(),null!==p?m=[m,p]:(m=null,dY=v)):(m=null,dY=v);null!==m;){y.push(m),v=dY,m=dj(),null!==m?(p=bp(),null!==p?m=[m,p]:(m=null,dY=v)):(m=null,dY=v)}null!==y?q=[q,x,k,h,y]:(q=null,dY=w)}else{q=null,dY=w}}else{q=null,dY=w}}else{q=null,dY=w}}else{q=null,dY=w}return null!==q&&(q=function(l){try{aW=new cc(aW.uri,aW.display_name,aW.params)}catch(i){aW=-1}}(j)),null===q&&(dY=j),q}function cZ(){var h;return h=bk()}function bk(){var q,n,p,j,m,s,k,h;if(k=dY,"digest"===cq.substr(dY,6).toLowerCase()?(q=cq.substr(dY,6),dY+=6):(q=null,0===aJ&&cj('"Digest"')),null!==q){if(n=cf(),null!==n){if(p=a5(),null!==p){for(j=[],h=dY,m=cx(),null!==m?(s=a5(),null!==s?m=[m,s]:(m=null,dY=h)):(m=null,dY=h);null!==m;){j.push(m),h=dY,m=cx(),null!==m?(s=a5(),null!==s?m=[m,s]:(m=null,dY=h)):(m=null,dY=h)}null!==j?q=[q,n,p,j]:(q=null,dY=k)}else{q=null,dY=k}}else{q=null,dY=k}}else{q=null,dY=k}return null===q&&(q=az()),q}function az(){var q,k,v,p,m,h,j,u;if(j=dY,q=cd(),null!==q){if(k=cf(),null!==k){if(v=bK(),null!==v){for(p=[],u=dY,m=cx(),null!==m?(h=bK(),null!==h?m=[m,h]:(m=null,dY=u)):(m=null,dY=u);null!==m;){p.push(m),u=dY,m=cx(),null!==m?(h=bK(),null!==h?m=[m,h]:(m=null,dY=u)):(m=null,dY=u)}null!==p?q=[q,k,v,p]:(q=null,dY=j)}else{q=null,dY=j}}else{q=null,dY=j}}else{q=null,dY=j}return q}function bK(){var j,h,k,i;return i=dY,j=cd(),null!==j?(h=cb(),null!==h?(k=cd(),null===k&&(k=dw()),null!==k?j=[j,h,k]:(j=null,dY=i)):(j=null,dY=i)):(j=null,dY=i),j}function a5(){var h;return h=dh(),null===h&&(h=bj(),null===h&&(h=cC(),null===h&&(h=dF(),null===h&&(h=ci(),null===h&&(h=aY(),null===h&&(h=bX(),null===h&&(h=bK()))))))),h}function dh(){var k,i,j,h;return h=dY,"realm"===cq.substr(dY,5).toLowerCase()?(k=cq.substr(dY,5),dY+=5):(k=null,0===aJ&&cj('"realm"')),null!==k?(i=cb(),null!==i?(j=bC(),null!==j?k=[k,i,j]:(k=null,dY=h)):(k=null,dY=h)):(k=null,dY=h),k}function bC(){var i,h;return h=dY,i=cU(),null!==i&&(i=function(k,j){aW.realm=j}(h,i)),null===i&&(dY=h),i}function bj(){var n,v,h,k,m,j,s,q,p;if(q=dY,"domain"===cq.substr(dY,6).toLowerCase()?(n=cq.substr(dY,6),dY+=6):(n=null,0===aJ&&cj('"domain"')),null!==n){if(v=cb(),null!==v){if(h=dl(),null!==h){if(k=d0(),null!==k){if(m=[],p=dY,s=cH(),null!==s){for(j=[];null!==s;){j.push(s),s=cH()}}else{j=null}for(null!==j?(s=d0(),null!==s?j=[j,s]:(j=null,dY=p)):(j=null,dY=p);null!==j;){if(m.push(j),p=dY,s=cH(),null!==s){for(j=[];null!==s;){j.push(s),s=cH()}}else{j=null}null!==j?(s=d0(),null!==s?j=[j,s]:(j=null,dY=p)):(j=null,dY=p)}null!==m?(j=cz(),null!==j?n=[n,v,h,k,m,j]:(n=null,dY=q)):(n=null,dY=q)}else{n=null,dY=q}}else{n=null,dY=q}}else{n=null,dY=q}}else{n=null,dY=q}return n}function d0(){var h;return h=aS(),null===h&&(h=ao()),h}function cC(){var k,i,j,h;return h=dY,"nonce"===cq.substr(dY,5).toLowerCase()?(k=cq.substr(dY,5),dY+=5):(k=null,0===aJ&&cj('"nonce"')),null!==k?(i=cb(),null!==i?(j=aR(),null!==j?k=[k,i,j]:(k=null,dY=h)):(k=null,dY=h)):(k=null,dY=h),k}function aR(){var i,h;return h=dY,i=cU(),null!==i&&(i=function(k,j){aW.nonce=j}(h,i)),null===i&&(dY=h),i}function dF(){var n,k,m,h,j;return h=dY,j=dY,"opaque"===cq.substr(dY,6).toLowerCase()?(n=cq.substr(dY,6),dY+=6):(n=null,0===aJ&&cj('"opaque"')),null!==n?(k=cb(),null!==k?(m=cU(),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(l,i){aW.opaque=i}(h,n[2])),null===n&&(dY=h),n}function ci(){var n,k,m,h,j;return h=dY,"stale"===cq.substr(dY,5).toLowerCase()?(n=cq.substr(dY,5),dY+=5):(n=null,0===aJ&&cj('"stale"')),null!==n?(k=cb(),null!==k?(j=dY,"true"===cq.substr(dY,4).toLowerCase()?(m=cq.substr(dY,4),dY+=4):(m=null,0===aJ&&cj('"true"')),null!==m&&(m=function(i){aW.stale=!0}(j)),null===m&&(dY=j),null===m&&(j=dY,"false"===cq.substr(dY,5).toLowerCase()?(m=cq.substr(dY,5),dY+=5):(m=null,0===aJ&&cj('"false"')),null!==m&&(m=function(i){aW.stale=!1}(j)),null===m&&(dY=j)),null!==m?n=[n,k,m]:(n=null,dY=h)):(n=null,dY=h)):(n=null,dY=h),n}function aY(){var n,k,m,h,j;return h=dY,j=dY,"algorithm"===cq.substr(dY,9).toLowerCase()?(n=cq.substr(dY,9),dY+=9):(n=null,0===aJ&&cj('"algorithm"')),null!==n?(k=cb(),null!==k?("md5"===cq.substr(dY,3).toLowerCase()?(m=cq.substr(dY,3),dY+=3):(m=null,0===aJ&&cj('"MD5"')),null===m&&("md5-sess"===cq.substr(dY,8).toLowerCase()?(m=cq.substr(dY,8),dY+=8):(m=null,0===aJ&&cj('"MD5-sess"')),null===m&&(m=cd())),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(l,i){aW.algorithm=i.toUpperCase()}(h,n[2])),null===n&&(dY=h),n}function bX(){var q,x,j,m,n,k,w,v,s,p;if(v=dY,"qop"===cq.substr(dY,3).toLowerCase()?(q=cq.substr(dY,3),dY+=3):(q=null,0===aJ&&cj('"qop"')),null!==q){if(x=cb(),null!==x){if(j=dl(),null!==j){if(s=dY,m=b3(),null!==m){for(n=[],p=dY,44===cq.charCodeAt(dY)?(k=",",dY++):(k=null,0===aJ&&cj('","')),null!==k?(w=b3(),null!==w?k=[k,w]:(k=null,dY=p)):(k=null,dY=p);null!==k;){n.push(k),p=dY,44===cq.charCodeAt(dY)?(k=",",dY++):(k=null,0===aJ&&cj('","')),null!==k?(w=b3(),null!==w?k=[k,w]:(k=null,dY=p)):(k=null,dY=p)}null!==n?m=[m,n]:(m=null,dY=s)}else{m=null,dY=s}null!==m?(n=cz(),null!==n?q=[q,x,j,m,n]:(q=null,dY=v)):(q=null,dY=v)}else{q=null,dY=v}}else{q=null,dY=v}}else{q=null,dY=v}return q}function b3(){var i,h;return h=dY,"auth-int"===cq.substr(dY,8).toLowerCase()?(i=cq.substr(dY,8),dY+=8):(i=null,0===aJ&&cj('"auth-int"')),null===i&&("auth"===cq.substr(dY,4).toLowerCase()?(i=cq.substr(dY,4),dY+=4):(i=null,0===aJ&&cj('"auth"')),null===i&&(i=cd())),null!==i&&(i=function(k,j){aW.qop||(aW.qop=[]),aW.qop.push(j.toLowerCase())}(h,i)),null===i&&(dY=h),i}function bv(){var m,i,o,k,j,h;if(j=dY,m=cd(),null!==m){for(i=[],h=dY,o=cx(),null!==o?(k=cd(),null!==k?o=[o,k]:(o=null,dY=h)):(o=null,dY=h);null!==o;){i.push(o),h=dY,o=cx(),null!==o?(k=cd(),null!==k?o=[o,k]:(o=null,dY=h)):(o=null,dY=h)}null!==i?m=[m,i]:(m=null,dY=j)}else{m=null,dY=j}return m}function dM(){var p,k,q,o,m,h,j;if(m=dY,h=dY,p=bb(),null!==p){for(k=[],j=dY,q=cx(),null!==q?(o=bb(),null!==o?q=[q,o]:(q=null,dY=j)):(q=null,dY=j);null!==q;){k.push(q),j=dY,q=cx(),null!==q?(o=bb(),null!==o?q=[q,o]:(q=null,dY=j)):(q=null,dY=j)}null!==k?p=[p,k]:(p=null,dY=h)}else{p=null,dY=h}return null!==p&&(p=function(l){var i,r;for(r=aW.multi_header.length,i=0;r>i;i++){if(null===aW.multi_header[i].parsed){aW=null;break}}aW=null!==aW?aW.multi_header:-1}(m)),null===p&&(dY=m),p}function bb(){var p,k,q,o,m,h,j;if(m=dY,h=dY,p=dI(),null!==p){for(k=[],j=dY,q=dj(),null!==q?(o=bp(),null!==o?q=[q,o]:(q=null,dY=j)):(q=null,dY=j);null!==q;){k.push(q),j=dY,q=dj(),null!==q?(o=bp(),null!==o?q=[q,o]:(q=null,dY=j)):(q=null,dY=j)}null!==k?p=[p,k]:(p=null,dY=h)}else{p=null,dY=h}return null!==p&&(p=function(l){var i;aW.multi_header||(aW.multi_header=[]);try{i=new cc(aW.uri,aW.display_name,aW.params),delete aW.uri,delete aW.display_name,delete aW.params}catch(r){i=null}aW.multi_header.push({possition:dY,offset:l,parsed:i})}(m)),null===p&&(dY=m),p}function dR(){var m,i,o,k,j,h;if(j=dY,m=cd(),null!==m){for(i=[],h=dY,o=cx(),null!==o?(k=cd(),null!==k?o=[o,k]:(o=null,dY=h)):(o=null,dY=h);null!==o;){i.push(o),h=dY,o=cx(),null!==o?(k=cd(),null!==k?o=[o,k]:(o=null,dY=h)):(o=null,dY=h)}null!==i?m=[m,i]:(m=null,dY=j)}else{m=null,dY=j}return m}function ab(){var m,i,o,k,j,h;if(j=dY,m=aE(),null!==m){for(i=[],h=dY,o=cx(),null!==o?(k=aE(),null!==k?o=[o,k]:(o=null,dY=h)):(o=null,dY=h);null!==o;){i.push(o),h=dY,o=cx(),null!==o?(k=aE(),null!==k?o=[o,k]:(o=null,dY=h)):(o=null,dY=h)}null!==i?m=[m,i]:(m=null,dY=j)}else{m=null,dY=j}return m}function aE(){var m,i,o,k,j,h;if(j=dY,m=dI(),null!==m){for(i=[],h=dY,o=dj(),null!==o?(k=bp(),null!==k?o=[o,k]:(o=null,dY=h)):(o=null,dY=h);null!==o;){i.push(o),h=dY,o=dj(),null!==o?(k=bp(),null!==k?o=[o,k]:(o=null,dY=h)):(o=null,dY=h)}null!==i?m=[m,i]:(m=null,dY=j)}else{m=null,dY=j}return m}function aX(){var m,i,o,k,j,h;if(j=dY,m=d4(),null!==m){for(i=[],h=dY,o=dj(),null!==o?(k=bs(),null!==k?o=[o,k]:(o=null,dY=h)):(o=null,dY=h);null!==o;){i.push(o),h=dY,o=dj(),null!==o?(k=bs(),null!==k?o=[o,k]:(o=null,dY=h)):(o=null,dY=h)}null!==i?m=[m,i]:(m=null,dY=j)}else{m=null,dY=j}return m}function d4(){var i,h;return h=dY,"active"===cq.substr(dY,6).toLowerCase()?(i=cq.substr(dY,6),dY+=6):(i=null,0===aJ&&cj('"active"')),null===i&&("pending"===cq.substr(dY,7).toLowerCase()?(i=cq.substr(dY,7),dY+=7):(i=null,0===aJ&&cj('"pending"')),null===i&&("terminated"===cq.substr(dY,10).toLowerCase()?(i=cq.substr(dY,10),dY+=10):(i=null,0===aJ&&cj('"terminated"')),null===i&&(i=cd()))),null!==i&&(i=function(j){aW.state=cq.substring(dY,j)}(h)),null===i&&(dY=h),i}function bs(){var n,k,m,h,j;return h=dY,j=dY,"reason"===cq.substr(dY,6).toLowerCase()?(n=cq.substr(dY,6),dY+=6):(n=null,0===aJ&&cj('"reason"')),null!==n?(k=cb(),null!==k?(m=ax(),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(l,i){"undefined"!=typeof i&&(aW.reason=i)}(h,n[2])),null===n&&(dY=h),null===n&&(h=dY,j=dY,"expires"===cq.substr(dY,7).toLowerCase()?(n=cq.substr(dY,7),dY+=7):(n=null,0===aJ&&cj('"expires"')),null!==n?(k=cb(),null!==k?(m=aU(),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(l,i){"undefined"!=typeof i&&(aW.expires=i)}(h,n[2])),null===n&&(dY=h),null===n&&(h=dY,j=dY,"retry_after"===cq.substr(dY,11).toLowerCase()?(n=cq.substr(dY,11),dY+=11):(n=null,0===aJ&&cj('"retry_after"')),null!==n?(k=cb(),null!==k?(m=aU(),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(l,i){"undefined"!=typeof i&&(aW.retry_after=i)}(h,n[2])),null===n&&(dY=h),null===n&&(n=bp()))),n}function ax(){var h;return"deactivated"===cq.substr(dY,11).toLowerCase()?(h=cq.substr(dY,11),dY+=11):(h=null,0===aJ&&cj('"deactivated"')),null===h&&("probation"===cq.substr(dY,9).toLowerCase()?(h=cq.substr(dY,9),dY+=9):(h=null,0===aJ&&cj('"probation"')),null===h&&("rejected"===cq.substr(dY,8).toLowerCase()?(h=cq.substr(dY,8),dY+=8):(h=null,0===aJ&&cj('"rejected"')),null===h&&("timeout"===cq.substr(dY,7).toLowerCase()?(h=cq.substr(dY,7),dY+=7):(h=null,0===aJ&&cj('"timeout"')),null===h&&("giveup"===cq.substr(dY,6).toLowerCase()?(h=cq.substr(dY,6),dY+=6):(h=null,0===aJ&&cj('"giveup"')),null===h&&("noresource"===cq.substr(dY,10).toLowerCase()?(h=cq.substr(dY,10),dY+=10):(h=null,0===aJ&&cj('"noresource"')),null===h&&("invariant"===cq.substr(dY,9).toLowerCase()?(h=cq.substr(dY,9),dY+=9):(h=null,0===aJ&&cj('"invariant"')),null===h&&(h=cd()))))))),h}function dT(){var h;return h=dy(),h=null!==h?h:""}function am(){var m,i,o,k,j,h;if(j=dY,m=cd(),null!==m){for(i=[],h=dY,o=cx(),null!==o?(k=cd(),null!==k?o=[o,k]:(o=null,dY=h)):(o=null,dY=h);null!==o;){i.push(o),h=dY,o=cx(),null!==o?(k=cd(),null!==k?o=[o,k]:(o=null,dY=h)):(o=null,dY=h)}null!==i?m=[m,i]:(m=null,dY=j)}else{m=null,dY=j}return m=null!==m?m:""}function cX(){var p,k,q,o,m,h,j;if(m=dY,h=dY,p=dg(),null===p&&(p=dI()),null!==p){for(k=[],j=dY,q=dj(),null!==q?(o=ap(),null!==o?q=[q,o]:(q=null,dY=j)):(q=null,dY=j);null!==q;){k.push(q),j=dY,q=dj(),null!==q?(o=ap(),null!==o?q=[q,o]:(q=null,dY=j)):(q=null,dY=j)}null!==k?p=[p,k]:(p=null,dY=h)}else{p=null,dY=h}return null!==p&&(p=function(l){var i=aW.tag;try{aW=new cc(aW.uri,aW.display_name,aW.params),i&&aW.setParam("tag",i)}catch(r){aW=-1}}(m)),null===p&&(dY=m),p}function ap(){var h;return h=bD(),null===h&&(h=bp()),h}function dc(){var m,i,o,k,j,h;if(j=dY,m=bh(),null!==m){for(i=[],h=dY,o=cx(),null!==o?(k=bh(),null!==k?o=[o,k]:(o=null,dY=h)):(o=null,dY=h);null!==o;){i.push(o),h=dY,o=cx(),null!==o?(k=bh(),null!==k?o=[o,k]:(o=null,dY=h)):(o=null,dY=h)}null!==i?m=[m,i]:(m=null,dY=j)}else{m=null,dY=j}return m}function bh(){var q,k,v,p,m,h,j,u;if(j=dY,q=bN(),null!==q){if(k=cf(),null!==k){if(v=dK(),null!==v){for(p=[],u=dY,m=dj(),null!==m?(h=aK(),null!==h?m=[m,h]:(m=null,dY=u)):(m=null,dY=u);null!==m;){p.push(m),u=dY,m=dj(),null!==m?(h=aK(),null!==h?m=[m,h]:(m=null,dY=u)):(m=null,dY=u)}null!==p?q=[q,k,v,p]:(q=null,dY=j)}else{q=null,dY=j}}else{q=null,dY=j}}else{q=null,dY=j}return q}function aK(){var h;return h=dz(),null===h&&(h=a3(),null===h&&(h=d6(),null===h&&(h=bA(),null===h&&(h=aP(),null===h&&(h=bp()))))),h}function dz(){var n,k,m,h,j;return h=dY,j=dY,"ttl"===cq.substr(dY,3).toLowerCase()?(n=cq.substr(dY,3),dY+=3):(n=null,0===aJ&&cj('"ttl"')),null!==n?(k=cb(),null!==k?(m=ay(),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(l,i){aW.ttl=i}(h,n[2])),null===n&&(dY=h),n}function a3(){var n,k,m,h,j;return h=dY,j=dY,"maddr"===cq.substr(dY,5).toLowerCase()?(n=cq.substr(dY,5),dY+=5):(n=null,0===aJ&&cj('"maddr"')),null!==n?(k=cb(),null!==k?(m=bG(),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(l,i){aW.maddr=i}(h,n[2])),null===n&&(dY=h),n}function d6(){var n,k,m,h,j;return h=dY,j=dY,"received"===cq.substr(dY,8).toLowerCase()?(n=cq.substr(dY,8),dY+=8):(n=null,0===aJ&&cj('"received"')),null!==n?(k=cb(),null!==k?(m=a4(),null===m&&(m=aT()),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(l,i){aW.received=i}(h,n[2])),null===n&&(dY=h),n}function bA(){var n,k,m,h,j;return h=dY,j=dY,"branch"===cq.substr(dY,6).toLowerCase()?(n=cq.substr(dY,6),dY+=6):(n=null,0===aJ&&cj('"branch"')),null!==n?(k=cb(),null!==k?(m=cd(),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(l,i){aW.branch=i}(h,n[2])),null===n&&(dY=h),n}function aP(){var n,k,m,i,p,j,h;if(p=dY,j=dY,"rport"===cq.substr(dY,5).toLowerCase()?(n=cq.substr(dY,5),dY+=5):(n=null,0===aJ&&cj('"rport"')),null!==n){if(h=dY,k=cb(),null!==k){for(m=[],i=cB();null!==i;){m.push(i),i=cB()}null!==m?k=[k,m]:(k=null,dY=h)}else{k=null,dY=h}k=null!==k?k:"",null!==k?n=[n,k]:(n=null,dY=j)}else{n=null,dY=j}return null!==n&&(n=function(l){"undefined"!=typeof response_port&&(aW.rport=response_port.join(""))}(p)),null===n&&(dY=p),n}function bN(){var m,i,o,k,j,h;return h=dY,m=bP(),null!==m?(i=c5(),null!==i?(o=cd(),null!==o?(k=c5(),null!==k?(j=ai(),null!==j?m=[m,i,o,k,j]:(m=null,dY=h)):(m=null,dY=h)):(m=null,dY=h)):(m=null,dY=h)):(m=null,dY=h),m}function bP(){var i,h;return h=dY,"sip"===cq.substr(dY,3).toLowerCase()?(i=cq.substr(dY,3),dY+=3):(i=null,0===aJ&&cj('"SIP"')),null===i&&(i=cd()),null!==i&&(i=function(k,j){aW.protocol=j}(h,i)),null===i&&(dY=h),i}function ai(){var i,h;return h=dY,"udp"===cq.substr(dY,3).toLowerCase()?(i=cq.substr(dY,3),dY+=3):(i=null,0===aJ&&cj('"UDP"')),null===i&&("tcp"===cq.substr(dY,3).toLowerCase()?(i=cq.substr(dY,3),dY+=3):(i=null,0===aJ&&cj('"TCP"')),null===i&&("tls"===cq.substr(dY,3).toLowerCase()?(i=cq.substr(dY,3),dY+=3):(i=null,0===aJ&&cj('"TLS"')),null===i&&("sctp"===cq.substr(dY,4).toLowerCase()?(i=cq.substr(dY,4),dY+=4):(i=null,0===aJ&&cj('"SCTP"')),null===i&&(i=cd())))),null!==i&&(i=function(k,j){aW.transport=j}(h,i)),null===i&&(dY=h),i}function dK(){var k,h,l,j,i;return j=dY,k=dZ(),null!==k?(i=dY,h=dk(),null!==h?(l=ag(),null!==l?h=[h,l]:(h=null,dY=i)):(h=null,dY=i),h=null!==h?h:"",null!==h?k=[k,h]:(k=null,dY=j)):(k=null,dY=j),k}function dZ(){var i,h;return h=dY,i=a4(),null===i&&(i=cO(),null===i&&(i=bo())),null!==i&&(i=function(j){aW.host=cq.substring(dY,j)}(h)),null===i&&(dY=h),i}function ag(){var m,i,q,k,j,h,p;return h=dY,p=dY,m=cB(),m=null!==m?m:"",null!==m?(i=cB(),i=null!==i?i:"",null!==i?(q=cB(),q=null!==q?q:"",null!==q?(k=cB(),k=null!==k?k:"",null!==k?(j=cB(),j=null!==j?j:"",null!==j?m=[m,i,q,k,j]:(m=null,dY=p)):(m=null,dY=p)):(m=null,dY=p)):(m=null,dY=p)):(m=null,dY=p),null!==m&&(m=function(n,l){aW.port=parseInt(l.join(""))}(h,m)),null===m&&(dY=h),m}function ay(){var k,h,l,j,i;return j=dY,i=dY,k=cB(),null!==k?(h=cB(),h=null!==h?h:"",null!==h?(l=cB(),l=null!==l?l:"",null!==l?k=[k,h,l]:(k=null,dY=i)):(k=null,dY=i)):(k=null,dY=i),null!==k&&(k=function(n,m){return parseInt(m.join(""))}(j,k)),null===k&&(dY=j),k}function b6(){var h;return h=bk()}function dB(){var m,i,o,k,j,h;if(j=dY,m=ba(),null!==m){for(i=[],h=dY,o=dj(),null!==o?(k=cM(),null!==k?o=[o,k]:(o=null,dY=h)):(o=null,dY=h);null!==o;){i.push(o),h=dY,o=dj(),null!==o?(k=cM(),null!==k?o=[o,k]:(o=null,dY=h)):(o=null,dY=h)}null!==i?m=[m,i]:(m=null,dY=j)}else{m=null,dY=j}return m}function ba(){var i,h;return h=dY,i=aU(),null!==i&&(i=function(k,j){aW.expires=j}(h,i)),null===i&&(dY=h),i}function cM(){var h;return h=bF(),null===h&&(h=bp()),h}function bF(){var n,k,m,h,j;return h=dY,j=dY,"refresher"===cq.substr(dY,9).toLowerCase()?(n=cq.substr(dY,9),dY+=9):(n=null,0===aJ&&cj('"refresher"')),null!==n?(k=cb(),null!==k?("uac"===cq.substr(dY,3).toLowerCase()?(m=cq.substr(dY,3),dY+=3):(m=null,0===aJ&&cj('"uac"')),null===m&&("uas"===cq.substr(dY,3).toLowerCase()?(m=cq.substr(dY,3),dY+=3):(m=null,0===aJ&&cj('"uas"'))),null!==m?n=[n,k,m]:(n=null,dY=j)):(n=null,dY=j)):(n=null,dY=j),null!==n&&(n=function(l,i){aW.refresher=i.toLowerCase()}(h,n[2])),null===n&&(dY=h),n}function b1(){var j,h,k,i;return i=dY,j=cd(),null!==j?(h=c0(),null!==h?(k=cy(),null!==k?j=[j,h,k]:(j=null,dY=i)):(j=null,dY=i)):(j=null,dY=i),j}function cy(){var i,h;for(i=[],h=dp(),null===h&&(h=c1(),null===h&&(h=cf()));null!==h;){i.push(h),h=dp(),null===h&&(h=c1(),null===h&&(h=cf()))}return i}function bS(){var i,h;for(i=[],h=cI();null!==h;){i.push(h),h=cI()}return i}function c9(){var j,h,i;return i=dY,"uuid:"===cq.substr(dY,5)?(j="uuid:",dY+=5):(j=null,0===aJ&&cj('"uuid:"')),null!==j?(h=bm(),null!==h?j=[j,h]:(j=null,dY=i)):(j=null,dY=i),j}function bm(){var q,y,j,m,n,k,x,w,v,p,s;return p=dY,s=dY,q=bI(),null!==q?(45===cq.charCodeAt(dY)?(y="-",dY++):(y=null,0===aJ&&cj('"-"')),null!==y?(j=aC(),null!==j?(45===cq.charCodeAt(dY)?(m="-",dY++):(m=null,0===aJ&&cj('"-"')),null!==m?(n=aC(),null!==n?(45===cq.charCodeAt(dY)?(k="-",dY++):(k=null,0===aJ&&cj('"-"')),null!==k?(x=aC(),null!==x?(45===cq.charCodeAt(dY)?(w="-",dY++):(w=null,0===aJ&&cj('"-"')),null!==w?(v=a1(),null!==v?q=[q,y,j,m,n,k,x,w,v]:(q=null,dY=s)):(q=null,dY=s)):(q=null,dY=s)):(q=null,dY=s)):(q=null,dY=s)):(q=null,dY=s)):(q=null,dY=s)):(q=null,dY=s)):(q=null,dY=s),null!==q&&(q=function(i,h){aW=cq.substring(dY+5,i)}(p,q[0])),null===q&&(dY=p),q}function aC(){var k,h,l,j,i;return i=dY,k=cg(),null!==k?(h=cg(),null!==h?(l=cg(),null!==l?(j=cg(),null!==j?k=[k,h,l,j]:(k=null,dY=i)):(k=null,dY=i)):(k=null,dY=i)):(k=null,dY=i),k}function bI(){var i,h,j;return j=dY,i=aC(),null!==i?(h=aC(),null!==h?i=[i,h]:(i=null,dY=j)):(i=null,dY=j),i}function a1(){var j,h,k,i;return i=dY,j=aC(),null!==j?(h=aC(),null!==h?(k=aC(),null!==k?j=[j,h,k]:(j=null,dY=i)):(j=null,dY=i)):(j=null,dY=i),j}function c8(j){j.sort();for(var h=null,k=[],i=0;i<j.length;i++){j[i]!==h&&(k.push(j[i]),h=j[i])}return k}function by(){for(var m=1,i=1,k=!1,j=0;j<Math.max(dY,cv);j++){var h=cq.charAt(j);"\n"===h?(k||m++,i=1,k=!1):"\r"===h||"\u2028"===h||"\u2029"===h?(m++,i=1,k=!0):(i++,k=!1)}return{line:m,column:i}}var bf={CRLF:cw,DIGIT:cB,ALPHA:cp,HEXDIG:cg,WSP:cK,OCTET:cI,DQUOTE:cD,SP:cH,HTAB:co,alphanum:cF,reserved:cu,unreserved:cE,mark:cY,escaped:cN,LWS:cf,SWS:dv,HCOLON:c0,TEXT_UTF8_TRIM:dy,TEXT_UTF8char:dp,UTF8_NONASCII:b9,UTF8_CONT:c1,LHEX:cJ,token:cd,token_nodot:di,separators:c7,word:ds,STAR:cW,SLASH:c5,EQUAL:cb,LPAREN:da,RPAREN:c4,RAQUOT:db,LAQUOT:cl,COMMA:cx,SEMI:dj,COLON:dk,LDQUOT:dl,RDQUOT:cz,comment:cT,ctext:b8,quoted_string:dw,quoted_string_clean:cU,qdtext:cR,quoted_pair:dd,SIP_URI_noparams:dg,SIP_URI:cS,uri_scheme:dP,userinfo:cP,user:c2,user_unreserved:bO,password:a7,hostport:dA,host:bG,hostname:bo,domainlabel:d5,toplabel:aQ,IPv6reference:cO,IPv6address:aT,h16:dL,ls32:cA,IPv4address:a4,dec_octet:b2,port:b7,uri_parameters:bB,uri_parameter:dS,transport_param:bi,user_param:dU,method_param:ah,ttl_param:aG,maddr_param:a2,lr_param:aa,other_param:bz,pname:aB,pvalue:dV,paramchar:aq,param_unreserved:df,headers:au,header:dx,hname:bl,hvalue:aO,hnv_unreserved:dE,Request_Response:a6,Request_Line:ac,Request_URI:bE,absoluteURI:aS,hier_part:bR,net_path:bT,abs_path:ao,opaque_part:dQ,uric:d3,uric_no_slash:al,path_segments:aD,segment:ch,param:dG,pchar:bg,scheme:cV,authority:bJ,srvr:b5,reg_name:cL,query:bW,SIP_Version:du,INVITEm:bu,ACKm:aF,OPTIONSm:bH,BYEm:a0,CANCELm:c6,REGISTERm:bx,SUBSCRIBEm:bd,NOTIFYm:dX,Method:aI,Status_Line:cs,Status_Code:aM,extension_code:dC,Reason_Phrase:ca,Allow_Events:aV,Call_ID:bU,Contact:bZ,contact_param:bq,name_addr:dI,display_name:a9,contact_params:dN,c_p_q:t,c_p_expires:aA,delta_seconds:aU,qvalue:d1,generic_param:bp,gen_value:av,Content_Disposition:dO,disp_type:aj,disp_param:cQ,handling_param:ak,Content_Encoding:c3,Content_Length:bc,Content_Type:aH,media_type:dm,m_type:aZ,discrete_type:d2,composite_type:bw,extension_token:aL,x_token:bL,m_subtype:bM,m_parameter:af,m_value:dH,CSeq:dW,CSeq_value:ad,Expires:aw,Event:b4,event_type:dq,From:a8,from_param:cG,tag_param:bD,Max_Forwards:bY,Min_Expires:cm,Name_Addr_Header:bQ,Proxy_Authenticate:cZ,challenge:bk,other_challenge:az,auth_param:bK,digest_cln:a5,realm:dh,realm_value:bC,domain:bj,URI:d0,nonce:cC,nonce_value:aR,opaque:dF,stale:ci,algorithm:aY,qop_options:bX,qop_value:b3,Proxy_Require:bv,Record_Route:dM,rec_route:bb,Require:dR,Route:ab,route_param:aE,Subscription_State:aX,substate_value:d4,subexp_params:bs,event_reason_value:ax,Subject:dT,Supported:am,To:cX,to_param:ap,Via:dc,via_param:bh,via_params:aK,via_ttl:dz,via_maddr:a3,via_received:d6,via_branch:bA,response_port:aP,sent_protocol:bN,protocol_name:bP,transport:ai,sent_by:dK,via_host:dZ,via_port:ag,ttl:ay,WWW_Authenticate:b6,Session_Expires:dB,s_e_expires:ba,s_e_params:cM,s_e_refresher:bF,extension_header:b1,header_value:cy,message_body:bS,uuid_URI:c9,uuid:bm,hex4:aC,hex8:bI,hex12:a1};if(void 0!==ck){if(void 0===bf[ck]){throw new Error("Invalid rule name: "+e(ck)+".")}}else{ck="CRLF"}var dY=0,aJ=0,cv=0,aN=[],dD=d("./URI"),cc=d("./NameAddrHeader"),aW={},bV=bf[ck]();if(null===bV||dY!==cq.length){var b0=Math.max(dY,cv),br=b0<cq.length?cq.charAt(b0):null,dJ=by();return new this.SyntaxError(c8(aN),br,b0,dJ.line,dJ.column),-1}return aW},toSource:function(){return this._source}};return g.SyntaxError=function(o,p,m,k,h){function j(q,t){var l,i;switch(q.length){case 0:l="end of input";break;case 1:l=q[0];break;default:l=q.slice(0,q.length-1).join(", ")+" or "+q[q.length-1]}return i=t?e(t):"end of input","Expected "+l+" but "+i+" found."}this.name="SyntaxError",this.expected=o,this.found=p,this.message=j(o,p),this.offset=m,this.line=k,this.column=h},g.SyntaxError.prototype=Error.prototype,g}()},{"./NameAddrHeader":9,"./URI":21}],7:[function(w,B,k){var f=w("debug")("JsSIP"),C=w("../package.json");f("version %s",C.version);var m=w("rtcninja"),q=w("./Constants"),j=w("./Exceptions"),A=w("./Utils"),z=w("./UA"),y=w("./URI"),v=w("./NameAddrHeader"),x=w("./Grammar"),g=B.exports={C:q,Exceptions:j,Utils:A,UA:z,URI:y,NameAddrHeader:v,Grammar:x,debug:w("debug"),rtcninja:m};Object.defineProperties(g,{name:{get:function(){return C.title}},version:{get:function(){return C.version}}})},{"../package.json":46,"./Constants":1,"./Exceptions":5,"./Grammar":6,"./NameAddrHeader":9,"./UA":20,"./URI":21,"./Utils":22,debug:29,rtcninja:34}],8:[function(p,x,g){function d(c){this.ua=c,this.data={},j.EventEmitter.call(this)}x.exports=d;var y=p("util"),j=p("events"),k=p("./Constants"),f=p("./SIPMessage"),w=p("./Utils"),v=p("./RequestSender"),q=p("./Transactions"),m=p("./Exceptions");y.inherits(d,j.EventEmitter),d.prototype.send=function(B,E,o){var i,F,z,D,C,A=B;if(void 0===B||void 0===E){throw new TypeError("Not enough arguments")}if(B=this.ua.normalizeTarget(B),!B){throw new TypeError("Invalid target: "+A)}o=o||{},C=o.extraHeaders&&o.extraHeaders.slice()||[],D=o.eventHandlers||{},z=o.contentType||"text/plain",this.content_type=z;for(F in D){this.on(F,D[F])}this.closed=!1,this.ua.applicants[this]=this,C.push("Content-Type: "+z),this.request=new f.OutgoingRequest(k.MESSAGE,B,this.ua,null,C),E?(this.request.body=E,this.content=E):this.content=null,i=new v(this,this.ua),this.newMessage("local",this.request),i.send()},d.prototype.receiveResponse=function(h){var c;if(!this.closed){switch(!0){case /^1[0-9]{2}$/.test(h.status_code):break;case /^2[0-9]{2}$/.test(h.status_code):delete this.ua.applicants[this],this.emit("succeeded",{originator:"remote",response:h});break;default:delete this.ua.applicants[this],c=w.sipErrorCause(h.status_code),this.emit("failed",{originator:"remote",response:h,cause:c})}}},d.prototype.onRequestTimeout=function(){this.closed||this.emit("failed",{originator:"system",cause:k.causes.REQUEST_TIMEOUT})},d.prototype.onTransportError=function(){this.closed||this.emit("failed",{originator:"system",cause:k.causes.CONNECTION_ERROR})},d.prototype.close=function(){this.closed=!0,delete this.ua.applicants[this]},d.prototype.init_incoming=function(h){var c;this.request=h,this.content_type=h.getHeader("Content-Type"),this.content=h.body?h.body:null,this.newMessage("remote",h),c=this.ua.transactions.nist[h.via_branch],!c||c.state!==q.C.STATUS_TRYING&&c.state!==q.C.STATUS_PROCEEDING||h.reply(200)},d.prototype.accept=function(h){h=h||{};var c=h.extraHeaders&&h.extraHeaders.slice()||[],i=h.body;if("incoming"!==this.direction){throw new m.NotSupportedError('"accept" not supported for outgoing Message')}this.request.reply(200,null,c,i)},d.prototype.reject=function(l){l=l||{};var c=l.status_code||480,o=l.reason_phrase,i=l.extraHeaders&&l.extraHeaders.slice()||[],h=l.body;if("incoming"!==this.direction){throw new m.NotSupportedError('"reject" not supported for outgoing Message')}if(300>c||c>=700){throw new TypeError("Invalid status_code: "+c)}this.request.reply(c,o,i,h)},d.prototype.newMessage=function(h,c){"remote"===h?(this.direction="incoming",this.local_identity=c.to,this.remote_identity=c.from):"local"===h&&(this.direction="outgoing",this.local_identity=c.from,this.remote_identity=c.to),this.ua.newMessage({originator:h,message:this,request:c})}},{"./Constants":1,"./Exceptions":5,"./RequestSender":15,"./SIPMessage":16,"./Transactions":18,"./Utils":22,events:24,util:28}],9:[function(h,d,i){function g(l,j,m){var k;if(!(l&&l instanceof f)){throw new TypeError('missing or invalid "uri" parameter')}this.uri=l,this.parameters={};for(k in m){this.setParam(k,m[k])}Object.defineProperties(this,{display_name:{get:function(){return j},set:function(n){j=0===n?"0":n}}})}d.exports=g;var f=h("./URI"),c=h("./Grammar");g.prototype={setParam:function(k,j){k&&(this.parameters[k.toLowerCase()]="undefined"==typeof j||null===j?null:j.toString())},getParam:function(j){return j?this.parameters[j.toLowerCase()]:void 0},hasParam:function(j){return j?this.parameters.hasOwnProperty(j.toLowerCase())&&!0||!1:void 0},deleteParam:function(k){var j;return k=k.toLowerCase(),this.parameters.hasOwnProperty(k)?(j=this.parameters[k],delete this.parameters[k],j):void 0},clearParams:function(){this.parameters={}},clone:function(){return new g(this.uri.clone(),this.display_name,JSON.parse(JSON.stringify(this.parameters)))},toString:function(){var k,j;k=this.display_name||0===this.display_name?'"'+this.display_name+'" ':"",k+="<"+this.uri.toString()+">";for(j in this.parameters){k+=";"+j,null!==this.parameters[j]&&(k+="="+this.parameters[j])}return k}},g.parse=function(j){return j=c.parse(j,"Name_Addr_Header"),-1!==j?j:void 0}},{"./Grammar":6,"./URI":21}],10:[function(j,p,f){function c(u,i){var v=i,o=0,l=0;if(u.substring(v,v+2).match(/(^\r\n)/)){return -2}for(;0===o;){if(l=u.indexOf("\r\n",v),-1===l){return l}!u.substring(l+2,l+4).match(/(^\r\n)/)&&u.charAt(l+2).match(/(^\s+)/)?v=l+2:o=l}return o}function q(A,D,w,u){var E,x,y,v,C=D.indexOf(":",w),z=D.substring(w,C).trim(),B=D.substring(C+1,u).trim();switch(z.toLowerCase()){case"via":case"v":A.addHeader("via",B),1===A.getHeaders("via").length?(v=A.parseHeader("Via"),v&&(A.via=v,A.via_branch=v.branch)):v=0;break;case"from":case"f":A.setHeader("from",B),v=A.parseHeader("from"),v&&(A.from=v,A.from_tag=v.getParam("tag"));break;case"to":case"t":A.setHeader("to",B),v=A.parseHeader("to"),v&&(A.to=v,A.to_tag=v.getParam("tag"));break;case"record-route":for(v=m.parse(B,"Record_Route"),-1===v&&(v=void 0),y=v.length,x=0;y>x;x++){E=v[x],A.addHeader("record-route",B.substring(E.possition,E.offset)),A.headers["Record-Route"][A.getHeaders("record-route").length-1].parsed=E.parsed}break;case"call-id":case"i":A.setHeader("call-id",B),v=A.parseHeader("call-id"),v&&(A.call_id=B);break;case"contact":case"m":for(v=m.parse(B,"Contact"),-1===v&&(v=void 0),y=v.length,x=0;y>x;x++){E=v[x],A.addHeader("contact",B.substring(E.possition,E.offset)),A.headers.Contact[A.getHeaders("contact").length-1].parsed=E.parsed}break;case"content-length":case"l":A.setHeader("content-length",B),v=A.parseHeader("content-length");break;case"content-type":case"c":A.setHeader("content-type",B),v=A.parseHeader("content-type");break;case"cseq":A.setHeader("cseq",B),v=A.parseHeader("cseq"),v&&(A.cseq=v.value),A instanceof k.IncomingResponse&&(A.method=v.method);break;case"max-forwards":A.setHeader("max-forwards",B),v=A.parseHeader("max-forwards");break;case"www-authenticate":A.setHeader("www-authenticate",B),v=A.parseHeader("www-authenticate");break;case"proxy-authenticate":A.setHeader("proxy-authenticate",B),v=A.parseHeader("proxy-authenticate");break;case"session-expires":case"x":A.setHeader("session-expires",B),v=A.parseHeader("session-expires"),v&&(A.session_expires=v.expires,A.session_expires_refresher=v.refresher);break;default:A.setHeader(z,B),v=0}return void 0===v?{error:'error parsing header "'+z+'"'}:!0}var g={};p.exports=g;var h=j("debug")("JsSIP:ERROR:Parser");h.log=console.warn.bind(console);var d=j("sdp-transform"),m=j("./Grammar"),k=j("./SIPMessage");g.parseMessage=function(w,z){var s,u,r,y,v,x=0,i=w.indexOf("\r\n");if(-1===i){return void h("parseMessage() | no CRLF found, not a SIP message")}if(u=w.substring(0,i),v=m.parse(u,"Request_Response"),-1===v){return void h('parseMessage() | error parsing first line of SIP message: "'+u+'"')}for(v.status_code?(s=new k.IncomingResponse,s.status_code=v.status_code,s.reason_phrase=v.reason_phrase):(s=new k.IncomingRequest(z),s.method=v.method,s.ruri=v.uri),s.data=w,x=i+2;;){if(i=c(w,x),-2===i){y=x+2;break}if(-1===i){return void v.error("parseMessage() | malformed message")}if(v=q(s,w,x,i),v!==!0){return void h("parseMessage() |",v.error)}x=i+2}return s.hasHeader("content-length")?(r=s.getHeader("content-length"),s.body=w.substr(y,r)):s.body=w.substring(y),s},g.parseSDP=d.parse,g.writeSDP=d.write,g.parseFmtpConfig=d.parseFmtpConfig,g.parsePayloads=d.parsePayloads,g.parseRemoteCandidates=d.parseRemoteCandidates},{"./Grammar":6,"./SIPMessage":16,debug:29,"sdp-transform":40}],11:[function(aT,aE,aK){function aG(c){aN("new"),this.ua=c,this.status=ag.STATUS_NULL,this.dialog=null,this.earlyDialogs={},this.connection=null,this.is_confirmed=!1,this.late_sdp=!1,this.rtcOfferConstraints=null,this.rtcAnswerConstraints=null,this.localMediaStream=null,this.localMediaStreamLocallyGenerated=!1,this.rtcReady=!0,this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},this.direction=null,this.local_identity=null,this.remote_identity=null,this.start_time=null,this.end_time=null,this.tones=null,this.audioMuted=!1,this.videoMuted=!1,this.localHold=!1,this.remoteHold=!1,this.sessionTimers={enabled:this.ua.configuration.session_timers,defaultExpires:aq.SESSION_EXPIRES,currentExpires:null,running:!1,refresher:!1,timer:null},this.data={},aH.EventEmitter.call(this)}function aF(g,c){var h=this,f=ab.T1;this.timers.invite2xxTimer=setTimeout(function d(){h.status===ag.STATUS_WAITING_FOR_ACK&&(g.reply(200,null,["Contact: "+h.contact],c),f<ab.T2&&(f=2*f,f>ab.T2&&(f=ab.T2)),h.timers.invite2xxTimer=setTimeout(d,f))},f)}function aM(){var c=this;this.timers.ackTimer=setTimeout(function(){c.status===ag.STATUS_WAITING_FOR_ACK&&(aN("no ACK received, terminating the session"),clearTimeout(c.timers.invite2xxTimer),aR.call(c,aq.BYE),ai.call(c,"remote",null,aq.causes.NO_ACK))},ab.TIMER_H)}function aP(d,c){var f=this;this.connection=new ap.RTCPeerConnection(d,c),this.connection.onaddstream=function(h,g){f.emit("addstream",{stream:g})},this.connection.onremovestream=function(h,g){f.emit("removestream",{stream:g})},this.connection.oniceconnectionstatechange=function(h,g){f.emit("iceconnetionstatechange",{state:g}),"failed"===g&&f.terminate({cause:aq.causes.RTP_TIMEOUT,status_code:200,reason_phrase:aq.causes.RTP_TIMEOUT})}}function aJ(j,f,k,h){function g(i){d.onicecandidate=function(l,m){m||(d.onicecandidate=null,c.rtcReady=!0,f&&f(d.localDescription.sdp),f=null)},d.setLocalDescription(i,function(){"complete"===d.iceGatheringState&&(c.rtcReady=!0,f&&f(d.localDescription.sdp),f=null)},function(l){c.rtcReady=!0,k&&k(l)})}aN("createLocalDescription()");var c=this,d=this.connection;if(this.rtcReady=!1,"offer"===j){d.createOffer(g,function(i){c.rtcReady=!0,k&&k(i)},h)}else{if("answer"!==j){throw new Error('createLocalDescription() | type must be "offer" or "answer", but "'+j+'" was given')}d.createAnswer(g,function(i){c.rtcReady=!0,k&&k(i)},h)}}function aD(j,f,m){var h,g,c="UAS"===f?j.to_tag:j.from_tag,d="UAS"===f?j.from_tag:j.to_tag,k=j.call_id+c+d;return g=this.earlyDialogs[k],m?g?!0:(g=new al(this,j,f,al.C.STATUS_EARLY),g.error?(aN(g.error),at.call(this,"remote",j,aq.causes.INTERNAL_ERROR),!1):(this.earlyDialogs[k]=g,!0)):g?(g.update(j,f),this.dialog=g,delete this.earlyDialogs[k],!0):(h=new al(this,j,f),h.error?(aN(h.error),at.call(this,"remote",j,aq.causes.INTERNAL_ERROR),!1):(this.dialog=h,!0))}function aX(k){function p(){f(function(c){var e=["Contact: "+m.contact];aC.call(m,k,e),m.late_sdp&&(c=ad.call(m,c)),k.reply(200,null,e,c,function(){m.status=ag.STATUS_WAITING_FOR_ACK,aF.call(m,k,c),aM.call(m)})},function(){k.reply(500)})}function f(h,c){m.late_sdp?aJ.call(m,"offer",h,c,m.rtcOfferConstraints):(m.remoteHold===!0&&j===!1?(m.remoteHold=!1,ah.call(m,"remote")):m.remoteHold===!1&&j===!0&&(m.remoteHold=!0,ac.call(m,"remote")),aJ.call(m,"answer",h,c,m.rtcAnswerConstraints))}aN("receiveReinvite()");var d,g,o,m=this,l=k.getHeader("Content-Type"),j=!1;if(this.emit("reinvite",{request:k}),k.body){if(this.late_sdp=!1,"application/sdp"!==l){return aN("invalid Content-Type"),void k.reply(415)}for(d=ay.parseSDP(k.body),g=0;g<d.media.length;g++){if(o=d.media[g].direction||d.direction||"sendrecv","sendonly"!==o&&"inactive"!==o){j=!1;break}j=!0}this.connection.setRemoteDescription(new ap.RTCSessionDescription({type:"offer",sdp:k.body}),p,function(){k.reply(488)})}else{this.late_sdp=!0,p()}}function aV(k){aN("receiveUpdate()");var g,m,j,h=this,c=k.getHeader("Content-Type"),f=!1;if(this.emit("update",{request:k}),!k.body){var d=[];return aC.call(this,k,d),void k.reply(200,null,d)}if("application/sdp"!==c){return aN("invalid Content-Type"),void k.reply(415)}for(g=ay.parseSDP(k.body),m=0;m<g.media.length;m++){if(j=g.media[m].direction||g.direction||"sendrecv","sendonly"!==j&&"inactive"!==j){f=!1;break}f=!0}this.connection.setRemoteDescription(new ap.RTCSessionDescription({type:"offer",sdp:k.body}),function(){h.remoteHold===!0&&f===!1?(h.remoteHold=!1,ah.call(h,"remote")):h.remoteHold===!1&&f===!0&&(h.remoteHold=!0,ac.call(h,"remote")),aJ.call(h,"answer",function(e){var i=["Contact: "+h.contact];aC.call(h,k,i),k.reply(200,null,i,e)},function(){k.reply(500)})},function(){k.reply(488)},this.rtcAnswerConstraints)}function aQ(h,m,d){function c(i){k.status!==ag.STATUS_TERMINATED&&(k.localMediaStream=i,i&&k.connection.addStream(i),af.call(k,k.request),aJ.call(k,"offer",f,g,m))}function o(){k.status!==ag.STATUS_TERMINATED&&at.call(k,"local",null,aq.causes.USER_DENIED_MEDIA_ACCESS)}function f(i){k.isCanceled||k.status===ag.STATUS_TERMINATED||(k.request.body=i,k.status=ag.STATUS_INVITE_SENT,j.send())}function g(){k.status!==ag.STATUS_TERMINATED&&at.call(k,"system",null,aq.causes.WEBRTC_ERROR)}var k=this,j=new am(k,this.ua);this.receiveResponse=function(i){aU.call(k,i)},d?c(d):h.audio||h.video?(this.localMediaStreamLocallyGenerated=!0,ap.getUserMedia(h,c,o)):c(null)}function aU(f){aN("receiveInviteResponse()");var c,g,d=this;if(this.dialog&&f.status_code>=200&&f.status_code<=299){return this.dialog.id.call_id===f.call_id&&this.dialog.id.local_tag===f.from_tag&&this.dialog.id.remote_tag===f.to_tag?void aR.call(this,aq.ACK):(g=new al(this,f,"UAC"),void 0!==g.error?void aN(g.error):(g.sendRequest({owner:{status:ag.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},aq.ACK),void g.sendRequest({owner:{status:ag.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},aq.BYE)))}if(this.isCanceled){return this.isCanceled=!1,void (f.status_code>=100&&f.status_code<200?this.request.cancel(this.cancelReason):f.status_code>=200&&f.status_code<299&&aL.call(this,f))}if(this.status===ag.STATUS_INVITE_SENT||this.status===ag.STATUS_1XX_RECEIVED){switch(!0){case /^100$/.test(f.status_code):this.status=ag.STATUS_1XX_RECEIVED;break;case /^1[0-9]{2}$/.test(f.status_code):if(!f.to_tag){aN("1xx response received without to tag");break}if(f.hasHeader("contact")&&!aD.call(this,f,"UAC",!0)){break}if(this.status=ag.STATUS_1XX_RECEIVED,aW.call(this,"remote",f),!f.body){break}this.connection.setRemoteDescription(new ap.RTCSessionDescription({type:"pranswer",sdp:f.body}),null,null);break;case /^2[0-9]{2}$/.test(f.status_code):if(this.status=ag.STATUS_CONFIRMED,!f.body){aL.call(this,f,400,aq.causes.MISSING_SDP),at.call(this,"remote",f,aq.causes.BAD_MEDIA_DESCRIPTION);break}if(!aD.call(this,f,"UAC")){break}this.connection.setRemoteDescription(new ap.RTCSessionDescription({type:"answer",sdp:f.body}),function(){au.call(d,f),aB.call(d,"remote",f),aR.call(d,aq.ACK),an.call(d,"local",null)},function(){aL.call(d,f,488,"Not Acceptable Here"),at.call(d,"remote",f,aq.causes.BAD_MEDIA_DESCRIPTION)});break;default:c=av.sipErrorCause(f.status_code),at.call(this,"remote",f,c)}}}function aI(k){function g(i){return j.status===ag.STATUS_TERMINATED||(aR.call(j,aq.ACK),d)?void 0:(au.call(j,i),i.body?"application/sdp"!==i.getHeader("Content-Type")?void m():void j.connection.setRemoteDescription(new ap.RTCSessionDescription({type:"answer",sdp:i.body}),function(){c.succeeded&&c.succeeded(i)},function(){m()}):void m())}function m(i){c.failed&&c.failed(i)}aN("sendReinvite()"),k=k||{};var j=this,h=k.extraHeaders||[],c=k.eventHandlers||{},f=k.rtcOfferConstraints||this.rtcOfferConstraints||null,d=!1;h.push("Contact: "+this.contact),h.push("Content-Type: application/sdp"),this.sessionTimers.running&&h.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+(this.sessionTimers.refresher?"uac":"uas")),aJ.call(this,"offer",function(n){n=ad.call(j,n);var i=new Z(j,aq.INVITE);i.send({extraHeaders:h,body:n,eventHandlers:{onSuccessResponse:function(l){g(l),d=!0},onErrorResponse:function(l){m(l)},onTransportError:function(){j.onTransportError()},onRequestTimeout:function(){j.onRequestTimeout()},onDialogError:function(){j.onDialogError()}}})},function(){m()},f)}function aS(j){function p(c){if(d.status!==ag.STATUS_TERMINATED&&!m){if(au.call(d,c),o){if(!c.body){return void f()}if("application/sdp"!==c.getHeader("Content-Type")){return void f()}d.connection.setRemoteDescription(new ap.RTCSessionDescription({type:"answer",sdp:c.body}),function(){g.succeeded&&g.succeeded(c)},function(){f()})}else{g.succeeded&&g.succeeded(c)}}}function f(c){g.failed&&g.failed(c)}aN("sendUpdate()"),j=j||{};var d=this,q=j.extraHeaders||[],g=j.eventHandlers||{},h=j.rtcOfferConstraints||this.rtcOfferConstraints||null,o=j.sdpOffer||!1,m=!1;if(q.push("Contact: "+this.contact),this.sessionTimers.running&&q.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+(this.sessionTimers.refresher?"uac":"uas")),o){q.push("Content-Type: application/sdp"),aJ.call(this,"offer",function(i){i=ad.call(d,i);var c=new Z(d,aq.UPDATE);c.send({extraHeaders:q,body:i,eventHandlers:{onSuccessResponse:function(l){p(l),m=!0},onErrorResponse:function(l){f(l)},onTransportError:function(){d.onTransportError()},onRequestTimeout:function(){d.onRequestTimeout()},onDialogError:function(){d.onDialogError()}}})},function(){f()},h)}else{var k=new Z(d,aq.UPDATE);k.send({extraHeaders:q,eventHandlers:{onSuccessResponse:function(c){p(c)},onErrorResponse:function(c){f(c)},onTransportError:function(){d.onTransportError()},onRequestTimeout:function(){d.onRequestTimeout()},onDialogError:function(){d.onDialogError()}}})}}function aL(f,c,g){aN("acceptAndTerminate()");var d=[];c&&(g=g||aq.REASON_PHRASE[c]||"",d.push("Reason: SIP ;cause="+c+'; text="'+g+'"')),(this.dialog||aD.call(this,f,"UAC"))&&(aR.call(this,aq.ACK),aR.call(this,aq.BYE,{extraHeaders:d})),this.status=ag.STATUS_TERMINATED}function aR(d,c){aN("sendRequest()");var f=new Z(this,d);f.send(c)}function ad(f){var c,g,d;if(!this.localHold&&!this.remoteHold){return f}if(f=ay.parseSDP(f),this.localHold&&!this.remoteHold){for(aN("mangleOffer() | me on hold, mangling offer"),g=f.media.length,c=0;g>c;c++){d=f.media[c],d.direction?"sendrecv"===d.direction?d.direction="sendonly":"recvonly"===d.direction&&(d.direction="inactive"):d.direction="sendonly"}}else{if(this.localHold&&this.remoteHold){for(aN("mangleOffer() | both on hold, mangling offer"),g=f.media.length,c=0;g>c;c++){d=f.media[c],d.direction="inactive"}}else{if(this.remoteHold){for(aN("mangleOffer() | remote on hold, mangling offer"),g=f.media.length,c=0;g>c;c++){d=f.media[c],d.direction?"sendrecv"===d.direction?d.direction="recvonly":"recvonly"===d.direction&&(d.direction="inactive"):d.direction="recvonly"}}}}return ay.writeSDP(f)}function aY(){return this.localHold?(aN("setLocalMediaStatus() | me on hold, mutting my media"),aw.call(this,!0),void ar.call(this,!0)):this.remoteHold?(aN("setLocalMediaStatus() | remote on hold, mutting my media"),aw.call(this,!0),void ar.call(this,!0)):(this.audioMuted?aw.call(this,!0):aw.call(this,!1),void (this.videoMuted?ar.call(this,!0):ar.call(this,!1)))}function aC(d,c){if(this.sessionTimers.enabled){var f;d.session_expires&&d.session_expires>=aq.MIN_SESSION_EXPIRES?(this.sessionTimers.currentExpires=d.session_expires,f=d.session_expires_refresher||"uas"):(this.sessionTimers.currentExpires=this.sessionTimers.defaultExpires,f="uas"),c.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+f),this.sessionTimers.refresher="uas"===f,ae.call(this)}}function au(d){if(this.sessionTimers.enabled){var c;d.session_expires&&d.session_expires>=aq.MIN_SESSION_EXPIRES?(this.sessionTimers.currentExpires=d.session_expires,c=d.session_expires_refresher||"uac"):(this.sessionTimers.currentExpires=this.sessionTimers.defaultExpires,c="uac"),this.sessionTimers.refresher="uac"===c,ae.call(this)}}function ae(){var d=this,c=this.sessionTimers.currentExpires;this.sessionTimers.running=!0,clearTimeout(this.sessionTimers.timer),this.sessionTimers.timer=this.sessionTimers.refresher?setTimeout(function(){d.status!==ag.STATUS_TERMINATED&&(aN("runSessionTimer() | sending session refresh request"),aS.call(d,{eventHandlers:{succeeded:function(e){au.call(d,e)}}}))},500*c):setTimeout(function(){d.status!==ag.STATUS_TERMINATED&&(ao("runSessionTimer() | timer expired, terminating the session"),d.terminate({cause:aq.causes.REQUEST_TIMEOUT,status_code:408,reason_phrase:"Session Timer Expired"}))},1100*c)}function aw(j){var f,k,h,g,c,d=this.connection.getLocalStreams();for(h=d.length,f=0;h>f;f++){for(c=d[f].getAudioTracks(),g=c.length,k=0;g>k;k++){c[k].enabled=!j}}}function ar(j){var f,k,h,g,c,d=this.connection.getLocalStreams();for(h=d.length,f=0;h>f;f++){for(c=d[f].getVideoTracks(),g=c.length,k=0;g>k;k++){c[k].enabled=!j}}}function az(d,c){aN("newRTCSession"),"remote"===d?(this.direction="incoming",this.local_identity=c.to,this.remote_identity=c.from):"local"===d&&(this.direction="outgoing",this.local_identity=c.from,this.remote_identity=c.to),this.ua.newRTCSession({originator:d,session:this,request:c})}function af(c){aN("session connecting"),this.emit("connecting",{request:c})}function aW(d,c){aN("session progress"),this.emit("progress",{originator:d,response:c||null})}function aB(d,c){aN("session accepted"),this.start_time=new Date,this.emit("accepted",{originator:d,response:c||null})}function an(d,c){aN("session confirmed"),this.is_confirmed=!0,this.emit("confirmed",{originator:d,ack:c||null})}function ai(d,c,f){aN("session ended"),this.end_time=new Date,this.close(),this.emit("ended",{originator:d,message:c||null,cause:f})}function at(d,c,f){aN("session failed"),this.close(),this.emit("failed",{originator:d,message:c||null,cause:f})}function ac(c){aN("session onhold"),aY.call(this),this.emit("hold",{originator:c})}function ah(c){aN("session onunhold"),aY.call(this),this.emit("unhold",{originator:c})}function aA(c){aN("session onmute"),aY.call(this),this.emit("muted",{audio:c.audio,video:c.video})}function aj(c){aN("session onunmute"),aY.call(this),this.emit("unmuted",{audio:c.audio,video:c.video})}aE.exports=aG;var ag={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9};aG.C=ag;var ak=aT("util"),aH=aT("events"),aN=aT("debug")("JsSIP:RTCSession"),ao=aT("debug")("JsSIP:ERROR:RTCSession");ao.log=console.warn.bind(console);var ap=aT("rtcninja"),aq=aT("./Constants"),aO=aT("./Exceptions"),aa=aT("./Transactions"),ay=aT("./Parser"),av=aT("./Utils"),ab=aT("./Timers"),Q=aT("./SIPMessage"),al=aT("./Dialog"),am=aT("./RequestSender"),Z=aT("./RTCSession/Request"),ax=aT("./RTCSession/DTMF");ak.inherits(aG,aH.EventEmitter),aG.prototype.isInProgress=function(){switch(this.status){case ag.STATUS_NULL:case ag.STATUS_INVITE_SENT:case ag.STATUS_1XX_RECEIVED:case ag.STATUS_INVITE_RECEIVED:case ag.STATUS_WAITING_FOR_ANSWER:return !0;default:return !1}},aG.prototype.isEstablished=function(){switch(this.status){case ag.STATUS_ANSWERED:case ag.STATUS_WAITING_FOR_ACK:case ag.STATUS_CONFIRMED:return !0;default:return !1}},aG.prototype.isEnded=function(){switch(this.status){case ag.STATUS_CANCELED:case ag.STATUS_TERMINATED:return !0;default:return !1}},aG.prototype.isMuted=function(){return{audio:this.audioMuted,video:this.videoMuted}},aG.prototype.isOnHold=function(){return{local:this.localHold,remote:this.remoteHold}},aG.prototype.isReadyToReOffer=function(){return this.rtcReady?this.dialog?this.dialog.uac_pending_reply===!0||this.dialog.uas_pending_reply===!0?(aN("isReadyToReOffer() | there is another INVITE/UPDATE transaction in progress"),!1):!0:(aN("isReadyToReOffer() | session not established yet"),!1):(aN("isReadyToReOffer() | internal WebRTC status not ready"),!1)},aG.prototype.connect=function(k,x){aN("connect()"),x=x||{};var i,f,y=k,j=x.eventHandlers||{},h=x.extraHeaders&&x.extraHeaders.slice()||[],w=x.mediaConstraints||{audio:!0,video:!0},v=x.mediaStream||null,q=x.pcConfig||{iceServers:[]},m=x.rtcConstraints||null,g=x.rtcOfferConstraints||null;if(this.rtcOfferConstraints=g,this.rtcAnswerConstraints=x.rtcAnswerConstraints||null,this.sessionTimers.enabled&&av.isDecimal(x.sessionTimersExpires)&&(this.sessionTimers.defaultExpires=x.sessionTimersExpires>=aq.MIN_SESSION_EXPIRES?x.sessionTimersExpires:aq.SESSION_EXPIRES),this.data=x.data||this.data,void 0===k){throw new TypeError("Not enough arguments")}if(!ap.hasWebRTC()){throw new aO.NotSupportedError("WebRTC not supported")}if(k=this.ua.normalizeTarget(k),!k){throw new TypeError("Invalid target: "+y)}if(this.status!==ag.STATUS_NULL){throw new aO.InvalidStateError(this.status)}for(i in j){this.on(i,j[i])}this.from_tag=av.newTag(),this.anonymous=x.anonymous||!1,this.isCanceled=!1,f={from_tag:this.from_tag},this.contact=this.ua.contact.toString({anonymous:this.anonymous,outbound:!0}),this.anonymous&&(f.from_display_name="Anonymous",f.from_uri="sip:anonymous@anonymous.invalid",h.push("P-Preferred-Identity: "+this.ua.configuration.uri.toString()),h.push("Privacy: id")),h.push("Contact: "+this.contact),h.push("Content-Type: application/sdp"),this.sessionTimers.enabled&&h.push("Session-Expires: "+this.sessionTimers.defaultExpires),this.request=new Q.OutgoingRequest(aq.INVITE,k,this.ua,f,h),this.id=this.request.call_id+this.from_tag,aP.call(this,q,m),this.ua.sessions[this.id]=this,az.call(this,"local",this.request),aQ.call(this,w,g,v)},aG.prototype.init_incoming=function(f){aN("init_incoming()");var c,g=this,d=f.getHeader("Content-Type");return f.body&&"application/sdp"!==d?void f.reply(415):(this.status=ag.STATUS_INVITE_RECEIVED,this.from_tag=f.from_tag,this.id=f.call_id+this.from_tag,this.request=f,this.contact=this.ua.contact.toString(),this.ua.sessions[this.id]=this,f.hasHeader("expires")&&(c=1000*f.getHeader("expires")),f.to_tag=av.newTag(),aD.call(this,f,"UAS",!0)?(this.late_sdp=f.body?!1:!0,this.status=ag.STATUS_WAITING_FOR_ANSWER,this.timers.userNoAnswerTimer=setTimeout(function(){f.reply(408),at.call(g,"local",null,aq.causes.NO_ANSWER)},this.ua.configuration.no_answer_timeout),c&&(this.timers.expiresTimer=setTimeout(function(){g.status===ag.STATUS_WAITING_FOR_ANSWER&&(f.reply(487),at.call(g,"system",null,aq.causes.EXPIRES))},c)),az.call(this,"remote",f),void (this.status!==ag.STATUS_TERMINATED&&(f.reply(180,null,["Contact: "+g.contact]),aW.call(g,"local",null)))):void f.reply(500,"Missing Contact header field"))},aG.prototype.answer=function(J){function u(c){v.status!==ag.STATUS_TERMINATED&&(v.localMediaStream=c,v.connection.addStream(c),v.late_sdp?w():v.connection.setRemoteDescription(new ap.RTCSessionDescription({type:"offer",sdp:k.body}),w,function(){k.reply(488),at.call(v,"system",null,aq.causes.WEBRTC_ERROR)}))}function B(){v.status!==ag.STATUS_TERMINATED&&(k.reply(480),at.call(v,"local",null,aq.causes.USER_DENIED_MEDIA_ACCESS))}function w(){af.call(v,k),v.late_sdp?aJ.call(v,"offer",O,L,v.rtcOfferConstraints):aJ.call(v,"answer",O,L,l)}function O(d){function c(){v.status=ag.STATUS_WAITING_FOR_ACK,aF.call(v,k,d),aM.call(v),aB.call(v,"local")}function f(){at.call(v,"system",null,aq.causes.CONNECTION_ERROR)}v.status!==ag.STATUS_TERMINATED&&(aC.call(v,k,x),k.reply(200,null,x,d,c,f))}function L(){v.status!==ag.STATUS_TERMINATED&&(k.reply(500),at.call(v,"system",null,aq.causes.WEBRTC_ERROR))}aN("answer()"),J=J||{};var F,K,z,H,D=!1,G=!1,j=!1,P=!1,v=this,k=this.request,x=J.extraHeaders&&J.extraHeaders.slice()||[],s=J.mediaConstraints||{},o=J.mediaStream||null,M=J.pcConfig||{iceServers:[]},q=J.rtcConstraints||null,l=J.rtcAnswerConstraints||null;if(this.rtcAnswerConstraints=l,this.rtcOfferConstraints=J.rtcOfferConstraints||null,this.sessionTimers.enabled&&av.isDecimal(J.sessionTimersExpires)&&(this.sessionTimers.defaultExpires=J.sessionTimersExpires>=aq.MIN_SESSION_EXPIRES?J.sessionTimersExpires:aq.SESSION_EXPIRES),this.data=J.data||this.data,"incoming"!==this.direction){throw new aO.NotSupportedError('"answer" not supported for outgoing RTCSession')}if(this.status!==ag.STATUS_WAITING_FOR_ANSWER){throw new aO.InvalidStateError(this.status)}if(this.status=ag.STATUS_ANSWERED,!aD.call(this,k,"UAS")){return void k.reply(500,"Error creating dialog")}for(clearTimeout(this.timers.userNoAnswerTimer),x.unshift("Contact: "+v.contact),z=ay.parseSDP(k.body||""),Array.isArray(z.media)||(z.media=[z.media]),F=z.media.length;F--;){var i=z.media[F];"audio"===i.type&&(D=!0,i.direction&&"sendrecv"!==i.direction||(j=!0)),"video"===i.type&&(G=!0,i.direction&&"sendrecv"!==i.direction||(P=!0))}if(o&&s.audio===!1){for(H=o.getAudioTracks(),K=H.length,F=0;K>F;F++){o.removeTrack(H[F])}}if(o&&s.video===!1){for(H=o.getVideoTracks(),K=H.length,F=0;K>F;F++){o.removeTrack(H[F])}}o||void 0!==s.audio||(s.audio=j),o||void 0!==s.video||(s.video=P),o||D||(s.audio=!1),o||G||(s.video=!1),aP.call(this,M,q),o?u(o):(v.localMediaStreamLocallyGenerated=!0,ap.getUserMedia(s,u,B))},aG.prototype.terminate=function(j){aN("terminate()"),j=j||{};var m,f,c=j.cause||aq.causes.BYE,p=j.status_code,g=j.reason_phrase,h=j.extraHeaders&&j.extraHeaders.slice()||[],d=j.body,k=this;if(this.status===ag.STATUS_TERMINATED){throw new aO.InvalidStateError(this.status)}switch(this.status){case ag.STATUS_NULL:case ag.STATUS_INVITE_SENT:case ag.STATUS_1XX_RECEIVED:if(aN("canceling sesssion"),p&&(200>p||p>=700)){throw new TypeError("Invalid status_code: "+p)}p&&(g=g||aq.REASON_PHRASE[p]||"",m="SIP ;cause="+p+' ;text="'+g+'"'),this.status===ag.STATUS_NULL?(this.isCanceled=!0,this.cancelReason=m):this.status===ag.STATUS_INVITE_SENT?(this.isCanceled=!0,this.cancelReason=m):this.status===ag.STATUS_1XX_RECEIVED&&this.request.cancel(m),this.status=ag.STATUS_CANCELED,at.call(this,"local",null,aq.causes.CANCELED);break;case ag.STATUS_WAITING_FOR_ANSWER:case ag.STATUS_ANSWERED:if(aN("rejecting session"),p=p||480,300>p||p>=700){throw new TypeError("Invalid status_code: "+p)}this.request.reply(p,g,h,d),at.call(this,"local",null,aq.causes.REJECTED);break;case ag.STATUS_WAITING_FOR_ACK:case ag.STATUS_CONFIRMED:if(aN("terminating session"),g=j.reason_phrase||aq.REASON_PHRASE[p]||"",p&&(200>p||p>=700)){throw new TypeError("Invalid status_code: "+p)}p&&h.push("Reason: SIP ;cause="+p+'; text="'+g+'"'),this.status===ag.STATUS_WAITING_FOR_ACK&&"incoming"===this.direction&&this.request.server_transaction.state!==aa.C.STATUS_TERMINATED?(f=this.dialog,this.receiveRequest=function(i){i.method===aq.ACK&&(aR.call(this,aq.BYE,{extraHeaders:h,body:d}),f.terminate())},this.request.server_transaction.on("stateChanged",function(){this.state===aa.C.STATUS_TERMINATED&&(aR.call(k,aq.BYE,{extraHeaders:h,body:d}),f.terminate())}),ai.call(this,"local",null,c),this.dialog=f,this.ua.dialogs[f.id.toString()]=f):(aR.call(this,aq.BYE,{extraHeaders:h,body:d}),ai.call(this,"local",null,c))}},aG.prototype.close=function(){aN("close()");var d;if(this.status!==ag.STATUS_TERMINATED){if(this.connection){try{this.connection.close()}catch(c){ao("close() | error closing the RTCPeerConnection: %o",c)}}this.localMediaStream&&this.localMediaStreamLocallyGenerated&&(aN("close() | closing local MediaStream"),ap.closeMediaStream(this.localMediaStream));for(d in this.timers){clearTimeout(this.timers[d])}clearTimeout(this.sessionTimers.timer),this.dialog&&(this.dialog.terminate(),delete this.dialog);for(d in this.earlyDialogs){this.earlyDialogs[d].terminate(),delete this.earlyDialogs[d]}this.status=ag.STATUS_TERMINATED,delete this.ua.sessions[this.id]}},aG.prototype.sendDTMF=function(j,f){function k(){var l,m;if(d.status===ag.STATUS_TERMINATED||!d.tones||c>=d.tones.length){return void (d.tones=null)}if(l=d.tones[c],c+=1,","===l){m=2000}else{var i=new ax(d);f.eventHandlers={failed:function(){d.tones=null}},i.send(l,f),m=h+g}setTimeout(k,m)}aN("sendDTMF() | tones: %s",j);var h,g,c=0,d=this;if(f=f||{},h=f.duration||null,g=f.interToneGap||null,void 0===j){throw new TypeError("Not enough arguments")}if(this.status!==ag.STATUS_CONFIRMED&&this.status!==ag.STATUS_WAITING_FOR_ACK){throw new aO.InvalidStateError(this.status)}if("number"==typeof j&&(j=j.toString()),!j||"string"!=typeof j||!j.match(/^[0-9A-D#*,]+$/i)){throw new TypeError("Invalid tones: "+j)}if(h&&!av.isDecimal(h)){throw new TypeError("Invalid tone duration: "+h)}if(h?h<ax.C.MIN_DURATION?(aN('"duration" value is lower than the minimum allowed, setting it to '+ax.C.MIN_DURATION+" milliseconds"),h=ax.C.MIN_DURATION):h>ax.C.MAX_DURATION?(aN('"duration" value is greater than the maximum allowed, setting it to '+ax.C.MAX_DURATION+" milliseconds"),h=ax.C.MAX_DURATION):h=Math.abs(h):h=ax.C.DEFAULT_DURATION,f.duration=h,g&&!av.isDecimal(g)){throw new TypeError("Invalid interToneGap: "+g)}return g?g<ax.C.MIN_INTER_TONE_GAP?(aN('"interToneGap" value is lower than the minimum allowed, setting it to '+ax.C.MIN_INTER_TONE_GAP+" milliseconds"),g=ax.C.MIN_INTER_TONE_GAP):g=Math.abs(g):g=ax.C.DEFAULT_INTER_TONE_GAP,this.tones?void (this.tones+=j):(this.tones=j,void k())},aG.prototype.mute=function(d){aN("mute()"),d=d||{audio:!0,video:!1};var c=!1,f=!1;this.audioMuted===!1&&d.audio&&(c=!0,this.audioMuted=!0,aw.call(this,!0)),this.videoMuted===!1&&d.video&&(f=!0,this.videoMuted=!0,ar.call(this,!0)),(c===!0||f===!0)&&aA.call(this,{audio:c,video:f})},aG.prototype.unmute=function(d){aN("unmute()"),d=d||{audio:!0,video:!0};var c=!1,f=!1;this.audioMuted===!0&&d.audio&&(c=!0,this.audioMuted=!1,this.localHold===!1&&aw.call(this,!1)),this.videoMuted===!0&&d.video&&(f=!0,this.videoMuted=!1,this.localHold===!1&&ar.call(this,!1)),(c===!0||f===!0)&&aj.call(this,{audio:c,video:f})},aG.prototype.hold=function(f,c){aN("hold()"),f=f||{};var g,d=this;return this.status!==ag.STATUS_WAITING_FOR_ACK&&this.status!==ag.STATUS_CONFIRMED?!1:this.localHold===!0?!1:this.isReadyToReOffer()?(this.localHold=!0,ac.call(this,"local"),g={succeeded:function(){c&&c()},failed:function(){d.terminate({cause:aq.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Hold Failed"})}},f.useUpdate?aS.call(this,{sdpOffer:!0,eventHandlers:g,extraHeaders:f.extraHeaders}):aI.call(this,{eventHandlers:g,extraHeaders:f.extraHeaders}),!0):!1},aG.prototype.unhold=function(f,c){aN("unhold()"),f=f||{};var g,d=this;return this.status!==ag.STATUS_WAITING_FOR_ACK&&this.status!==ag.STATUS_CONFIRMED?!1:this.localHold===!1?!1:this.isReadyToReOffer()?(this.localHold=!1,ah.call(this,"local"),g={succeeded:function(){c&&c()},failed:function(){d.terminate({cause:aq.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Unhold Failed"})}},f.useUpdate?aS.call(this,{sdpOffer:!0,eventHandlers:g,extraHeaders:f.extraHeaders}):aI.call(this,{eventHandlers:g,extraHeaders:f.extraHeaders}),!0):!1},aG.prototype.renegotiate=function(g,c){aN("renegotiate()"),g=g||{};var h,f=this,d=g.rtcOfferConstraints||null;return this.status!==ag.STATUS_WAITING_FOR_ACK&&this.status!==ag.STATUS_CONFIRMED?!1:this.isReadyToReOffer()?(h={succeeded:function(){c&&c()},failed:function(){f.terminate({cause:aq.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Media Renegotiation Failed"})}},aY.call(this),g.useUpdate?aS.call(this,{sdpOffer:!0,eventHandlers:h,rtcOfferConstraints:d,extraHeaders:g.extraHeaders}):aI.call(this,{eventHandlers:h,rtcOfferConstraints:d,extraHeaders:g.extraHeaders}),!0):!1},aG.prototype.receiveRequest=function(d){aN("receiveRequest()");var c,f=this;if(d.method===aq.CANCEL){(this.status===ag.STATUS_WAITING_FOR_ANSWER||this.status===ag.STATUS_ANSWERED)&&(this.status=ag.STATUS_CANCELED,this.request.reply(487),at.call(this,"remote",d,aq.causes.CANCELED))}else{switch(d.method){case aq.ACK:if(this.status===ag.STATUS_WAITING_FOR_ACK){if(clearTimeout(this.timers.ackTimer),clearTimeout(this.timers.invite2xxTimer),this.late_sdp){if(!d.body){ai.call(this,"remote",d,aq.causes.MISSING_SDP);break}this.connection.setRemoteDescription(new ap.RTCSessionDescription({type:"answer",sdp:d.body}),function(){f.status=ag.STATUS_CONFIRMED},function(){ai.call(f,"remote",d,aq.causes.BAD_MEDIA_DESCRIPTION)})}else{this.status=ag.STATUS_CONFIRMED}this.status!==ag.STATUS_CONFIRMED||this.is_confirmed||an.call(this,"remote",d)}break;case aq.BYE:this.status===ag.STATUS_CONFIRMED?(d.reply(200),ai.call(this,"remote",d,aq.causes.BYE)):this.status===ag.STATUS_INVITE_RECEIVED?(d.reply(200),this.request.reply(487,"BYE Received"),ai.call(this,"remote",d,aq.causes.BYE)):d.reply(403,"Wrong Status");break;case aq.INVITE:this.status===ag.STATUS_CONFIRMED?aX.call(this,d):d.reply(403,"Wrong Status");break;case aq.INFO:this.status===ag.STATUS_CONFIRMED||this.status===ag.STATUS_WAITING_FOR_ACK||this.status===ag.STATUS_INVITE_RECEIVED?(c=d.getHeader("content-type"),c&&c.match(/^application\/dtmf-relay/i)?new ax(this).init_incoming(d):d.reply(415)):d.reply(403,"Wrong Status");break;case aq.UPDATE:this.status===ag.STATUS_CONFIRMED?aV.call(this,d):d.reply(403,"Wrong Status");break;default:d.reply(501)}}},aG.prototype.onTransportError=function(){ao("onTransportError()"),this.status!==ag.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:aq.causes.CONNECTION_ERROR,cause:aq.causes.CONNECTION_ERROR})},aG.prototype.onRequestTimeout=function(){aN("onRequestTimeout"),this.status!==ag.STATUS_TERMINATED&&this.terminate({status_code:408,reason_phrase:aq.causes.REQUEST_TIMEOUT,cause:aq.causes.REQUEST_TIMEOUT})},aG.prototype.onDialogError=function(){ao("onDialogError()"),this.status!==ag.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:aq.causes.DIALOG_ERROR,cause:aq.causes.DIALOG_ERROR})},aG.prototype.newDTMF=function(c){aN("newDTMF()"),this.emit("newDTMF",c)}},{"./Constants":1,"./Dialog":2,"./Exceptions":5,"./Parser":10,"./RTCSession/DTMF":12,"./RTCSession/Request":13,"./RequestSender":15,"./SIPMessage":16,"./Timers":17,"./Transactions":18,"./Utils":22,debug:29,events:24,rtcninja:34,util:28}],12:[function(j,p,f){function c(i){this.owner=i,this.direction=null,this.tone=null,this.duration=null}p.exports=c;var q={MIN_DURATION:70,MAX_DURATION:6000,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};c.C=q;var g=j("debug")("JsSIP:RTCSession:DTMF"),h=j("debug")("JsSIP:ERROR:RTCSession:DTMF");h.log=console.warn.bind(console);var d=j("../Constants"),m=j("../Exceptions"),k=j("../RTCSession");c.prototype.send=function(o,i){var s,l;if(void 0===o){throw new TypeError("Not enough arguments")}if(this.direction="outgoing",this.owner.status!==k.C.STATUS_CONFIRMED&&this.owner.status!==k.C.STATUS_WAITING_FOR_ACK){throw new m.InvalidStateError(this.owner.status)}if(i=i||{},s=i.extraHeaders?i.extraHeaders.slice():[],this.eventHandlers=i.eventHandlers||{},"string"==typeof o){o=o.toUpperCase()}else{if("number"!=typeof o){throw new TypeError("Invalid tone: "+o)}o=o.toString()}if(!o.match(/^[0-9A-D#*]$/)){throw new TypeError("Invalid tone: "+o)}this.tone=o,this.duration=i.duration,s.push("Content-Type: application/dtmf-relay"),l="Signal="+this.tone+"\r\n",l+="Duration="+this.duration,this.owner.newDTMF({originator:"local",dtmf:this,request:this.request}),this.owner.dialog.sendRequest(this,d.INFO,{extraHeaders:s,body:l})},c.prototype.receiveResponse=function(i){switch(!0){case /^1[0-9]{2}$/.test(i.status_code):break;case /^2[0-9]{2}$/.test(i.status_code):g("onSuccessResponse"),this.eventHandlers.onSuccessResponse&&this.eventHandlers.onSuccessResponse(i);break;default:this.eventHandlers.onErrorResponse&&this.eventHandlers.onErrorResponse(i)}},c.prototype.onRequestTimeout=function(){h("onRequestTimeout"),this.eventHandlers.onRequestTimeout&&this.eventHandlers.onRequestTimeout()},c.prototype.onTransportError=function(){h("onTransportError"),this.eventHandlers.onTransportError&&this.eventHandlers.onTransportError()},c.prototype.onDialogError=function(){h("onDialogError"),this.eventHandlers.onDialogError&&this.eventHandlers.onDialogError()},c.prototype.init_incoming=function(o){var i,s=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,l=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;this.direction="incoming",this.request=o,o.reply(200),o.body&&(i=o.body.split("\n"),i.length>=1&&s.test(i[0])&&(this.tone=i[0].replace(s,"$2")),i.length>=2&&l.test(i[1])&&(this.duration=parseInt(i[1].replace(l,"$2"),10))),this.duration||(this.duration=q.DEFAULT_DURATION),this.tone?this.owner.newDTMF({originator:"remote",dtmf:this,request:o}):g("invalid INFO DTMF received, discarded")}},{"../Constants":1,"../Exceptions":5,"../RTCSession":11,debug:29}],13:[function(j,m,f){function c(l,i){if(p("new | %s",i),this.session=l,this.method=i,this.session.status!==k.C.STATUS_1XX_RECEIVED&&this.session.status!==k.C.STATUS_WAITING_FOR_ANSWER&&this.session.status!==k.C.STATUS_WAITING_FOR_ACK&&this.session.status!==k.C.STATUS_CONFIRMED&&this.session.status!==k.C.STATUS_TERMINATED){throw new d.InvalidStateError(this.session.status)}if(this.session.status===k.C.STATUS_TERMINATED&&i!==h.BYE){throw new d.InvalidStateError(this.session.status)}}m.exports=c;var p=j("debug")("JsSIP:RTCSession:Request"),g=j("debug")("JsSIP:ERROR:RTCSession:Request");g.log=console.warn.bind(console);var h=j("../Constants"),d=j("../Exceptions"),k=j("../RTCSession");c.prototype.send=function(l){l=l||{};var i=l.extraHeaders&&l.extraHeaders.slice()||[],o=l.body||null;this.eventHandlers=l.eventHandlers||{},this.session.dialog.sendRequest(this,this.method,{extraHeaders:i,body:o})},c.prototype.receiveResponse=function(i){switch(!0){case /^1[0-9]{2}$/.test(i.status_code):p("onProgressResponse"),this.eventHandlers.onProgressResponse&&this.eventHandlers.onProgressResponse(i);break;case /^2[0-9]{2}$/.test(i.status_code):p("onSuccessResponse"),this.eventHandlers.onSuccessResponse&&this.eventHandlers.onSuccessResponse(i);break;default:p("onErrorResponse"),this.eventHandlers.onErrorResponse&&this.eventHandlers.onErrorResponse(i)}},c.prototype.onRequestTimeout=function(){g("onRequestTimeout"),this.eventHandlers.onRequestTimeout&&this.eventHandlers.onRequestTimeout()},c.prototype.onTransportError=function(){g("onTransportError"),this.eventHandlers.onTransportError&&this.eventHandlers.onTransportError()},c.prototype.onDialogError=function(){g("onDialogError"),this.eventHandlers.onDialogError&&this.eventHandlers.onDialogError()}},{"../Constants":1,"../Exceptions":5,"../RTCSession":11,debug:29}],14:[function(j,m,f){function c(l,i){var o=1;this.ua=l,this.transport=i,this.registrar=l.configuration.registrar_server,this.expires=l.configuration.register_expires,this.call_id=g.createRandomToken(22),this.cseq=0,this.to_uri=l.configuration.uri,this.registrationTimer=null,this.registered=!1,this.contact=this.ua.contact.toString(),this.contact+=";+sip.ice",this.extraHeaders=[],this.extraContactParams="",o&&(this.contact+=";reg-id="+o,this.contact+=';+sip.instance="<urn:uuid:'+this.ua.configuration.instance_id+'>"')}m.exports=c;var p=j("debug")("JsSIP:Registrator"),g=j("./Utils"),h=j("./Constants"),d=j("./SIPMessage"),k=j("./RequestSender");c.prototype={setExtraHeaders:function(i){Array.isArray(i)||(i=[]),this.extraHeaders=i.slice()},setExtraContactParams:function(l){l instanceof Object||(l={}),this.extraContactParams="";for(var i in l){var o=l[i];this.extraContactParams+=";"+i,o&&(this.extraContactParams+="="+o)}},register:function(){var o,i,q,l=this;q=this.extraHeaders.slice(),q.push("Contact: "+this.contact+";expires="+this.expires+this.extraContactParams),q.push("Expires: "+this.expires),this.request=new d.OutgoingRequest(h.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},q),o=new k(this,this.ua),this.receiveResponse=function(s){var v,t,r=s.getHeaders("contact").length;if(s.cseq===this.cseq){switch(null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),!0){case /^1[0-9]{2}$/.test(s.status_code):break;case /^2[0-9]{2}$/.test(s.status_code):if(s.hasHeader("expires")&&(t=s.getHeader("expires")),!r){p("no Contact header in response to REGISTER, response ignored");break}for(;r--;){if(v=s.parseHeader("contact",r),v.uri.user===this.ua.contact.uri.user){t=v.getParam("expires");break}v=null}if(!v){p("no Contact header pointing to us, response ignored");break}t||(t=this.expires),this.registrationTimer=setTimeout(function(){l.registrationTimer=null,l.register()},1000*t-3000),v.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=v.getParam("temp-gruu").replace(/"/g,"")),v.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=v.getParam("pub-gruu").replace(/"/g,"")),this.registered||(this.registered=!0,this.ua.registered({response:s}));break;case /^423$/.test(s.status_code):s.hasHeader("min-expires")?(this.expires=s.getHeader("min-expires"),this.register()):(p("423 response received for REGISTER without Min-Expires"),this.registrationFailure(s,h.causes.SIP_FAILURE_CODE));break;default:i=g.sipErrorCause(s.status_code),this.registrationFailure(s,i)}}},this.onRequestTimeout=function(){this.registrationFailure(null,h.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.registrationFailure(null,h.causes.CONNECTION_ERROR)},o.send()},unregister:function(l){var i;if(!this.registered){return void p("already unregistered")}l=l||{},this.registered=!1,null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),i=this.extraHeaders.slice(),l.all?(i.push("Contact: *"+this.extraContactParams),i.push("Expires: 0"),this.request=new d.OutgoingRequest(h.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},i)):(i.push("Contact: "+this.contact+";expires=0"+this.extraContactParams),i.push("Expires: 0"),this.request=new d.OutgoingRequest(h.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},i));var o=new k(this,this.ua);this.receiveResponse=function(q){var n;switch(!0){case /^1[0-9]{2}$/.test(q.status_code):break;case /^2[0-9]{2}$/.test(q.status_code):this.unregistered(q);break;default:n=g.sipErrorCause(q.status_code),this.unregistered(q,n)}},this.onRequestTimeout=function(){this.unregistered(null,h.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.unregistered(null,h.causes.CONNECTION_ERROR)},o.send()},registrationFailure:function(l,i){this.ua.registrationFailed({response:l||null,cause:i}),this.registered&&(this.registered=!1,this.ua.unregistered({response:l||null,cause:i}))},unregistered:function(l,i){this.registered=!1,this.ua.unregistered({response:l||null,cause:i||null})},onTransportClosed:function(){null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),this.registered&&(this.registered=!1,this.ua.unregistered({}))},close:function(){this.registered&&this.unregister()}}},{"./Constants":1,"./RequestSender":15,"./SIPMessage":16,"./Utils":22,debug:29}],15:[function(j,m,f){function c(l,i){this.ua=i,this.applicant=l,this.method=l.request.method,this.request=l.request,this.credentials=null,this.challenged=!1,this.staled=!1,i.status!==h.C.STATUS_USER_CLOSED||this.method===g.BYE&&this.method===g.ACK||this.onTransportError()}m.exports=c;var p=j("debug")("JsSIP:RequestSender"),g=j("./Constants"),h=j("./UA"),d=j("./DigestAuthentication"),k=j("./Transactions");c.prototype={send:function(){switch(this.method){case"INVITE":this.clientTransaction=new k.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new k.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new k.NonInviteClientTransaction(this,this.request,this.ua.transport)}this.clientTransaction.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(s){var o,u,q,l=s.status_code;if(401!==l&&407!==l||null===this.ua.configuration.password){this.applicant.receiveResponse(s)}else{if(401===s.status_code?(u=s.parseHeader("www-authenticate"),q="authorization"):(u=s.parseHeader("proxy-authenticate"),q="proxy-authorization"),!u){return p(s.status_code+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(s)}if(!this.challenged||!this.staled&&u.stale===!0){if(this.credentials||(this.credentials=new d(this.ua)),!this.credentials.authenticate(this.request,u)){return void this.applicant.receiveResponse(s)}this.challenged=!0,u.stale&&(this.staled=!0),s.method===g.REGISTER?o=this.applicant.cseq+=1:this.request.dialog?o=this.request.dialog.local_seqnum+=1:(o=this.request.cseq+1,this.request.cseq=o),this.request.setHeader("cseq",o+" "+this.method),this.request.setHeader(q,this.credentials.toString()),this.send()}else{this.applicant.receiveResponse(s)}}}}},{"./Constants":1,"./DigestAuthentication":4,"./Transactions":18,"./UA":20,debug:29}],16:[function(p,x,g){function d(D,F,z,c,G,A){var B,u,C,E;return c=c||{},D&&F&&z?(this.ua=z,this.headers={},this.method=D,this.ruri=F,this.body=A,this.extraHeaders=G&&G.slice()||[],c.route_set?this.setHeader("route",c.route_set):z.configuration.use_preloaded_route&&this.setHeader("route",z.transport.server.sip_uri),this.setHeader("via",""),this.setHeader("max-forwards",w.MAX_FORWARDS),B=c.to_display_name||0===c.to_display_name?'"'+c.to_display_name+'" ':"",B+="<"+(c.to_uri||F)+">",B+=c.to_tag?";tag="+c.to_tag:"",this.to=new q.parse(B),this.setHeader("to",B),u=c.from_display_name||0===c.from_display_name?'"'+c.from_display_name+'" ':z.configuration.display_name?'"'+z.configuration.display_name+'" ':"",u+="<"+(c.from_uri||z.configuration.uri)+">;tag=",u+=c.from_tag||v.newTag(),this.from=new q.parse(u),this.setHeader("from",u),C=c.call_id||z.configuration.jssip_id+v.createRandomToken(15),this.call_id=C,this.setHeader("call-id",C),E=c.cseq||Math.floor(10000*Math.random()),this.cseq=E,void this.setHeader("cseq",E+" "+D)):null}function y(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null}function j(c){this.ua=c,this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null}function k(){this.headers={},this.status_code=null,this.reason_phrase=null}x.exports={OutgoingRequest:d,IncomingRequest:j,IncomingResponse:k};var f=p("debug")("JsSIP:SIPMessage"),w=p("./Constants"),v=p("./Utils"),q=p("./NameAddrHeader"),m=p("./Grammar");d.prototype={setHeader:function(h,c){this.headers[v.headerize(h)]=Array.isArray(c)?c:[c]},getHeader:function(l){var c,o,i=this.extraHeaders.length,h=this.headers[v.headerize(l)];if(h){if(h[0]){return h[0]}}else{for(c=new RegExp("^\\s*"+l+"\\s*:","i"),o=0;i>o;o++){if(h=this.extraHeaders[o],c.test(h)){return h.substring(h.indexOf(":")+1).trim()}}}},getHeaders:function(u){var h,z,o,i=this.headers[v.headerize(u)],c=[];if(i){for(z=i.length,h=0;z>h;h++){c.push(i[h])}return c}for(z=this.extraHeaders.length,o=new RegExp("^\\s*"+u+"\\s*:","i"),h=0;z>h;h++){i=this.extraHeaders[h],o.test(i)&&c.push(i.substring(i.indexOf(":")+1).trim())}return c},hasHeader:function(i){var c,l,h=this.extraHeaders.length;if(this.headers[v.headerize(i)]){return !0}for(c=new RegExp("^\\s*"+i+"\\s*:","i"),l=0;h>l;l++){if(c.test(this.extraHeaders[l])){return !0}}return !1},toString:function(){var l,c,o,i="",h=[];i+=this.method+" "+this.ruri+" SIP/2.0\r\n";for(l in this.headers){for(c=this.headers[l].length,o=0;c>o;o++){i+=l+": "+this.headers[l][o]+"\r\n"}}for(c=this.extraHeaders.length,o=0;c>o;o++){i+=this.extraHeaders[o].trim()+"\r\n"}switch(this.method){case w.REGISTER:h.push("path","gruu");break;case w.INVITE:this.ua.configuration.session_timers&&h.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&h.push("gruu"),h.push("ice");break;case w.UPDATE:this.ua.configuration.session_timers&&h.push("timer"),h.push("ice")}return h.push("outbound"),i+="Allow: "+w.ALLOWED_METHODS+"\r\n",i+="Supported: "+h+"\r\n",i+="User-Agent: "+w.USER_AGENT+"\r\n",this.body?(c=v.str_utf8_length(this.body),i+="Content-Length: "+c+"\r\n\r\n",i+=this.body):i+="Content-Length: 0\r\n\r\n",i}},y.prototype={addHeader:function(h,c){var i={raw:c};h=v.headerize(h),this.headers[h]?this.headers[h].push(i):this.headers[h]=[i]},getHeader:function(h){var c=this.headers[v.headerize(h)];if(c){return c[0]?c[0].raw:void 0}},getHeaders:function(l){var c,o,i=this.headers[v.headerize(l)],h=[];if(!i){return[]}for(o=i.length,c=0;o>c;c++){h.push(i[c].raw)}return h},hasHeader:function(c){return this.headers[v.headerize(c)]?!0:!1},parseHeader:function(l,c){var o,i,h;return l=v.headerize(l),c=c||0,this.headers[l]?c>=this.headers[l].length?void f('not so many "'+l+'" headers present'):(o=this.headers[l][c],i=o.raw,o.parsed?o.parsed:(h=m.parse(i,l.replace(/-/g,"_")),-1===h?(this.headers[l].splice(c,1),void f('error parsing "'+l+'" header field with value "'+i+'"')):(o.parsed=h,h))):void f('header "'+l+'" not present')},s:function(h,c){return this.parseHeader(h,c)},setHeader:function(h,c){var i={raw:c};this.headers[v.headerize(h)]=[i]},toString:function(){return this.data}},j.prototype=new y,j.prototype.reply=function(I,L,B,u,M,D){var E,A,K,F,J,z=[],H=this.getHeader("To"),C=0,G=0;if(I=I||null,L=L||null,!I||100>I||I>699){throw new TypeError("Invalid status_code: "+I)}if(L&&"string"!=typeof L&&!(L instanceof String)){throw new TypeError("Invalid reason_phrase: "+L)}if(L=L||w.REASON_PHRASE[I]||"",B=B&&B.slice()||[],J="SIP/2.0 "+I+" "+L+"\r\n",this.method===w.INVITE&&I>100&&200>=I){for(E=this.getHeaders("record-route"),K=E.length,C;K>C;C++){J+="Record-Route: "+E[C]+"\r\n"}}for(A=this.getHeaders("via"),K=A.length,G;K>G;G++){J+="Via: "+A[G]+"\r\n"}for(!this.to_tag&&I>100?H+=";tag="+v.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(H+=";tag="+this.to_tag),J+="To: "+H+"\r\n",J+="From: "+this.getHeader("From")+"\r\n",J+="Call-ID: "+this.call_id+"\r\n",J+="CSeq: "+this.cseq+" "+this.method+"\r\n",K=B.length,F=0;K>F;F++){J+=B[F].trim()+"\r\n"}switch(this.method){case w.INVITE:this.ua.configuration.session_timers&&z.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&z.push("gruu"),z.push("ice");break;case w.UPDATE:this.ua.configuration.session_timers&&z.push("timer"),u&&z.push("ice")}z.push("outbound"),this.method===w.OPTIONS?(J+="Allow: "+w.ALLOWED_METHODS+"\r\n",J+="Accept: "+w.ACCEPTED_BODY_TYPES+"\r\n"):405===I?J+="Allow: "+w.ALLOWED_METHODS+"\r\n":415===I&&(J+="Accept: "+w.ACCEPTED_BODY_TYPES+"\r\n"),J+="Supported: "+z+"\r\n",u?(K=v.str_utf8_length(u),J+="Content-Type: application/sdp\r\n",J+="Content-Length: "+K+"\r\n\r\n",J+=u):J+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(I,J,M,D)},j.prototype.reply_sl=function(A,o){var B,z,u=0,c=this.getHeaders("via"),h=c.length;if(A=A||null,o=o||null,!A||100>A||A>699){throw new TypeError("Invalid status_code: "+A)}if(o&&"string"!=typeof o&&!(o instanceof String)){throw new TypeError("Invalid reason_phrase: "+o)}for(o=o||w.REASON_PHRASE[A]||"",z="SIP/2.0 "+A+" "+o+"\r\n",u;h>u;u++){z+="Via: "+c[u]+"\r\n"}B=this.getHeader("To"),!this.to_tag&&A>100?B+=";tag="+v.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(B+=";tag="+this.to_tag),z+="To: "+B+"\r\n",z+="From: "+this.getHeader("From")+"\r\n",z+="Call-ID: "+this.call_id+"\r\n",z+="CSeq: "+this.cseq+" "+this.method+"\r\n",z+="Content-Length: 0\r\n\r\n",this.transport.send(z)},k.prototype=new y},{"./Constants":1,"./Grammar":6,"./NameAddrHeader":9,"./Utils":22,debug:29}],17:[function(j,f,k){var h=500,g=4000,c=5000,d={T1:h,T2:g,T4:c,TIMER_B:64*h,TIMER_D:0*h,TIMER_F:64*h,TIMER_H:64*h,TIMER_I:0*h,TIMER_J:0*h,TIMER_K:0*c,TIMER_L:64*h,TIMER_M:64*h,PROVISIONAL_RESPONSE_INTERVAL:60000};f.exports=d},{}],18:[function(G,q,z){function w(g,c,h){var f,d;this.type=J.NON_INVITE_CLIENT,this.transport=h,this.id="z9hG4bK"+Math.floor(10000000*Math.random()),this.request_sender=g,this.request=c,d=g.ua.configuration.hack_via_tcp?"TCP":g.ua.configuration.hack_via_ws?"WS":h.server.scheme,f="SIP/2.0/"+d,f+=" "+g.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",f),this.request_sender.ua.newTransaction(this),D.EventEmitter.call(this)}function v(h,d,i){var g,f,c=this;this.type=J.INVITE_CLIENT,this.transport=i,this.id="z9hG4bK"+Math.floor(10000000*Math.random()),this.request_sender=h,this.request=d,f=h.ua.configuration.hack_via_tcp?"TCP":h.ua.configuration.hack_via_ws?"WS":i.server.scheme,g="SIP/2.0/"+f,g+=" "+h.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",g),this.request_sender.ua.newTransaction(this),this.request.cancel=function(l){c.cancel_request(c,l)},D.EventEmitter.call(this)}function B(g,c,h){var f,d;this.transport=h,this.id="z9hG4bK"+Math.floor(10000000*Math.random()),this.request_sender=g,this.request=c,d=g.ua.configuration.hack_via_tcp?"TCP":g.ua.configuration.hack_via_ws?"WS":h.server.scheme,f="SIP/2.0/"+d,f+=" "+g.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",f),D.EventEmitter.call(this)}function C(d,c){this.type=J.NON_INVITE_SERVER,this.id=d.via_branch,this.request=d,this.transport=d.transport,this.ua=c,this.last_response="",d.server_transaction=this,this.state=J.STATUS_TRYING,c.newTransaction(this),D.EventEmitter.call(this)}function y(d,c){this.type=J.INVITE_SERVER,this.id=d.via_branch,this.request=d,this.transport=d.transport,this.ua=c,this.last_response="",d.server_transaction=this,this.state=J.STATUS_PROCEEDING,c.newTransaction(this),this.resendProvisionalTimer=null,d.reply(100),D.EventEmitter.call(this)}function k(d,c){var f;switch(c.method){case j.INVITE:if(f=d.transactions.ist[c.via_branch]){switch(f.state){case J.STATUS_PROCEEDING:f.transport.send(f.last_response);break;case J.STATUS_ACCEPTED:}return !0}break;case j.ACK:if(f=d.transactions.ist[c.via_branch],!f){return !1}if(f.state===J.STATUS_ACCEPTED){return !1}if(f.state===J.STATUS_COMPLETED){return f.state=J.STATUS_CONFIRMED,f.I=setTimeout(function(){f.timer_I()},K.TIMER_I),!0}break;case j.CANCEL:return f=d.transactions.ist[c.via_branch],f?(c.reply_sl(200),f.state===J.STATUS_PROCEEDING?!1:!0):(c.reply_sl(481),!0);default:if(f=d.transactions.nist[c.via_branch]){switch(f.state){case J.STATUS_TRYING:break;case J.STATUS_PROCEEDING:case J.STATUS_COMPLETED:f.transport.send(f.last_response)}return !0}}}q.exports={C:null,NonInviteClientTransaction:w,InviteClientTransaction:v,AckClientTransaction:B,NonInviteServerTransaction:C,InviteServerTransaction:y,checkTransaction:k};var J={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"};q.exports.C=J;var I=G("util"),D=G("events"),H=G("debug")("JsSIP:NonInviteClientTransaction"),x=G("debug")("JsSIP:InviteClientTransaction"),F=G("debug")("JsSIP:AckClientTransaction"),A=G("debug")("JsSIP:NonInviteServerTransaction"),E=G("debug")("JsSIP:InviteServerTransaction"),j=G("./Constants"),K=G("./Timers");I.inherits(w,D.EventEmitter),w.prototype.stateChanged=function(c){this.state=c,this.emit("stateChanged")},w.prototype.send=function(){var c=this;this.stateChanged(J.STATUS_TRYING),this.F=setTimeout(function(){c.timer_F()},K.TIMER_F),this.transport.send(this.request)||this.onTransportError()},w.prototype.onTransportError=function(){H("transport error occurred, deleting transaction "+this.id),clearTimeout(this.F),clearTimeout(this.K),this.stateChanged(J.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onTransportError()},w.prototype.timer_F=function(){H("Timer F expired for transaction "+this.id),this.stateChanged(J.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout()},w.prototype.timer_K=function(){this.stateChanged(J.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},w.prototype.receiveResponse=function(d){var c=this,f=d.status_code;if(200>f){switch(this.state){case J.STATUS_TRYING:case J.STATUS_PROCEEDING:this.stateChanged(J.STATUS_PROCEEDING),this.request_sender.receiveResponse(d)}}else{switch(this.state){case J.STATUS_TRYING:case J.STATUS_PROCEEDING:this.stateChanged(J.STATUS_COMPLETED),clearTimeout(this.F),408===f?this.request_sender.onRequestTimeout():this.request_sender.receiveResponse(d),this.K=setTimeout(function(){c.timer_K()},K.TIMER_K);break;case J.STATUS_COMPLETED:}}},I.inherits(v,D.EventEmitter),v.prototype.stateChanged=function(c){this.state=c,this.emit("stateChanged")},v.prototype.send=function(){var c=this;this.stateChanged(J.STATUS_CALLING),this.B=setTimeout(function(){c.timer_B()},K.TIMER_B),this.transport.send(this.request)||this.onTransportError()},v.prototype.onTransportError=function(){clearTimeout(this.B),clearTimeout(this.D),clearTimeout(this.M),this.state!==J.STATUS_ACCEPTED&&(x("transport error occurred, deleting transaction "+this.id),this.request_sender.onTransportError()),this.stateChanged(J.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},v.prototype.timer_M=function(){x("Timer M expired for transaction "+this.id),this.state===J.STATUS_ACCEPTED&&(clearTimeout(this.B),this.stateChanged(J.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this))},v.prototype.timer_B=function(){x("Timer B expired for transaction "+this.id),this.state===J.STATUS_CALLING&&(this.stateChanged(J.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout())},v.prototype.timer_D=function(){x("Timer D expired for transaction "+this.id),clearTimeout(this.B),this.stateChanged(J.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},v.prototype.sendACK=function(d){var c=this;this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n",this.ack+="Via: "+this.request.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n"),this.ack+="To: "+d.getHeader("to")+"\r\n",this.ack+="From: "+this.request.headers.From.toString()+"\r\n",this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n",this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0],this.ack+=" ACK\r\n",this.ack+="Content-Length: 0\r\n\r\n",this.D=setTimeout(function(){c.timer_D()},K.TIMER_D),this.transport.send(this.ack)},v.prototype.cancel_request=function(d,c){var f=d.request;this.cancel=j.CANCEL+" "+f.ruri+" SIP/2.0\r\n",this.cancel+="Via: "+f.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.cancel+="Route: "+f.headers.Route.toString()+"\r\n"),this.cancel+="To: "+f.headers.To.toString()+"\r\n",this.cancel+="From: "+f.headers.From.toString()+"\r\n",this.cancel+="Call-ID: "+f.headers["Call-ID"].toString()+"\r\n",this.cancel+="CSeq: "+f.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n",c&&(this.cancel+="Reason: "+c+"\r\n"),this.cancel+="Content-Length: 0\r\n\r\n",this.state===J.STATUS_PROCEEDING&&this.transport.send(this.cancel)},v.prototype.receiveResponse=function(d){var c=this,f=d.status_code;if(f>=100&&199>=f){switch(this.state){case J.STATUS_CALLING:this.stateChanged(J.STATUS_PROCEEDING),this.request_sender.receiveResponse(d);break;case J.STATUS_PROCEEDING:this.request_sender.receiveResponse(d)}}else{if(f>=200&&299>=f){switch(this.state){case J.STATUS_CALLING:case J.STATUS_PROCEEDING:this.stateChanged(J.STATUS_ACCEPTED),this.M=setTimeout(function(){c.timer_M()},K.TIMER_M),this.request_sender.receiveResponse(d);break;case J.STATUS_ACCEPTED:this.request_sender.receiveResponse(d)}}else{if(f>=300&&699>=f){switch(this.state){case J.STATUS_CALLING:case J.STATUS_PROCEEDING:this.stateChanged(J.STATUS_COMPLETED),this.sendACK(d),this.request_sender.receiveResponse(d);break;case J.STATUS_COMPLETED:this.sendACK(d)}}}}},I.inherits(B,D.EventEmitter),B.prototype.send=function(){this.transport.send(this.request)||this.onTransportError()},B.prototype.onTransportError=function(){F("transport error occurred for transaction "+this.id),this.request_sender.onTransportError()},I.inherits(C,D.EventEmitter),C.prototype.stateChanged=function(c){this.state=c,this.emit("stateChanged")},C.prototype.timer_J=function(){A("Timer J expired for transaction "+this.id),this.stateChanged(J.STATUS_TERMINATED),this.ua.destroyTransaction(this)},C.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,A("transport error occurred, deleting transaction "+this.id),clearTimeout(this.J),this.stateChanged(J.STATUS_TERMINATED),this.ua.destroyTransaction(this))},C.prototype.receiveResponse=function(g,c,h,f){var d=this;if(100===g){switch(this.state){case J.STATUS_TRYING:this.stateChanged(J.STATUS_PROCEEDING),this.transport.send(c)||this.onTransportError();break;case J.STATUS_PROCEEDING:this.last_response=c,this.transport.send(c)?h&&h():(this.onTransportError(),f&&f())}}else{if(g>=200&&699>=g){switch(this.state){case J.STATUS_TRYING:case J.STATUS_PROCEEDING:this.stateChanged(J.STATUS_COMPLETED),this.last_response=c,this.J=setTimeout(function(){d.timer_J()},K.TIMER_J),this.transport.send(c)?h&&h():(this.onTransportError(),f&&f());break;case J.STATUS_COMPLETED:}}}},I.inherits(y,D.EventEmitter),y.prototype.stateChanged=function(c){this.state=c,this.emit("stateChanged")},y.prototype.timer_H=function(){E("Timer H expired for transaction "+this.id),this.state===J.STATUS_COMPLETED&&E("ACK not received, dialog will be terminated"),this.stateChanged(J.STATUS_TERMINATED),this.ua.destroyTransaction(this)},y.prototype.timer_I=function(){this.stateChanged(J.STATUS_TERMINATED)},y.prototype.timer_L=function(){E("Timer L expired for transaction "+this.id),this.state===J.STATUS_ACCEPTED&&(this.stateChanged(J.STATUS_TERMINATED),this.ua.destroyTransaction(this))},y.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,E("transport error occurred, deleting transaction "+this.id),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),clearTimeout(this.L),clearTimeout(this.H),clearTimeout(this.I),this.stateChanged(J.STATUS_TERMINATED),this.ua.destroyTransaction(this))},y.prototype.resend_provisional=function(){this.transport.send(this.last_response)||this.onTransportError()},y.prototype.receiveResponse=function(g,c,h,f){var d=this;if(g>=100&&199>=g){switch(this.state){case J.STATUS_PROCEEDING:this.transport.send(c)||this.onTransportError(),this.last_response=c}}if(g>100&&199>=g&&this.state===J.STATUS_PROCEEDING){null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=setInterval(function(){d.resend_provisional()},K.PROVISIONAL_RESPONSE_INTERVAL))}else{if(g>=200&&299>=g){switch(this.state){case J.STATUS_PROCEEDING:this.stateChanged(J.STATUS_ACCEPTED),this.last_response=c,this.L=setTimeout(function(){d.timer_L()},K.TIMER_L),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case J.STATUS_ACCEPTED:this.transport.send(c)?h&&h():(this.onTransportError(),f&&f())}}else{if(g>=300&&699>=g){switch(this.state){case J.STATUS_PROCEEDING:null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(c)?(this.stateChanged(J.STATUS_COMPLETED),this.H=setTimeout(function(){d.timer_H()},K.TIMER_H),h&&h()):(this.onTransportError(),f&&f())}}}}}},{"./Constants":1,"./Timers":17,debug:29,events:24,util:28}],19:[function(p,x,g){function d(h,c){this.ua=h,this.ws=null,this.server=c,this.reconnection_attempts=0,this.closed=!1,this.connected=!1,this.reconnectTimer=null,this.lastTransportError={},this.node_websocket_options=this.ua.configuration.node_websocket_options||{},this.node_websocket_options.headers=this.node_websocket_options.headers||{},this.node_websocket_options.headers["User-Agent"]=k.USER_AGENT}x.exports=d;var y={STATUS_READY:0,STATUS_DISCONNECTED:1,STATUS_ERROR:2};d.C=y;var j=p("debug")("JsSIP:Transport"),k=p("./Constants"),f=p("./Parser"),w=p("./UA"),v=p("./SIPMessage"),q=p("./sanityCheck"),m=p("websocket").w3cwebsocket;d.prototype={connect:function(){var h=this;if(this.ws&&(this.ws.readyState===this.ws.OPEN||this.ws.readyState===this.ws.CONNECTING)){return j("WebSocket "+this.server.ws_uri+" is already connected"),!1}this.ws&&this.ws.close(),j("connecting to WebSocket "+this.server.ws_uri),this.ua.onTransportConnecting(this,0===this.reconnection_attempts?1:this.reconnection_attempts);try{this.ws=new m(this.server.ws_uri,"sip",this.node_websocket_options.origin,this.node_websocket_options.headers,this.node_websocket_options.requestOptions,this.node_websocket_options.clientConfig),this.ws.binaryType="arraybuffer",this.ws.onopen=function(){h.onOpen()},this.ws.onclose=function(e){h.onClose(e)},this.ws.onmessage=function(e){h.onMessage(e)},this.ws.onerror=function(e){h.onError(e)}}catch(c){j("error connecting to WebSocket "+this.server.ws_uri+": "+c),this.lastTransportError.code=null,this.lastTransportError.reason=c.message,this.ua.onTransportError(this)}},disconnect:function(){this.ws&&(clearTimeout(this.reconnectTimer),this.closed=!0,j("closing WebSocket "+this.server.ws_uri),this.ws.close()),null!==this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null,this.ua.onTransportDisconnected({transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}))},send:function(h){var c=h.toString();return this.ws&&this.ws.readyState===this.ws.OPEN?(j("sending WebSocket message:\n\n"+c+"\n"),this.ws.send(c),!0):(j("unable to send message, WebSocket is not open"),!1)},onOpen:function(){this.connected=!0,j("WebSocket "+this.server.ws_uri+" connected"),null!==this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.reconnection_attempts=0,this.closed=!1,this.ua.onTransportConnected(this)},onClose:function(h){var c=this.connected;this.connected=!1,this.lastTransportError.code=h.code,this.lastTransportError.reason=h.reason,j("WebSocket disconnected (code: "+h.code+(h.reason?"| reason: "+h.reason:"")+")"),h.wasClean===!1&&j("WebSocket abrupt disconnection"),c===!0?(this.ua.onTransportClosed(this),this.closed||this.reConnect()):this.ua.onTransportError(this)},onMessage:function(l){var c,o,i=l.data;if("\r\n"===i){return void j("received WebSocket message with CRLF Keep Alive response")}if("string"!=typeof i){try{i=String.fromCharCode.apply(null,new Uint8Array(i))}catch(h){return void j("received WebSocket binary message failed to be converted into string, message discarded")}j("received WebSocket binary message:\n\n"+i+"\n")}else{j("received WebSocket text message:\n\n"+i+"\n")}if(c=f.parseMessage(i,this.ua),c&&!(this.ua.status===w.C.STATUS_USER_CLOSED&&c instanceof v.IncomingRequest)&&q(c,this.ua,this)){if(c instanceof v.IncomingRequest){c.transport=this,this.ua.receiveRequest(c)}else{if(c instanceof v.IncomingResponse){switch(c.method){case k.INVITE:o=this.ua.transactions.ict[c.via_branch],o&&o.receiveResponse(c);break;case k.ACK:break;default:o=this.ua.transactions.nict[c.via_branch],o&&o.receiveResponse(c)}}}}},onError:function(c){j("WebSocket connection error: %o",c)},reConnect:function(){var c=this;this.reconnection_attempts+=1,this.reconnection_attempts>this.ua.configuration.ws_server_max_reconnection?(j("maximum reconnection attempts for WebSocket "+this.server.ws_uri),this.ua.onTransportError(this)):(j("trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+this.reconnection_attempts+")"),this.reconnectTimer=setTimeout(function(){c.connect(),c.reconnectTimer=null},1000*this.ua.configuration.ws_server_reconnection_timeout))}}},{"./Constants":1,"./Parser":10,"./SIPMessage":16,"./UA":20,"./sanityCheck":23,debug:29,websocket:43}],20:[function(G,q,z){function w(d){if(this.cache={credentials:{}},this.configuration={},this.dynConfiguration={},this.dialogs={},this.applicants={},this.sessions={},this.transport=null,this.contact=null,this.status=v.STATUS_INIT,this.error=null,this.transactions={nist:{},nict:{},ist:{},ict:{}},this.data={},this.transportRecoverAttempts=0,this.transportRecoveryTimer=null,Object.defineProperties(this,{transactionsCount:{get:function(){var g,f=["nist","nict","ist","ict"],h=0;for(g in f){h+=Object.keys(this.transactions[f[g]]).length}return h}},nictTransactionsCount:{get:function(){return Object.keys(this.transactions.nict).length}},nistTransactionsCount:{get:function(){return Object.keys(this.transactions.nist).length}},ictTransactionsCount:{get:function(){return Object.keys(this.transactions.ict).length}},istTransactionsCount:{get:function(){return Object.keys(this.transactions.ist).length}}}),void 0===d){throw new TypeError("Not enough arguments")}try{this.loadConfig(d)}catch(c){throw this.status=v.STATUS_NOT_READY,this.error=v.CONFIGURATION_ERROR,c}this._registrator=new I(this),C.EventEmitter.call(this),k.called||k()}q.exports=w;var v={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2};w.C=v;var B=G("util"),C=G("events"),y=G("debug")("JsSIP:UA"),k=G("rtcninja"),J=G("./Constants"),I=G("./Registrator"),D=G("./RTCSession"),H=G("./Message"),x=G("./Transport"),F=G("./Transactions"),F=G("./Transactions"),A=G("./Utils"),E=G("./Exceptions"),j=G("./URI"),K=G("./Grammar");B.inherits(w,C.EventEmitter),w.prototype.start=function(){y("start()");var c;this.status===v.STATUS_INIT?(c=this.getNextWsServer(),this.transport=new x(this,c),this.transport.connect()):this.status===v.STATUS_USER_CLOSED?(y("restarting UA"),this.status=v.STATUS_READY,this.transport.connect()):y(this.status===v.STATUS_READY?"UA is in READY status, not restarted":"ERROR: connection is down, Auto-Recovery system is trying to reconnect"),this.dynConfiguration.register=this.configuration.register},w.prototype.register=function(){y("register()"),this.dynConfiguration.register=!0,this._registrator.register()},w.prototype.unregister=function(c){y("unregister()"),this.dynConfiguration.register=!1,this._registrator.unregister(c)},w.prototype.registrator=function(){return this._registrator},w.prototype.isRegistered=function(){return this._registrator.registered?!0:!1},w.prototype.isConnected=function(){return this.transport?this.transport.connected:!1},w.prototype.call=function(d,c){y("call()");var f;return f=new D(this),f.connect(d,c),f},w.prototype.sendMessage=function(f,c,g){y("sendMessage()");var d;return d=new H(this),d.send(f,c,g),d},w.prototype.terminateSessions=function(d){y("terminateSessions()");for(var c in this.sessions){this.sessions[c].isEnded()||this.sessions[c].terminate(d)}},w.prototype.stop=function(){y("stop()");var g,d,h,f=this;if(this.dynConfiguration={},this.status===v.STATUS_USER_CLOSED){return void y("UA already closed")}clearTimeout(this.transportRecoveryTimer),this._registrator.close(),h=Object.keys(this.sessions).length;for(g in this.sessions){y("closing session "+g);try{this.sessions[g].terminate()}catch(c){}}for(d in this.applicants){try{this.applicants[d].close()}catch(c){}}this.status=v.STATUS_USER_CLOSED,setTimeout(function(){f.transport.disconnect()},2000)},w.prototype.normalizeTarget=function(c){return A.normalizeTarget(c,this.configuration.hostport_params)},w.prototype.saveCredentials=function(c){this.cache.credentials[c.realm]=this.cache.credentials[c.realm]||{},this.cache.credentials[c.realm][c.uri]=c},w.prototype.getCredentials=function(d){var c,f;return c=d.ruri.host,this.cache.credentials[c]&&this.cache.credentials[c][d.ruri]&&(f=this.cache.credentials[c][d.ruri],f.method=d.method),f},w.prototype.onTransportClosed=function(g){var c,h,f,d=["nict","ict","nist","ist"];for(g.server.status=x.C.STATUS_DISCONNECTED,f=d.length,c=0;f>c;c++){for(h in this.transactions[d[c]]){this.transactions[d[c]][h].onTransportError()}}this.emit("disconnected",{transport:g,code:g.lastTransportError.code,reason:g.lastTransportError.reason})},w.prototype.onTransportError=function(d){var c;y("transport "+d.server.ws_uri+" failed | connection state set to "+x.C.STATUS_ERROR),d.server.status=x.C.STATUS_ERROR,this.emit("disconnected",{transport:d,code:d.lastTransportError.code,reason:d.lastTransportError.reason}),this.status!==v.STATUS_USER_CLOSED&&(c=this.getNextWsServer(),c?(this.transport=new x(this,c),this.transport.connect()):(this.closeSessionsOnTransportError(),this.error&&this.error===v.NETWORK_ERROR||(this.status=v.STATUS_NOT_READY,this.error=v.NETWORK_ERROR),this.recoverTransport()))},w.prototype.onTransportConnected=function(c){this.transport=c,this.transportRecoverAttempts=0,c.server.status=x.C.STATUS_READY,this.status!==v.STATUS_USER_CLOSED&&(this.status=v.STATUS_READY,this.error=null,this.dynConfiguration.register&&this._registrator.register(),this.emit("connected",{transport:c}))},w.prototype.onTransportConnecting=function(d,c){this.emit("connecting",{transport:d,attempts:c})},w.prototype.onTransportDisconnected=function(c){this.emit("disconnected",c)},w.prototype.newTransaction=function(c){this.transactions[c.type][c.id]=c,this.emit("newTransaction",{transaction:c})},w.prototype.destroyTransaction=function(c){delete this.transactions[c.type][c.id],this.emit("transactionDestroyed",{transaction:c})},w.prototype.newMessage=function(c){this.emit("newMessage",c)},w.prototype.newRTCSession=function(c){this.emit("newRTCSession",c)},w.prototype.registered=function(c){this.emit("registered",c)},w.prototype.unregistered=function(c){this.emit("unregistered",c)},w.prototype.registrationFailed=function(c){this.emit("registrationFailed",c)},w.prototype.receiveRequest=function(g){var c,h,f,d=g.method;if(g.ruri.user!==this.configuration.uri.user&&g.ruri.user!==this.contact.uri.user){return y("Request-URI does not point to us"),void (g.method!==J.ACK&&g.reply_sl(404))}if(g.ruri.scheme===J.SIPS){return void g.reply_sl(416)}if(!F.checkTransaction(this,g)){if(d===J.INVITE?new F.InviteServerTransaction(g,this):d!==J.ACK&&d!==J.CANCEL&&new F.NonInviteServerTransaction(g,this),d===J.OPTIONS){g.reply(200)}else{if(d===J.MESSAGE){if(0===this.listeners("newMessage").length){return void g.reply(405)}f=new H(this),f.init_incoming(g)}else{if(d===J.INVITE&&!g.to_tag&&0===this.listeners("newRTCSession").length){return void g.reply(405)}}}if(g.to_tag){c=this.findDialog(g),c?c.receiveRequest(g):d===J.NOTIFY?(h=this.findSession(g),h?h.receiveRequest(g):(y("received NOTIFY request for a non existent subscription"),g.reply(481,"Subscription does not exist"))):d!==J.ACK&&g.reply(481)}else{switch(d){case J.INVITE:k.hasWebRTC()?(h=new D(this),h.init_incoming(g)):(y("INVITE received but WebRTC is not supported"),g.reply(488));break;case J.BYE:g.reply(481);break;case J.CANCEL:h=this.findSession(g),h?h.receiveRequest(g):y("received CANCEL request for a non existent session");break;case J.ACK:break;default:g.reply(405)}}}},w.prototype.findSession=function(g){var c=g.call_id+g.from_tag,h=this.sessions[c],f=g.call_id+g.to_tag,d=this.sessions[f];return h?h:d?d:null},w.prototype.findDialog=function(d){var c=d.call_id+d.from_tag+d.to_tag,f=this.dialogs[c];return f?f:(c=d.call_id+d.to_tag+d.from_tag,f=this.dialogs[c],f?f:null)},w.prototype.getNextWsServer=function(){var f,c,g,d=[];for(c=this.configuration.ws_servers.length,f=0;c>f;f++){g=this.configuration.ws_servers[f],g.status!==x.C.STATUS_ERROR&&(0===d.length?d.push(g):g.weight>d[0].weight?d=[g]:g.weight===d[0].weight&&d.push(g))}return f=Math.floor(Math.random()*d.length),d[f]},w.prototype.closeSessionsOnTransportError=function(){var c;for(c in this.sessions){this.sessions[c].onTransportError()}this._registrator.onTransportClosed()},w.prototype.recoverTransport=function(m){var f,o,h,g,c,d;for(m=m||this,c=m.transportRecoverAttempts,o=m.configuration.ws_servers.length,f=0;o>f;f++){m.configuration.ws_servers[f].status=0}d=m.getNextWsServer(),h=Math.floor(Math.random()*Math.pow(2,c)+1),g=h*m.configuration.connection_recovery_min_interval,g>m.configuration.connection_recovery_max_interval&&(y("time for next connection attempt exceeds connection_recovery_max_interval, resetting counter"),g=m.configuration.connection_recovery_min_interval,c=0),y("next connection attempt in "+g+" seconds"),this.transportRecoveryTimer=setTimeout(function(){m.transportRecoverAttempts=c+1,m.transport=new x(m,d),m.transport.connect()},1000*g)},w.prototype.loadConfig=function(m){var g,o,h,c,f,d={via_host:A.createRandomToken(12)+".invalid",password:null,register_expires:600,register:!0,registrar_server:null,ws_server_max_reconnection:3,ws_server_reconnection_timeout:4,connection_recovery_min_interval:2,connection_recovery_max_interval:30,use_preloaded_route:!1,no_answer_timeout:60,session_timers:!0,hack_via_tcp:!1,hack_via_ws:!1,hack_ip_in_contact:!1,node_websocket_options:{}};for(g in w.configuration_check.mandatory){if(!m.hasOwnProperty(g)){throw new E.ConfigurationError(g)}if(o=m[g],h=w.configuration_check.mandatory[g].call(this,o),void 0===h){throw new E.ConfigurationError(g,o)}d[g]=h}for(g in w.configuration_check.optional){if(m.hasOwnProperty(g)){if(o=m[g],A.isEmpty(o)){continue}if(h=w.configuration_check.optional[g].call(this,o),void 0===h){throw new E.ConfigurationError(g,o)}d[g]=h}}if(d.connection_recovery_max_interval<d.connection_recovery_min_interval){throw new E.ConfigurationError("connection_recovery_max_interval",d.connection_recovery_max_interval)}0===d.display_name&&(d.display_name="0"),d.instance_id||(d.instance_id=A.newUUID()),d.jssip_id=A.createRandomToken(5),c=d.uri.clone(),c.user=null,d.hostport_params=c.toString().replace(/^sip:/i,""),d.authorization_user||(d.authorization_user=d.uri.user),d.registrar_server||(f=d.uri.clone(),f.user=null,d.registrar_server=f),d.no_answer_timeout=1000*d.no_answer_timeout,d.hack_ip_in_contact&&(d.via_host=A.getRandomTestNetIP()),this.contact={pub_gruu:null,temp_gruu:null,uri:new j("sip",A.createRandomToken(8),d.via_host,null,{transport:"ws"}),toString:function(p){p=p||{};var i=p.anonymous||null,s=p.outbound||null,l="<";return l+=i?this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":this.pub_gruu||this.uri.toString(),!s||(i?this.temp_gruu:this.pub_gruu)||(l+=";ob"),l+=">"}};for(g in d){w.configuration_skeleton[g].value=d[g]}Object.defineProperties(this.configuration,w.configuration_skeleton);for(g in d){w.configuration_skeleton[g].value=""}y("configuration parameters after validation:");for(g in d){switch(g){case"uri":case"registrar_server":y("- "+g+": "+d[g]);break;case"password":y("- "+g+": NOT SHOWN");break;default:y("- "+g+": "+JSON.stringify(d[g]))}}},w.configuration_skeleton=function(){var f,c,g={},d=["jssip_id","ws_server_max_reconnection","ws_server_reconnection_timeout","hostport_params","uri","ws_servers","authorization_user","connection_recovery_max_interval","connection_recovery_min_interval","display_name","hack_via_tcp","hack_via_ws","hack_ip_in_contact","instance_id","no_answer_timeout","session_timers","node_websocket_options","password","register_expires","registrar_server","use_preloaded_route","via_core_value","via_host"];for(f in d){c=d[f],g[c]={value:"",writable:!1,configurable:!1}}return g.register={value:"",writable:!0,configurable:!1},g}(),w.configuration_check={mandatory:{uri:function(d){var c;return/^sip:/i.test(d)||(d=J.SIP+":"+d),c=j.parse(d),c&&c.user?c:void 0},ws_servers:function(f){var c,g,d;if("string"==typeof f){f=[{ws_uri:f}]}else{if(!Array.isArray(f)){return}for(g=f.length,c=0;g>c;c++){"string"==typeof f[c]&&(f[c]={ws_uri:f[c]})}}if(0===f.length){return !1}for(g=f.length,c=0;g>c;c++){if(!f[c].ws_uri){return void y('ERROR: missing "ws_uri" attribute in ws_servers parameter')}if(f[c].weight&&!Number(f[c].weight)){return void y('ERROR: "weight" attribute in ws_servers parameter must be a Number')}if(d=K.parse(f[c].ws_uri,"absoluteURI"),-1===d){return void y('ERROR: invalid "ws_uri" attribute in ws_servers parameter: '+f[c].ws_uri)}if("wss"!==d.scheme&&"ws"!==d.scheme){return void y("ERROR: invalid URI scheme in ws_servers parameter: "+d.scheme)}f[c].sip_uri="<sip:"+d.host+(d.port?":"+d.port:"")+";transport=ws;lr>",f[c].weight||(f[c].weight=0),f[c].status=0,f[c].scheme=d.scheme.toUpperCase()}return f}},optional:{authorization_user:function(c){return -1===K.parse('"'+c+'"',"quoted_string")?void 0:c},connection_recovery_max_interval:function(d){var c;return A.isDecimal(d)&&(c=Number(d),c>0)?c:void 0},connection_recovery_min_interval:function(d){var c;return A.isDecimal(d)&&(c=Number(d),c>0)?c:void 0},display_name:function(c){return -1===K.parse('"'+c+'"',"display_name")?void 0:c},hack_via_tcp:function(c){return"boolean"==typeof c?c:void 0},hack_via_ws:function(c){return"boolean"==typeof c?c:void 0},hack_ip_in_contact:function(c){return"boolean"==typeof c?c:void 0},instance_id:function(c){return/^uuid:/i.test(c)&&(c=c.substr(5)),-1===K.parse(c,"uuid")?void 0:c},no_answer_timeout:function(d){var c;return A.isDecimal(d)&&(c=Number(d),c>0)?c:void 0},session_timers:function(c){return"boolean"==typeof c?c:void 0},node_websocket_options:function(c){return"object"==typeof c?c:{}},password:function(c){return String(c)},register:function(c){return"boolean"==typeof c?c:void 0},register_expires:function(d){var c;return A.isDecimal(d)&&(c=Number(d),c>0)?c:void 0},registrar_server:function(d){var c;return/^sip:/i.test(d)||(d=J.SIP+":"+d),c=j.parse(d),c?c.user?void 0:c:void 0},use_preloaded_route:function(c){return"boolean"==typeof c?c:void 0}}}},{"./Constants":1,"./Exceptions":5,"./Grammar":6,"./Message":8,"./RTCSession":11,"./Registrator":14,"./Transactions":18,"./Transport":19,"./URI":21,"./Utils":22,debug:29,events:24,rtcninja:34,util:28}],21:[function(j,f,k){function h(w,s,y,v,m,q){var x,p;if(!y){throw new TypeError('missing or invalid "host" parameter')}w=w||g.SIP,this.parameters={},this.headers={};for(x in m){this.setParam(x,m[x])}for(p in q){this.setHeader(p,q[p])}Object.defineProperties(this,{scheme:{get:function(){return w},set:function(e){w=e.toLowerCase()}},user:{get:function(){return s},set:function(i){s=i}},host:{get:function(){return y},set:function(i){y=i.toLowerCase()}},port:{get:function(){return v},set:function(i){v=0===i?i:parseInt(i,10)||null}}})}f.exports=h;var g=j("./Constants"),c=j("./Utils"),d=j("./Grammar");h.prototype={setParam:function(l,i){l&&(this.parameters[l.toLowerCase()]="undefined"==typeof i||null===i?null:i.toString().toLowerCase())},getParam:function(i){return i?this.parameters[i.toLowerCase()]:void 0},hasParam:function(i){return i?this.parameters.hasOwnProperty(i.toLowerCase())&&!0||!1:void 0},deleteParam:function(l){var i;return l=l.toLowerCase(),this.parameters.hasOwnProperty(l)?(i=this.parameters[l],delete this.parameters[l],i):void 0},clearParams:function(){this.parameters={}},setHeader:function(l,i){this.headers[c.headerize(l)]=Array.isArray(i)?i:[i]},getHeader:function(i){return i?this.headers[c.headerize(i)]:void 0},hasHeader:function(i){return i?this.headers.hasOwnProperty(c.headerize(i))&&!0||!1:void 0},deleteHeader:function(l){var i;return l=c.headerize(l),this.headers.hasOwnProperty(l)?(i=this.headers[l],delete this.headers[l],i):void 0},clearHeaders:function(){this.headers={}},clone:function(){return new h(this.scheme,this.user,this.host,this.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},toString:function(){var o,i,p,m,l=[];m=this.scheme+":",this.user&&(m+=c.escapeUser(this.user)+"@"),m+=this.host,(this.port||0===this.port)&&(m+=":"+this.port);for(i in this.parameters){m+=";"+i,null!==this.parameters[i]&&(m+="="+this.parameters[i])}for(o in this.headers){for(p=0;p<this.headers[o].length;p++){l.push(o+"="+this.headers[o][p])}}return l.length>0&&(m+="?"+l.join("&")),m},toAor:function(l){var i;return i=this.scheme+":",this.user&&(i+=c.escapeUser(this.user)+"@"),i+=this.host,l&&(this.port||0===this.port)&&(i+=":"+this.port),i}},h.parse=function(i){return i=d.parse(i,"SIP_URI"),-1!==i?i:void 0}},{"./Constants":1,"./Grammar":6,"./Utils":22}],22:[function(j,f,k){var h={};f.exports=h;var g=j("./Constants"),c=j("./URI"),d=j("./Grammar");h.str_utf8_length=function(i){return unescape(encodeURIComponent(i)).length},h.isFunction=function(i){return void 0!==i&&"[object Function]"===Object.prototype.toString.call(i)?!0:!1},h.isDecimal=function(i){return !isNaN(i)&&parseFloat(i)===parseInt(i,10)},h.isEmpty=function(i){return null===i||""===i||void 0===i||Array.isArray(i)&&0===i.length||"number"==typeof i&&isNaN(i)?!0:void 0},h.createRandomToken=function(o,i){var p,m,l="";for(i=i||32,p=0;o>p;p++){m=Math.random()*i|0,l+=m.toString(i)}return l},h.newTag=function(){return h.createRandomToken(10)},h.newUUID=function(){var i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(m){var l=16*Math.random()|0,o="x"===m?l:3&l|8;return o.toString(16)});return i},h.hostType=function(i){return i?(i=d.parse(i,"host"),-1!==i?i.host_type:void 0):void 0},h.normalizeTarget=function(q,p){var s,m,r,l;if(q){if(q instanceof c){return q}if("string"==typeof q){switch(m=q.split("@"),m.length){case 1:if(!p){return}r=q,l=p;break;case 2:r=m[0],l=m[1];break;default:r=m.slice(0,m.length-1).join("@"),l=m[m.length-1]}return r=r.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(r)&&(r=r.replace(/[\-\.\(\)]/g,"")),q=g.SIP+":"+h.escapeUser(r)+"@"+l,(s=c.parse(q))?s:void 0}}else{}},h.escapeUser=function(i){return encodeURIComponent(decodeURIComponent(i)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},h.headerize=function(q){var m,u={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},p=q.toLowerCase().replace(/_/g,"-").split("-"),o="",i=p.length;for(m=0;i>m;m++){0!==m&&(o+="-"),o+=p[m].charAt(0).toUpperCase()+p[m].substring(1)}return u[o]&&(o=u[o]),o},h.sipErrorCause=function(l){var i;for(i in g.SIP_ERROR_CAUSES){if(-1!==g.SIP_ERROR_CAUSES[i].indexOf(l)){return g.causes[i]}}return g.causes.SIP_FAILURE_CODE},h.getRandomTestNetIP=function(){function i(m,l){return Math.floor(Math.random()*(l-m+1)+m)}return"192.0.2."+i(1,254)},h.calculateMD5=function(az){function ak(l,i){return l<<i|l>>>32-i}function aq(v,p){var w,u,q,m,o;return q=2147483648&v,m=2147483648&p,w=1073741824&v,u=1073741824&p,o=(1073741823&v)+(1073741823&p),w&u?2147483648^o^q^m:w|u?1073741824&o?3221225472^o^q^m:1073741824^o^q^m:o^q^m}function am(l,i,m){return l&i|~l&m}function al(l,i,m){return l&m|i&~m}function at(l,i,m){return l^i^m}function av(l,i,m){return i^(l|~m)}function ap(t,r,n,q,v,p,m){return t=aq(t,aq(aq(am(r,n,q),v),m)),aq(ak(t,p),r)}function aj(t,s,n,q,v,p,m){return t=aq(t,aq(aq(al(s,n,q),v),m)),aq(ak(t,p),s)}function aD(t,q,p,n,v,m,l){return t=aq(t,aq(aq(at(q,p,n),v),l)),aq(ak(t,m),q)}function aB(t,q,p,m,v,n,i){return t=aq(t,aq(aq(av(q,p,m),v),i)),aq(ak(t,n),q)}function aw(x){for(var A,q=x.length,m=q+8,C=(m-m%64)/64,v=16*(C+1),w=new Array(v-1),p=0,y=0;q>y;){A=(y-y%4)/4,p=y%4*8,w[A]=w[A]|x.charCodeAt(y)<<p,y++}return A=(y-y%4)/4,p=y%4*8,w[A]=w[A]|128<<p,w[v-2]=q<<3,w[v-1]=q>>>29,w}function aA(o){var i,p,m="",l="";for(p=0;3>=p;p++){i=o>>>8*p&255,l="0"+i.toString(16),m+=l.substr(l.length-2,2)}return m}function ao(m){m=m.replace(/\r\n/g,"\n");for(var i="",o=0;o<m.length;o++){var l=m.charCodeAt(o);128>l?i+=String.fromCharCode(l):l>127&&2048>l?(i+=String.fromCharCode(l>>6|192),i+=String.fromCharCode(63&l|128)):(i+=String.fromCharCode(l>>12|224),i+=String.fromCharCode(l>>6&63|128),i+=String.fromCharCode(63&l|128))}return i}var ay,ar,ax,B,aE,ai,ad,F,ae,ab=[],af=7,J=12,aC=17,ah=22,Y=5,V=9,ac=14,z=20,Q=4,ag=11,W=16,K=23,X=6,an=10,au=15,Z=21;for(az=ao(az),ab=aw(az),ai=1732584193,ad=4023233417,F=2562383102,ae=271733878,ay=0;ay<ab.length;ay+=16){ar=ai,ax=ad,B=F,aE=ae,ai=ap(ai,ad,F,ae,ab[ay+0],af,3614090360),ae=ap(ae,ai,ad,F,ab[ay+1],J,3905402710),F=ap(F,ae,ai,ad,ab[ay+2],aC,606105819),ad=ap(ad,F,ae,ai,ab[ay+3],ah,3250441966),ai=ap(ai,ad,F,ae,ab[ay+4],af,4118548399),ae=ap(ae,ai,ad,F,ab[ay+5],J,1200080426),F=ap(F,ae,ai,ad,ab[ay+6],aC,2821735955),ad=ap(ad,F,ae,ai,ab[ay+7],ah,4249261313),ai=ap(ai,ad,F,ae,ab[ay+8],af,1770035416),ae=ap(ae,ai,ad,F,ab[ay+9],J,2336552879),F=ap(F,ae,ai,ad,ab[ay+10],aC,4294925233),ad=ap(ad,F,ae,ai,ab[ay+11],ah,2304563134),ai=ap(ai,ad,F,ae,ab[ay+12],af,1804603682),ae=ap(ae,ai,ad,F,ab[ay+13],J,4254626195),F=ap(F,ae,ai,ad,ab[ay+14],aC,2792965006),ad=ap(ad,F,ae,ai,ab[ay+15],ah,1236535329),ai=aj(ai,ad,F,ae,ab[ay+1],Y,4129170786),ae=aj(ae,ai,ad,F,ab[ay+6],V,3225465664),F=aj(F,ae,ai,ad,ab[ay+11],ac,643717713),ad=aj(ad,F,ae,ai,ab[ay+0],z,3921069994),ai=aj(ai,ad,F,ae,ab[ay+5],Y,3593408605),ae=aj(ae,ai,ad,F,ab[ay+10],V,38016083),F=aj(F,ae,ai,ad,ab[ay+15],ac,3634488961),ad=aj(ad,F,ae,ai,ab[ay+4],z,3889429448),ai=aj(ai,ad,F,ae,ab[ay+9],Y,568446438),ae=aj(ae,ai,ad,F,ab[ay+14],V,3275163606),F=aj(F,ae,ai,ad,ab[ay+3],ac,4107603335),ad=aj(ad,F,ae,ai,ab[ay+8],z,1163531501),ai=aj(ai,ad,F,ae,ab[ay+13],Y,2850285829),ae=aj(ae,ai,ad,F,ab[ay+2],V,4243563512),F=aj(F,ae,ai,ad,ab[ay+7],ac,1735328473),ad=aj(ad,F,ae,ai,ab[ay+12],z,2368359562),ai=aD(ai,ad,F,ae,ab[ay+5],Q,4294588738),ae=aD(ae,ai,ad,F,ab[ay+8],ag,2272392833),F=aD(F,ae,ai,ad,ab[ay+11],W,1839030562),ad=aD(ad,F,ae,ai,ab[ay+14],K,4259657740),ai=aD(ai,ad,F,ae,ab[ay+1],Q,2763975236),ae=aD(ae,ai,ad,F,ab[ay+4],ag,1272893353),F=aD(F,ae,ai,ad,ab[ay+7],W,4139469664),ad=aD(ad,F,ae,ai,ab[ay+10],K,3200236656),ai=aD(ai,ad,F,ae,ab[ay+13],Q,681279174),ae=aD(ae,ai,ad,F,ab[ay+0],ag,3936430074),F=aD(F,ae,ai,ad,ab[ay+3],W,3572445317),ad=aD(ad,F,ae,ai,ab[ay+6],K,76029189),ai=aD(ai,ad,F,ae,ab[ay+9],Q,3654602809),ae=aD(ae,ai,ad,F,ab[ay+12],ag,3873151461),F=aD(F,ae,ai,ad,ab[ay+15],W,530742520),ad=aD(ad,F,ae,ai,ab[ay+2],K,3299628645),ai=aB(ai,ad,F,ae,ab[ay+0],X,4096336452),ae=aB(ae,ai,ad,F,ab[ay+7],an,1126891415),F=aB(F,ae,ai,ad,ab[ay+14],au,2878612391),ad=aB(ad,F,ae,ai,ab[ay+5],Z,4237533241),ai=aB(ai,ad,F,ae,ab[ay+12],X,1700485571),ae=aB(ae,ai,ad,F,ab[ay+3],an,2399980690),F=aB(F,ae,ai,ad,ab[ay+10],au,4293915773),ad=aB(ad,F,ae,ai,ab[ay+1],Z,2240044497),ai=aB(ai,ad,F,ae,ab[ay+8],X,1873313359),ae=aB(ae,ai,ad,F,ab[ay+15],an,4264355552),F=aB(F,ae,ai,ad,ab[ay+6],au,2734768916),ad=aB(ad,F,ae,ai,ab[ay+13],Z,1309151649),ai=aB(ai,ad,F,ae,ab[ay+4],X,4149444226),ae=aB(ae,ai,ad,F,ab[ay+11],an,3174756917),F=aB(F,ae,ai,ad,ab[ay+2],au,718787259),ad=aB(ad,F,ae,ai,ab[ay+9],Z,3951481745),ai=aq(ai,ar),ad=aq(ad,ax),F=aq(F,B),ae=aq(ae,aE)}var aa=aA(ai)+aA(ad)+aA(F)+aA(ae);return aa.toLowerCase()}},{"./Constants":1,"./Grammar":6,"./URI":21}],23:[function(L,x,E){function A(g,c,h){var f,d;for(M=g,B=c,K=h,f=k.length;f--;){if(d=k[f](M),d===!1){return !1}}if(M instanceof j.IncomingRequest){for(f=q.length;f--;){if(d=q[f](M),d===!1){return !1}}}else{if(M instanceof j.IncomingResponse){for(f=z.length;f--;){if(d=z[f](M),d===!1){return !1}}}}return !0}function y(){return"sip"!==M.s("to").uri.scheme?(I(416),!1):void 0}function G(){return M.to_tag||M.call_id.substr(0,5)!==B.configuration.jssip_id?void 0:(I(482),!1)}function H(){var d=P.str_utf8_length(M.body),c=M.getHeader("content-length");return c>d?(I(400),!1):void 0}function D(){var g,c,h=M.from_tag,f=M.call_id,d=M.cseq;if(!M.to_tag){if(M.method===J.INVITE){if(B.transactions.ist[M.via_branch]){return !1}for(c in B.transactions.ist){if(g=B.transactions.ist[c],g.request.from_tag===h&&g.request.call_id===f&&g.request.cseq===d){return I(482),!1}}}else{if(B.transactions.nist[M.via_branch]){return !1}for(c in B.transactions.nist){if(g=B.transactions.nist[c],g.request.from_tag===h&&g.request.call_id===f&&g.request.cseq===d){return I(482),!1}}}}}function w(){return M.getHeaders("via").length>1?(F("more than one Via header field present in the response, dropping the response"),!1):void 0}function O(){var d=P.str_utf8_length(M.body),c=M.getHeader("content-length");return c>d?(F("message body length is lower than the value in Content-Length header field, dropping the response"),!1):void 0}function N(){for(var d=["from","to","call_id","cseq","via"],c=d.length;c--;){if(!M.hasHeader(d[c])){return F("missing mandatory header field : "+d[c]+", dropping the response"),!1}}}function I(h){var d,i="SIP/2.0 "+h+" "+J.REASON_PHRASE[h]+"\r\n",g=M.getHeaders("via"),f=g.length,c=0;for(c;f>c;c++){i+="Via: "+g[c]+"\r\n"}d=M.getHeader("To"),M.to_tag||(d+=";tag="+P.newTag()),i+="To: "+d+"\r\n",i+="From: "+M.getHeader("From")+"\r\n",i+="Call-ID: "+M.call_id+"\r\n",i+="CSeq: "+M.cseq+" "+M.method+"\r\n",i+="\r\n",K.send(i)}x.exports=A;var M,B,K,F=L("debug")("JsSIP:sanityCheck"),J=L("./Constants"),j=L("./SIPMessage"),P=L("./Utils"),q=[],z=[],k=[];q.push(y),q.push(G),q.push(H),q.push(D),z.push(w),z.push(O),k.push(N)},{"./Constants":1,"./SIPMessage":16,"./Utils":22,debug:29}],24:[function(j,f,m){function h(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function g(i){return"function"==typeof i}function c(i){return"number"==typeof i}function d(i){return"object"==typeof i&&null!==i}function k(i){return void 0===i}f.exports=h,h.EventEmitter=h,h.prototype._events=void 0,h.prototype._maxListeners=void 0,h.defaultMaxListeners=10,h.prototype.setMaxListeners=function(i){if(!c(i)||0>i||isNaN(i)){throw TypeError("n must be a positive number")}return this._maxListeners=i,this},h.prototype.emit=function(v){var q,w,s,o,p,i;if(this._events||(this._events={}),"error"===v&&(!this._events.error||d(this._events.error)&&!this._events.error.length)){if(q=arguments[1],q instanceof Error){throw q}throw TypeError('Uncaught, unspecified "error" event.')}if(w=this._events[v],k(w)){return !1}if(g(w)){switch(arguments.length){case 1:w.call(this);break;case 2:w.call(this,arguments[1]);break;case 3:w.call(this,arguments[1],arguments[2]);break;default:for(s=arguments.length,o=new Array(s-1),p=1;s>p;p++){o[p-1]=arguments[p]}w.apply(this,o)}}else{if(d(w)){for(s=arguments.length,o=new Array(s-1),p=1;s>p;p++){o[p-1]=arguments[p]}for(i=w.slice(),s=i.length,p=0;s>p;p++){i[p].apply(this,o)}}}return !0},h.prototype.addListener=function(l,i){var o;if(!g(i)){throw TypeError("listener must be a function")}if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",l,g(i.listener)?i.listener:i),this._events[l]?d(this._events[l])?this._events[l].push(i):this._events[l]=[this._events[l],i]:this._events[l]=i,d(this._events[l])&&!this._events[l].warned){var o;o=k(this._maxListeners)?h.defaultMaxListeners:this._maxListeners,o&&o>0&&this._events[l].length>o&&(this._events[l].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[l].length),"function"==typeof console.trace&&console.trace())}return this},h.prototype.on=h.prototype.addListener,h.prototype.once=function(o,i){function p(){this.removeListener(o,p),l||(l=!0,i.apply(this,arguments))}if(!g(i)){throw TypeError("listener must be a function")}var l=!1;return p.listener=i,this.on(o,p),this},h.prototype.removeListener=function(s,p){var v,q,i,u;if(!g(p)){throw TypeError("listener must be a function")}if(!this._events||!this._events[s]){return this}if(v=this._events[s],i=v.length,q=-1,v===p||g(v.listener)&&v.listener===p){delete this._events[s],this._events.removeListener&&this.emit("removeListener",s,p)}else{if(d(v)){for(u=i;u-->0;){if(v[u]===p||v[u].listener&&v[u].listener===p){q=u;break}}if(0>q){return this}1===v.length?(v.length=0,delete this._events[s]):v.splice(q,1),this._events.removeListener&&this.emit("removeListener",s,p)}}return this},h.prototype.removeAllListeners=function(l){var i,o;if(!this._events){return this}if(!this._events.removeListener){return 0===arguments.length?this._events={}:this._events[l]&&delete this._events[l],this}if(0===arguments.length){for(i in this._events){"removeListener"!==i&&this.removeAllListeners(i)}return this.removeAllListeners("removeListener"),this._events={},this}if(o=this._events[l],g(o)){this.removeListener(l,o)}else{for(;o.length;){this.removeListener(l,o[o.length-1])}}return delete this._events[l],this},h.prototype.listeners=function(l){var i;return i=this._events&&this._events[l]?g(this._events[l])?[this._events[l]]:this._events[l].slice():[]},h.listenerCount=function(l,i){var o;return o=l._events&&l._events[i]?g(l._events[i])?1:l._events[i].length:0}},{}],25:[function(d,c,f){c.exports="function"==typeof Object.create?function(h,g){h.super_=g,h.prototype=Object.create(g.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}})}:function(h,g){h.super_=g;var i=function(){};i.prototype=g.prototype,h.prototype=new i,h.prototype.constructor=h}},{}],26:[function(p,x,g){function d(){q=!1,f.length?v=f.concat(v):m=-1,v.length&&y()}function y(){if(!q){var h=setTimeout(d);q=!0;for(var c=v.length;c;){for(f=v,v=[];++m<c;){f[m].run()}m=-1,c=v.length}f=null,q=!1,clearTimeout(h)}}function j(h,c){this.fun=h,this.array=c}function k(){}var f,w=x.exports={},v=[],q=!1,m=-1;w.nextTick=function(h){var c=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){c[i-1]=arguments[i]}}v.push(new j(h,c)),1!==v.length||q||setTimeout(y,0)},j.prototype.run=function(){this.fun.apply(null,this.array)},w.title="browser",w.browser=!0,w.env={},w.argv=[],w.version="",w.versions={},w.on=k,w.addListener=k,w.once=k,w.off=k,w.removeListener=k,w.removeAllListeners=k,w.emit=k,w.binding=function(c){throw new Error("process.binding is not supported")},w.cwd=function(){return"/"},w.chdir=function(c){throw new Error("process.chdir is not supported")},w.umask=function(){return 0}},{}],27:[function(d,c,f){c.exports=function(g){return g&&"object"==typeof g&&"function"==typeof g.copy&&"function"==typeof g.fill&&"function"==typeof g.readUInt8}},{}],28:[function(d,c,f){(function(W,aa){function Y(i,g){var h={seen:[],stylize:ag};return arguments.length>=3&&(h.depth=arguments[2]),arguments.length>=4&&(h.colors=arguments[3]),ae(g)?h.showHidden=g:g&&f._extend(h,g),k(h.showHidden)&&(h.showHidden=!1),k(h.depth)&&(h.depth=2),k(h.colors)&&(h.colors=!1),k(h.customInspect)&&(h.customInspect=!0),h.colors&&(h.stylize=af),Q(h,i,h.depth)}function af(h,g){var i=Y.styles[g];return i?"["+Y.colors[i][0]+"m"+h+"["+Y.colors[i][1]+"m":h}function ag(h,g){return h}function ad(h){var g={};return h.forEach(function(i,l){g[i]=!0}),g}function Q(A,I,h){if(A.customInspect&&I&&am(I.inspect)&&I.inspect!==f.inspect&&(!I.constructor||I.constructor.prototype!==I)){var N=I.inspect(h,A);return L(N)||(N=Q(A,N,h)),N}var u=an(A,I);if(u){return u}var x=Object.keys(I),p=ad(x);if(A.showHidden&&(x=Object.getOwnPropertyNames(I)),n(I)&&(x.indexOf("message")>=0||x.indexOf("description")>=0)){return al(I)}if(0===x.length){if(am(I)){var y=I.name?": "+I.name:"";return A.stylize("[Function"+y+"]","special")}if(ab(I)){return A.stylize(RegExp.prototype.toString.call(I),"regexp")}if(G(I)){return A.stylize(Date.prototype.toString.call(I),"date")}if(n(I)){return al(I)}}var v="",D=!1,o=["{","}"];if(aj(I)&&(D=!0,o=["[","]"]),am(I)){var w=I.name?": "+I.name:"";v=" [Function"+w+"]"}if(ab(I)&&(v=" "+RegExp.prototype.toString.call(I)),G(I)&&(v=" "+Date.prototype.toUTCString.call(I)),n(I)&&(v=" "+al(I)),0===x.length&&(!D||0==I.length)){return o[0]+v+o[1]}if(0>h){return ab(I)?A.stylize(RegExp.prototype.toString.call(I),"regexp"):A.stylize("[Object]","special")}A.seen.push(I);var M;return M=D?ah(A,I,h,p,x):x.map(function(g){return ak(A,I,h,p,g,D)}),A.seen.pop(),ac(M,v,o)}function an(h,g){if(k(g)){return h.stylize("undefined","undefined")}if(L(g)){var i="'"+JSON.stringify(g).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return h.stylize(i,"string")}return ao(g)?h.stylize(""+g,"number"):ae(g)?h.stylize(""+g,"boolean"):ai(g)?h.stylize("null","null"):void 0}function al(g){return"["+Error.prototype.toString.call(g)+"]"}function ah(v,m,x,u,p){for(var g=[],h=0,w=m.length;w>h;++h){g.push(e(m,String(h))?ak(v,m,x,u,String(h),!0):"")}return p.forEach(function(i){i.match(/^\d+$/)||g.push(ak(v,m,x,u,i,!0))}),g}function ak(v,x,m,g,y,p){var u,h,w;if(w=Object.getOwnPropertyDescriptor(x,y)||{value:x[y]},w.get?h=w.set?v.stylize("[Getter/Setter]","special"):v.stylize("[Getter]","special"):w.set&&(h=v.stylize("[Setter]","special")),e(g,y)||(u="["+y+"]"),h||(v.seen.indexOf(w.value)<0?(h=ai(m)?Q(v,w.value,null):Q(v,w.value,m-1),h.indexOf("\n")>-1&&(h=p?h.split("\n").map(function(i){return"  "+i}).join("\n").substr(2):"\n"+h.split("\n").map(function(i){return"   "+i}).join("\n"))):h=v.stylize("[Circular]","special")),k(u)){if(p&&y.match(/^\d+$/)){return h}u=JSON.stringify(""+y),u.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(u=u.substr(1,u.length-2),u=v.stylize(u,"name")):(u=u.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),u=v.stylize(u,"string"))}return u+": "+h}function ac(l,g,m){var i=0,h=l.reduce(function(p,o){return i++,o.indexOf("\n")>=0&&i++,p+o.replace(/\u001b\[\d\d?m/g,"").length+1},0);return h>60?m[0]+(""===g?"":g+"\n ")+" "+l.join(",\n  ")+" "+m[1]:m[0]+g+" "+l.join(", ")+" "+m[1]}function aj(g){return Array.isArray(g)}function ae(g){return"boolean"==typeof g}function ai(g){return null===g}function j(g){return null==g}function ao(g){return"number"==typeof g}function L(g){return"string"==typeof g}function Z(g){return"symbol"==typeof g}function k(g){return void 0===g}function ab(g){return V(g)&&"[object RegExp]"===J(g)}function V(g){return"object"==typeof g&&null!==g}function G(g){return V(g)&&"[object Date]"===J(g)}function n(g){return V(g)&&("[object Error]"===J(g)||g instanceof Error)}function am(g){return"function"==typeof g}function K(g){return null===g||"boolean"==typeof g||"number"==typeof g||"string"==typeof g||"symbol"==typeof g||"undefined"==typeof g}function J(g){return Object.prototype.toString.call(g)}function B(g){return 10>g?"0"+g.toString(10):g.toString(10)}function X(){var h=new Date,g=[B(h.getHours()),B(h.getMinutes()),B(h.getSeconds())].join(":");return[h.getDate(),q[h.getMonth()],g].join(" ")}function e(h,g){return Object.prototype.hasOwnProperty.call(h,g)}var z=/%[sdj%]/g;f.format=function(s){if(!L(s)){for(var m=[],v=0;v<arguments.length;v++){m.push(Y(arguments[v]))}return m.join(" ")}for(var v=1,p=arguments,g=p.length,h=String(s).replace(z,function(l){if("%%"===l){return"%"}if(v>=g){return l}switch(l){case"%s":return String(p[v++]);case"%d":return Number(p[v++]);case"%j":try{return JSON.stringify(p[v++])}catch(i){return"[Circular]"}default:return l}}),u=p[v];g>v;u=p[++v]){h+=ai(u)||!V(u)?" "+u:" "+Y(u)}return h},f.deprecate=function(o,m){function g(){if(!h){if(W.throwDeprecation){throw new Error(m)}W.traceDeprecation?console.trace(m):console.error(m),h=!0}return o.apply(this,arguments)}if(k(aa.process)){return function(){return f.deprecate(o,m).apply(this,arguments)}}if(W.noDeprecation===!0){return o}var h=!1;return g};var H,F={};f.debuglog=function(h){if(k(H)&&(H=W.env.NODE_DEBUG||""),h=h.toUpperCase(),!F[h]){if(new RegExp("\\b"+h+"\\b","i").test(H)){var g=W.pid;F[h]=function(){var i=f.format.apply(f,arguments);console.error("%s %d: %s",h,g,i)}}else{F[h]=function(){}}}return F[h]},f.inspect=Y,Y.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},Y.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},f.isArray=aj,f.isBoolean=ae,f.isNull=ai,f.isNullOrUndefined=j,f.isNumber=ao,f.isString=L,f.isSymbol=Z,f.isUndefined=k,f.isRegExp=ab,f.isObject=V,f.isDate=G,f.isError=n,f.isFunction=am,f.isPrimitive=K,f.isBuffer=d("./support/isBuffer");var q=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];f.log=function(){console.log("%s - %s",X(),f.format.apply(f,arguments))},f.inherits=d("inherits"),f._extend=function(i,g){if(!g||!V(g)){return i}for(var l=Object.keys(g),h=l.length;h--;){i[l[h]]=g[l[h]]}return i}}).call(this,d("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":27,_process:26,inherits:25}],29:[function(j,m,f){function c(){return"WebkitAppearance" in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function p(){var u=arguments,n=this.useColors;if(u[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+u[0]+(n?"%c ":" ")+"+"+f.humanize(this.diff),!n){return u}var q="color: "+this.color;u=[u[0],q,"color: inherit"].concat(Array.prototype.slice.call(u,1));var o=0,i=0;return u[0].replace(/%[a-z%]/g,function(l){"%%"!==l&&(o++,"%c"===l&&(i=o))}),u.splice(i,0,q),u}function g(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function h(l){try{null==l?f.storage.removeItem("debug"):f.storage.debug=l}catch(i){}}function d(){var l;try{l=f.storage.debug}catch(i){}return l}function k(){try{return window.localStorage}catch(i){}}f=m.exports=j("./debug"),f.log=g,f.formatArgs=p,f.save=h,f.load=d,f.useColors=c,f.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:k(),f.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],f.formatters.j=function(i){return JSON.stringify(i)},f.enable(d())},{"./debug":30}],30:[function(k,v,g){function d(){return g.colors[m++%g.colors.length]}function w(o){function i(){}function n(){var z=n,y=+new Date,r=y-(p||y);z.diff=r,z.prev=p,z.curr=y,p=y,null==z.useColors&&(z.useColors=g.useColors()),null==z.color&&z.useColors&&(z.color=d());var x=Array.prototype.slice.call(arguments);x[0]=g.coerce(x[0]),"string"!=typeof x[0]&&(x=["%o"].concat(x));var A=0;x[0]=x[0].replace(/%([a-z%])/g,function(u,C){if("%%"===u){return u}A++;var B=g.formatters[C];if("function"==typeof B){var e=x[A];u=B.call(z,e),x.splice(A,1),A--}return u}),"function"==typeof g.formatArgs&&(x=g.formatArgs.apply(z,x));var s=n.log||g.log||console.log.bind(console);s.apply(z,x)}i.enabled=!1,n.enabled=!0;var c=g.enabled(o)?n:i;return c.namespace=o,c}function h(n){g.save(n);for(var c=(n||"").split(/[\s,]+/),l=c.length,i=0;l>i;i++){c[i]&&(n=c[i].replace(/\*/g,".*?"),"-"===n[0]?g.skips.push(new RegExp("^"+n.substr(1)+"$")):g.names.push(new RegExp("^"+n+"$")))}}function j(){g.enable("")}function f(l){var c,i;for(c=0,i=g.skips.length;i>c;c++){if(g.skips[c].test(l)){return !1}}for(c=0,i=g.names.length;i>c;c++){if(g.names[c].test(l)){return !0}}return !1}function q(c){return c instanceof Error?c.stack||c.message:c}g=v.exports=w,g.coerce=q,g.disable=j,g.enable=h,g.enabled=f,g.humanize=k("ms"),g.names=[],g.skips=[],g.formatters={};var p,m=0},{ms:31}],31:[function(p,x,g){function d(i){if(i=""+i,!(i.length>10000)){var c=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(i);if(c){var l=parseFloat(c[1]),h=(c[2]||"ms").toLowerCase();switch(h){case"years":case"year":case"yrs":case"yr":case"y":return l*m;case"days":case"day":case"d":return l*q;case"hours":case"hour":case"hrs":case"hr":case"h":return l*v;case"minutes":case"minute":case"mins":case"min":case"m":return l*w;case"seconds":case"second":case"secs":case"sec":case"s":return l*f;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l}}}}function y(c){return c>=q?Math.round(c/q)+"d":c>=v?Math.round(c/v)+"h":c>=w?Math.round(c/w)+"m":c>=f?Math.round(c/f)+"s":c+"ms"}function j(c){return k(c,q,"day")||k(c,v,"hour")||k(c,w,"minute")||k(c,f,"second")||c+" ms"}function k(h,c,i){return c>h?void 0:1.5*c>h?Math.floor(h/c)+" "+i:Math.ceil(h/c)+" "+i+"s"}var f=1000,w=60*f,v=60*w,q=24*v,m=365.25*q;x.exports=function(h,c){return c=c||{},"string"==typeof h?d(h):c["long"]?j(h):y(h)}},{}],32:[function(d,c,f){(function(z){function w(h){function g(l){return function(){throw new Error("rtcninja: WebRTC not supported, missing "+l+" [browser: "+D.name+" "+D.version+"]")}}if(j&&D.chrome&&K>=32||D.android&&D.chrome&&K>=39||j&&D.opera&&K>=27||D.android&&D.opera&&K>=24||D.android&&D.webkit&&!D.chrome&&K>=37||B.webkitGetUserMedia&&q.webkitRTCPeerConnection){t=!0,J=B.webkitGetUserMedia.bind(B),I=q.webkitRTCPeerConnection,E=q.RTCSessionDescription,H=q.RTCIceCandidate,x=q.MediaStreamTrack,x&&x.getSources?G=x.getSources.bind(x):B.getMediaDevices&&(G=B.getMediaDevices.bind(B)),A=function(m,l){return m.src=URL.createObjectURL(l),m},F=!0,e=!1}else{if(j&&D.firefox&&K>=22||D.android&&D.firefox&&K>=33||B.mozGetUserMedia&&q.mozRTCPeerConnection){t=!0,J=B.mozGetUserMedia.bind(B),I=q.mozRTCPeerConnection,E=q.mozRTCSessionDescription,H=q.mozRTCIceCandidate,x=q.MediaStreamTrack,A=function(m,l){return m.src=URL.createObjectURL(l),m},F=!1,e=!1}else{if(h.plugin&&"function"==typeof h.plugin.isRequired&&h.plugin.isRequired()&&"function"==typeof h.plugin.isInstalled&&h.plugin.isInstalled()){var i=h.plugin["interface"];t=!0,J=i.getUserMedia,I=i.RTCPeerConnection,E=i.RTCSessionDescription,H=i.RTCIceCandidate,x=i.MediaStreamTrack,D.safari&&(x&&x.getSources?G=x.getSources.bind(x):B.getMediaDevices&&(G=B.getMediaDevices.bind(B))),A=i.attachMediaStream,F=i.canRenegotiate,e=!0}else{B.getUserMedia&&q.RTCPeerConnection&&(t=!0,J=B.getUserMedia.bind(B),I=q.RTCPeerConnection,E=q.RTCSessionDescription,H=q.RTCIceCandidate,x=q.MediaStreamTrack,x&&x.getSources?G=x.getSources.bind(x):B.getMediaDevices&&(G=B.getMediaDevices.bind(B)),A=q.attachMediaStream||function(m,l){return m.src=URL.createObjectURL(l),m},F=!1,e=!1)}}}return w.hasWebRTC=function(){return t},w.getUserMedia=J?function(o,l,p){y("getUserMedia() | constraints: %o",o);try{J(o,function(n){y("getUserMedia() | success"),l&&l(n)},function(n){y("getUserMedia() | error:",n),p&&p(n)})}catch(m){k("getUserMedia() | error:",m),p&&p(m)}}:function(m,o,l){k("getUserMedia() | WebRTC not supported"),l?l(new Error("rtcninja: WebRTC not supported, missing getUserMedia [browser: "+D.name+" "+D.version+"]")):g("getUserMedia")},w.RTCPeerConnection=I||g("RTCPeerConnection"),w.RTCSessionDescription=E||g("RTCSessionDescription"),w.RTCIceCandidate=H||g("RTCIceCandidate"),w.MediaStreamTrack=x||g("MediaStreamTrack"),w.getMediaDevices=G,w.attachMediaStream=A||g("attachMediaStream"),w.canRenegotiate=F,w.closeMediaStream=function(o){if(o){if(x&&x.prototype&&x.prototype.stop){y("closeMediaStream() | calling stop() on all the MediaStreamTrack");var l,p,m;if(o.getTracks){for(l=o.getTracks(),p=0,m=l.length;m>p;p+=1){l[p].stop()}}else{for(l=o.getAudioTracks(),p=0,m=l.length;m>p;p+=1){l[p].stop()}for(l=o.getVideoTracks(),p=0,m=l.length;m>p;p+=1){l[p].stop()}}}else{"function"==typeof o.stop&&(y("closeMediaStream() | calling stop() on the MediaStream"),o.stop())}}},w.fixPeerConnectionConfig=function(v){var o,C,u,p,m;for(Array.isArray(v.iceServers)||(v.iceServers=[]),o=0,C=v.iceServers.length;C>o;o+=1){u=v.iceServers[o],p=u.hasOwnProperty("urls"),m=u.hasOwnProperty("url"),"object"==typeof u&&(p&&!m?u.url=Array.isArray(u.urls)?u.urls[0]:u.urls:!p&&m&&(u.urls=Array.isArray(u.url)?u.url.slice():u.url),m&&Array.isArray(u.url)&&(u.url=u.url[0]))}},w.fixRTCOfferOptions=function(l){l=l||{},e?(l.offerToReceiveAudio&&(l.mandatory=l.mandatory||{},l.mandatory.OfferToReceiveAudio=!0),l.offerToReceiveVideo&&(l.mandatory=l.mandatory||{},l.mandatory.OfferToReceiveVideo=!0)):(l.mandatory&&l.mandatory.OfferToReceiveAudio&&(l.offerToReceiveAudio=1),l.mandatory&&l.mandatory.OfferToReceiveVideo&&(l.offerToReceiveVideo=1),delete l.mandatory)},w}c.exports=w;var q,B,D=d("bowser").browser,y=d("debug")("rtcninja:Adapter"),k=d("debug")("rtcninja:ERROR:Adapter"),J=null,I=null,E=null,H=null,x=null,G=null,A=null,F=!1,e=!1,K=Number(D.version)||0,j=!(D.mobile&&D.tablet),t=!1;k.log=console.warn.bind(console),q=z.window||z,B=q.navigator||{}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{bowser:36,debug:29}],33:[function(A,F,q){function g(d,c){y("new | pcConfig: %o",d),G.call(this,d),this.pcConstraints=c,this.ourLocalDescription=null,this.ourSignalingState=null,this.ourIceConnectionState=null,this.ourIceGatheringState=null,this.timerGatheringTimeout=null,this.timerGatheringTimeoutAfterRelay=null,this.ignoreIceGathering=!1,this.closed=!1,k.call(this),D.call(this)}function G(c){this.pcConfig=C(!0,c),j.fixPeerConnectionConfig(this.pcConfig),this.options={iceTransportsRelay:"relay"===this.pcConfig.iceTransports,iceTransportsNone:"none"===this.pcConfig.iceTransports,gatheringTimeout:this.pcConfig.gatheringTimeout,gatheringTimeoutAfterRelay:this.pcConfig.gatheringTimeoutAfterRelay},delete this.pcConfig.gatheringTimeout,delete this.pcConfig.gatheringTimeoutAfterRelay,y("setConfigurationAndOptions | processed pcConfig: %o",this.pcConfig)}function w(){return this.closed||this.pc&&"closed"===this.pc.iceConnectionState}function x(){var d=this,c=this.pc;c.onnegotiationneeded=function(e){w.call(d)||(y("onnegotiationneeded()"),d.onnegotiationneeded&&d.onnegotiationneeded(e))},c.onicecandidate=function(e){var i,h,f;if(!w.call(d)&&!d.ignoreIceGathering&&!d.options.iceTransportsNone){if(i=e.candidate){if(h=z.REGEXP_RELAY_CANDIDATE.test(i.candidate),d.options.iceTransportsRelay&&!h){return}h&&!d.timerGatheringTimeoutAfterRelay&&"number"==typeof d.options.gatheringTimeoutAfterRelay&&(y("onicecandidate() | first relay candidate found, ending gathering in %d ms",d.options.gatheringTimeoutAfterRelay),d.timerGatheringTimeoutAfterRelay=setTimeout(function(){w.call(d)||(y("forced end of candidates after timeout"),delete d.timerGatheringTimeoutAfterRelay,clearTimeout(d.timerGatheringTimeout),delete d.timerGatheringTimeout,d.ignoreIceGathering=!0,d.onicecandidate&&d.onicecandidate({candidate:null},null))},d.options.gatheringTimeoutAfterRelay)),f=new j.RTCIceCandidate({sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,candidate:i.candidate}),null===v.normalizeCandidate&&(z.REGEXP_NORMALIZED_CANDIDATE.test(i.candidate)?v.normalizeCandidate=!1:(y('onicecandidate() | normalizing ICE candidates syntax (remove "a=" and "\\r\\n")'),v.normalizeCandidate=!0)),v.normalizeCandidate&&(f.candidate=i.candidate.replace(z.REGEXP_FIX_CANDIDATE,"")),y("onicecandidate() | m%d(%s) %s",f.sdpMLineIndex,f.sdpMid||"no mid",f.candidate),d.onicecandidate&&d.onicecandidate(e,f)}else{y("onicecandidate() | end of candidates"),clearTimeout(d.timerGatheringTimeout),delete d.timerGatheringTimeout,clearTimeout(d.timerGatheringTimeoutAfterRelay),delete d.timerGatheringTimeoutAfterRelay,d.onicecandidate&&d.onicecandidate(e,null)}}},c.onaddstream=function(e){w.call(d)||(y("onaddstream() | stream: %o",e.stream),d.onaddstream&&d.onaddstream(e,e.stream))},c.onremovestream=function(e){w.call(d)||(y("onremovestream() | stream: %o",e.stream),d.onremovestream&&d.onremovestream(e,e.stream))},c.ondatachannel=function(e){w.call(d)||(y("ondatachannel() | datachannel: %o",e.channel),d.ondatachannel&&d.ondatachannel(e,e.channel))},c.onsignalingstatechange=function(e){c.signalingState!==d.ourSignalingState&&(y("onsignalingstatechange() | signalingState: %s",c.signalingState),d.ourSignalingState=c.signalingState,d.onsignalingstatechange&&d.onsignalingstatechange(e,c.signalingState))},c.oniceconnectionstatechange=function(e){c.iceConnectionState!==d.ourIceConnectionState&&(y("oniceconnectionstatechange() | iceConnectionState: %s",c.iceConnectionState),d.ourIceConnectionState=c.iceConnectionState,d.oniceconnectionstatechange&&d.oniceconnectionstatechange(e,c.iceConnectionState))},c.onicegatheringstatechange=function(e){w.call(d)||c.iceGatheringState!==d.ourIceGatheringState&&(y("onicegatheringstatechange() | iceGatheringState: %s",c.iceGatheringState),d.ourIceGatheringState=c.iceGatheringState,d.onicegatheringstatechange&&d.onicegatheringstatechange(e,c.iceGatheringState))},c.onidentityresult=function(e){w.call(d)||(y("onidentityresult()"),d.onidentityresult&&d.onidentityresult(e))},c.onpeeridentity=function(e){w.call(d)||(y("onpeeridentity()"),d.onpeeridentity&&d.onpeeridentity(e))},c.onidpassertionerror=function(e){w.call(d)||(y("onidpassertionerror()"),d.onidpassertionerror&&d.onidpassertionerror(e))},c.onidpvalidationerror=function(e){w.call(d)||(y("onidpvalidationerror()"),d.onidpvalidationerror&&d.onidpvalidationerror(e))}}function k(){this.pc=this.pcConstraints?new j.RTCPeerConnection(this.pcConfig,this.pcConstraints):new j.RTCPeerConnection(this.pcConfig),x.call(this)}function E(){var d=this.pc,c=this.options,f=null;return d.localDescription?(c.iceTransportsRelay?f=d.localDescription.sdp.replace(z.REGEXP_SDP_NON_RELAY_CANDIDATES,""):c.iceTransportsNone&&(f=d.localDescription.sdp.replace(z.REGEXP_SDP_CANDIDATES,"")),this.ourLocalDescription=new j.RTCSessionDescription({type:d.localDescription.type,sdp:f||d.localDescription.sdp}),this.ourLocalDescription):(this.ourLocalDescription=null,null)}function D(){var c=this;Object.defineProperties(this,{peerConnection:{get:function(){return c.pc}},signalingState:{get:function(){return c.pc.signalingState}},iceConnectionState:{get:function(){return c.pc.iceConnectionState}},iceGatheringState:{get:function(){return c.pc.iceGatheringState}},localDescription:{get:function(){return E.call(c)}},remoteDescription:{get:function(){return c.pc.remoteDescription}},peerIdentity:{get:function(){return c.pc.peerIdentity}}})}F.exports=g;var C=A("merge"),y=A("debug")("rtcninja:RTCPeerConnection"),B=A("debug")("rtcninja:ERROR:RTCPeerConnection"),j=A("./Adapter"),z={REGEXP_NORMALIZED_CANDIDATE:new RegExp(/^candidate:/i),REGEXP_FIX_CANDIDATE:new RegExp(/(^a=|\r|\n)/gi),REGEXP_RELAY_CANDIDATE:new RegExp(/ relay /i),REGEXP_SDP_CANDIDATES:new RegExp(/^a=candidate:.*\r\n/gim),REGEXP_SDP_NON_RELAY_CANDIDATES:new RegExp(/^a=candidate:(.(?!relay ))*\r\n/gim)},v={normalizeCandidate:null};B.log=console.warn.bind(console),g.prototype.createOffer=function(f,c,h){y("createOffer()");var d=this;j.fixRTCOfferOptions(h),this.pc.createOffer(function(e){w.call(d)||(y("createOffer() | success"),f&&f(e))},function(i){w.call(d)||(B("createOffer() | error:",i),c&&c(i))},h)},g.prototype.createAnswer=function(f,c,h){y("createAnswer()");var d=this;this.pc.createAnswer(function(e){w.call(d)||(y("createAnswer() | success"),f&&f(e))},function(i){w.call(d)||(B("createAnswer() | error:",i),c&&c(i))},h)},g.prototype.setLocalDescription=function(h,c,i){function f(){"number"==typeof d.options.gatheringTimeout&&"complete"!==d.pc.iceGatheringState&&(y("setLocalDescription() | ending gathering in %d ms (gatheringTimeout option)",d.options.gatheringTimeout),d.timerGatheringTimeout=setTimeout(function(){w.call(d)||(y("forced end of candidates after gatheringTimeout timeout"),delete d.timerGatheringTimeout,clearTimeout(d.timerGatheringTimeoutAfterRelay),delete d.timerGatheringTimeoutAfterRelay,d.ignoreIceGathering=!0,d.onicecandidate&&d.onicecandidate({candidate:null},null))},d.options.gatheringTimeout))}y("setLocalDescription()");var d=this;this.pc.setLocalDescription(h,function(){w.call(d)||(y("setLocalDescription() | success"),clearTimeout(d.timerGatheringTimeout),delete d.timerGatheringTimeout,clearTimeout(d.timerGatheringTimeoutAfterRelay),delete d.timerGatheringTimeoutAfterRelay,f(),c&&c())},function(l){w.call(d)||(B("setLocalDescription() | error:",l),i&&i(l))}),this.ignoreIceGathering=!1},g.prototype.setRemoteDescription=function(f,c,h){y("setRemoteDescription()");var d=this;this.pc.setRemoteDescription(f,function(){w.call(d)||(y("setRemoteDescription() | success"),c&&c())},function(i){w.call(d)||(B("setRemoteDescription() | error:",i),h&&h(i))})},g.prototype.updateIce=function(c){y("updateIce() | pcConfig: %o",c),G.call(this,c),this.pc.updateIce(this.pcConfig),this.ignoreIceGathering=!1},g.prototype.addIceCandidate=function(f,c,h){y("addIceCandidate() | candidate: %o",f);var d=this;this.pc.addIceCandidate(f,function(){w.call(d)||(y("addIceCandidate() | success"),c&&c())},function(i){w.call(d)||(B("addIceCandidate() | error:",i),h&&h(i))})},g.prototype.getConfiguration=function(){return y("getConfiguration()"),this.pc.getConfiguration()},g.prototype.getLocalStreams=function(){return y("getLocalStreams()"),this.pc.getLocalStreams()},g.prototype.getRemoteStreams=function(){return y("getRemoteStreams()"),this.pc.getRemoteStreams()},g.prototype.getStreamById=function(c){return y("getStreamById() | streamId: %s",c),this.pc.getStreamById(c)},g.prototype.addStream=function(c){y("addStream() | stream: %s",c),this.pc.addStream(c)},g.prototype.removeStream=function(c){y("removeStream() | stream: %o",c),this.pc.removeStream(c)},g.prototype.close=function(){y("close()"),this.closed=!0,clearTimeout(this.timerGatheringTimeout),delete this.timerGatheringTimeout,clearTimeout(this.timerGatheringTimeoutAfterRelay),delete this.timerGatheringTimeoutAfterRelay,this.pc.close()},g.prototype.createDataChannel=function(){return y("createDataChannel()"),this.pc.createDataChannel.apply(this.pc,arguments)},g.prototype.createDTMFSender=function(c){return y("createDTMFSender()"),this.pc.createDTMFSender(c)},g.prototype.getStats=function(){return y("getStats()"),this.pc.getStats.apply(this.pc,arguments)},g.prototype.setIdentityProvider=function(){return y("setIdentityProvider()"),this.pc.setIdentityProvider.apply(this.pc,arguments)},g.prototype.getIdentityAssertion=function(){return y("getIdentityAssertion()"),this.pc.getIdentityAssertion()},g.prototype.reset=function(d){y("reset() | pcConfig: %o",d);var c=this.pc;c.onnegotiationneeded=null,c.onicecandidate=null,c.onaddstream=null,c.onremovestream=null,c.ondatachannel=null,c.onsignalingstatechange=null,c.oniceconnectionstatechange=null,c.onicegatheringstatechange=null,c.onidentityresult=null,c.onpeeridentity=null,c.onidpassertionerror=null,c.onidpvalidationerror=null,clearTimeout(this.timerGatheringTimeout),delete this.timerGatheringTimeout,clearTimeout(this.timerGatheringTimeoutAfterRelay),delete this.timerGatheringTimeoutAfterRelay,y("reset() | closing current peerConnection"),c.close(),G.call(this,d),k.call(this)}},{"./Adapter":32,debug:29,merge:37}],34:[function(k,v,g){function d(i){var c=q(i||{});return m=!0,d.RTCPeerConnection=p,d.getUserMedia=c.getUserMedia,d.RTCSessionDescription=c.RTCSessionDescription,d.RTCIceCandidate=c.RTCIceCandidate,d.MediaStreamTrack=c.MediaStreamTrack,d.getMediaDevices=c.getMediaDevices,d.attachMediaStream=c.attachMediaStream,d.closeMediaStream=c.closeMediaStream,d.canRenegotiate=c.canRenegotiate,c.hasWebRTC()?(h("WebRTC supported"),!0):(j("WebRTC not supported"),!1)}v.exports=d;var w=k("bowser").browser,h=k("debug")("rtcninja"),j=k("debug")("rtcninja:ERROR"),f=k("./version"),q=k("./Adapter"),p=k("./RTCPeerConnection"),m=!1;j.log=console.warn.bind(console),h("version %s",f),h("detected browser: %s %s [mobile:%s, tablet:%s, android:%s, ios:%s]",w.name,w.version,!!w.mobile,!!w.tablet,!!w.android,!!w.ios),d.hasWebRTC=function(){return m||d(),q.hasWebRTC()},Object.defineProperty(d,"version",{get:function(){return f}}),Object.defineProperty(d,"called",{get:function(){return m}}),d.debug=k("debug"),d.browser=w},{"./Adapter":32,"./RTCPeerConnection":33,"./version":35,bowser:36,debug:29}],35:[function(d,c,f){c.exports=d("../package.json").version},{"../package.json":38}],36:[function(c,e,d){!function(f,g){"undefined"!=typeof e&&e.exports?e.exports.browser=g():"function"==typeof b&&b.amd?b(g):this[f]=g()}("bowser",function(){function g(x){function q(i){var l=x.match(i);return l&&l.length>1&&l[1]||""}function j(i){var l=x.match(i);return l&&l.length>1&&l[2]||""}var C,t=q(/(ipod|iphone|ipad)/i).toLowerCase(),v=/like android/i.test(x),m=!v&&/android/i.test(x),B=q(/edge\/(\d+(\.\d+)?)/i),A=q(/version\/(\d+(\.\d+)?)/i),z=/tablet/i.test(x),w=!z&&/[^-]mobi/i.test(x);/opera|opr/i.test(x)?C={name:"Opera",opera:f,version:A||q(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}:/windows phone/i.test(x)?(C={name:"Windows Phone",windowsphone:f},B?(C.msedge=f,C.version=B):(C.msie=f,C.version=q(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(x)?C={name:"Internet Explorer",msie:f,version:q(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(x)?C={name:"Microsoft Edge",msedge:f,version:B}:/chrome|crios|crmo/i.test(x)?C={name:"Chrome",chrome:f,version:q(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:t?(C={name:"iphone"==t?"iPhone":"ipad"==t?"iPad":"iPod"},A&&(C.version=A)):/sailfish/i.test(x)?C={name:"Sailfish",sailfish:f,version:q(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(x)?C={name:"SeaMonkey",seamonkey:f,version:q(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel/i.test(x)?(C={name:"Firefox",firefox:f,version:q(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(x)&&(C.firefoxos=f)):/silk/i.test(x)?C={name:"Amazon Silk",silk:f,version:q(/silk\/(\d+(\.\d+)?)/i)}:m?C={name:"Android",version:A}:/phantom/i.test(x)?C={name:"PhantomJS",phantom:f,version:q(/phantomjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(x)||/rim\stablet/i.test(x)?C={name:"BlackBerry",blackberry:f,version:A||q(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:/(web|hpw)os/i.test(x)?(C={name:"WebOS",webos:f,version:A||q(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(x)&&(C.touchpad=f)):C=/bada/i.test(x)?{name:"Bada",bada:f,version:q(/dolfin\/(\d+(\.\d+)?)/i)}:/tizen/i.test(x)?{name:"Tizen",tizen:f,version:q(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||A}:/safari/i.test(x)?{name:"Safari",safari:f,version:A}:{name:q(/^(.*)\/(.*) /),version:j(/^(.*)\/(.*) /)},!C.msedge&&/(apple)?webkit/i.test(x)?(C.name=C.name||"Webkit",C.webkit=f,!C.version&&A&&(C.version=A)):!C.opera&&/gecko\//i.test(x)&&(C.name=C.name||"Gecko",C.gecko=f,C.version=C.version||q(/gecko\/(\d+(\.\d+)?)/i)),C.msedge||!m&&!C.silk?t&&(C[t]=f,C.ios=f):C.android=f;var y="";C.windowsphone?y=q(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):t?(y=q(/os (\d+([_\s]\d+)*) like mac os x/i),y=y.replace(/[_\s]/g,".")):m?y=q(/android[ \/-](\d+(\.\d+)*)/i):C.webos?y=q(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):C.blackberry?y=q(/rim\stablet\sos\s(\d+(\.\d+)*)/i):C.bada?y=q(/bada\/(\d+(\.\d+)*)/i):C.tizen&&(y=q(/tizen[\/\s](\d+(\.\d+)*)/i)),y&&(C.osversion=y);var k=y.split(".")[0];return z||"ipad"==t||m&&(3==k||4==k&&!w)||C.silk?C.tablet=f:(w||"iphone"==t||"ipod"==t||m||C.blackberry||C.webos||C.bada)&&(C.mobile=f),C.msedge||C.msie&&C.version>=10||C.chrome&&C.version>=20||C.firefox&&C.version>=20||C.safari&&C.version>=6||C.opera&&C.version>=10||C.ios&&C.osversion&&C.osversion.split(".")[0]>=6||C.blackberry&&C.version>=10.1?C.a=f:C.msie&&C.version<10||C.chrome&&C.version<20||C.firefox&&C.version<20||C.safari&&C.version<6||C.opera&&C.version<10||C.ios&&C.osversion&&C.osversion.split(".")[0]<6?C.c=f:C.x=f,C}var f=!0,h=g("undefined"!=typeof navigator?navigator.userAgent:"");return h.test=function(k){for(var i=0;i<k.length;++i){var j=k[i];if("string"==typeof j&&j in h){return !0}}return !1},h._detect=g,h})},{}],37:[function(d,c,f){!function(m){function o(n,i){if("object"!==j(n)){return i}for(var l in i){n[l]="object"===j(n[l])&&"object"===j(i[l])?o(n[l],i[l]):i[l]}return n}function k(s,z,l){var p=l[0],n=l.length;(s||"object"!==j(p))&&(p={});for(var y=0;n>y;++y){var x=l[y],w=j(x);if("object"===w){for(var q in x){var v=s?g.clone(x[q]):x[q];p[q]=z?o(p[q],v):v}}}return p}function j(i){return{}.toString.call(i).slice(8,-1).toLowerCase()}var g=function(i){return k(i===!0,!1,arguments)},h="merge";g.recursive=function(i){return k(i===!0,!0,arguments)},g.clone=function(s){var p,u,q=s,l=j(s);if("array"===l){for(q=[],u=s.length,p=0;u>p;++p){q[p]=g.clone(s[p])}}else{if("object"===l){q={};for(p in s){q[p]=g.clone(s[p])}}}return q},m?c.exports=g:window[h]=g}("object"==typeof c&&c&&"object"==typeof c.exports&&c.exports)},{}],38:[function(d,c,f){c.exports={name:"rtcninja",version:"0.6.1",description:"WebRTC API wrapper to deal with different browsers",author:{name:"Iaki Baz Castillo",email:"inaki.baz@eface2face.com",url:"http://eface2face.com"},contributors:[{name:"Jess Prez",email:"jesus.perez@eface2face.com"}],license:"MIT",main:"lib/rtcninja.js",homepage:"https://github.com/eface2face/rtcninja.js",repository:{type:"git",url:"https://github.com/eface2face/rtcninja.js.git"},keywords:["webrtc"],engines:{node:">=0.10.32"},dependencies:{bowser:"^0.7.3",debug:"^2.2.0",merge:"^1.2.0"},devDependencies:{browserify:"^10.2.3",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-expect-file":"0.0.7","gulp-filelog":"^0.4.1","gulp-header":"^1.2.2","gulp-jscs":"^1.6.0","gulp-jscs-stylish":"^1.1.0","gulp-jshint":"^1.11.0","gulp-rename":"^1.2.2","gulp-uglify":"^1.2.0","jshint-stylish":"^1.0.2",retire:"^1.1.0",shelljs:"^0.5.0","vinyl-source-stream":"^1.1.0"},readme:'# rtcninja.js <img src="http://www.pubnub.com/blog/wp-content/uploads/2014/01/google-webrtc-logo.png" height="30" width="30">\nWebRTC API wrapper to deal with different browsers transparently, [eventually](http://iswebrtcreadyyet.com/) this library shouldn\'t be needed. We only have to wait until W3C group in charge [finishes the specification](https://tools.ietf.org/wg/rtcweb/) and the different browsers implement it correctly :sweat_smile:.\n\n<img src="http://images4.fanpop.com/image/photos/21800000/browser-fight-google-chrome-21865454-600-531.jpg" height="250" width="250">\n\nSupported environments:\n- [Google Chrome](https://www.google.com/chrome/browser/desktop/index.html) (desktop & mobile)\n- [Google Canary](https://www.google.com/chrome/browser/canary.html) (desktop & mobile)\n- [Mozilla Firefox](https://www.mozilla.org/en-GB/firefox/new) (desktop & mobile)\n- [Firefox Nigthly](https://nightly.mozilla.org/) (desktop & mobile)\n- [Opera](http://www.opera.com/)\n- [Vivaldi](https://vivaldi.com/)\n- [CrossWalk](https://crosswalk-project.org/)\n- [Cordova](cordova.apache.org): iOS support, you only have to use our plugin [following these steps](https://github.com/eface2face/cordova-plugin-iosrtc#usage).\n- [Node-webkit](https://github.com/nwjs/nw.js/)\n\n\n## Installation\n\n### **npm**:\n```bash\n$ npm install rtcninja\n```\n#### Usage\n```javascript\nvar rtcninja = require(\'rtcninja\');\n```\n\n### **bower**:\n```bash\n$ bower install rtcninja\n```\n\n\n## Transpiled library\n\nTake a browserified version of the library from the `dist/` folder:\n\n* `dist/rtcninja-X.Y.Z.js`: The uncompressed version.\n* `dist/rtcninja-X.Y.Z.min.js`: The compressed production-ready version.\n* `dist/rtcninja.js`: A copy of the uncompressed version.\n* `dist/rtcninja.min.js`: A copy of the compressed version.\n\nThey expose the global `window.rtcninja` module.\n\n\n## Usage\n\nIn the [examples](./examples/) folder we provide a complete one.\n\n```javascript\n// Must first call it.\nrtcninja();\n\n// Then check.\nif (rtcninja.hasWebRTC()) {\n    // Do something.\n}\nelse {\n    // Do something.\n}\n```\n\n\n## Documentation\n\nYou can read the full [API documentation](docs/index.md) in the docs folder.\n\n\n## Issues\nhttps://github.com/eface2face/rtcninja.js/issues\n\n\n## Developer guide\n\n- Create a branch with a name including your user and a meaningful word about the fix/feature you\'re going to implement, ie: "jesusprubio/fixstuff"\n- Use [GitHub pull requests](https://help.github.com/articles/using-pull-requests).\n- Conventions:\n - We use [JSHint](http://jshint.com/) and [Crockford\'s Styleguide](http://javascript.crockford.com/code.html).\n - Please run `grunt lint` to be sure your code fits with them.\n\n### Debugging\n\nThe library includes the Node [debug](https://github.com/visionmedia/debug) module. In order to enable debugging:\n\nIn Node set the `DEBUG=rtcninja*` environment variable before running the application, or set it at the top of the script:\n\n```javascript\nprocess.env.DEBUG = \'rtcninja*\';\n```\n\nIn the browser run `rtcninja.debug.enable(\'rtcninja*\');` and reload the page. Note that the debugging settings are stored into the browser LocalStorage. To disable it run `rtcninja.debug.disable(\'rtcninja*\');`.\n\n\n## Copyright & License\n\n* eFace2Face Inc.\n* [MIT](./LICENSE)',readmeFilename:"README.md",gitHead:"8fba936eb9d38e72dd9c2b79b9cc49ebebcef33a",bugs:{url:"https://github.com/eface2face/rtcninja.js/issues"},_id:"rtcninja@0.6.1",scripts:{},_shasum:"4adcdf139d42809db6026138a6f2920fa21b820f",_from:"rtcninja@>=0.6.1 <0.7.0"}},{}],39:[function(f,c,g){var d=c.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-]*)\/(\d*)(?:\s*\/(\S*))?/,names:["payload","codec","rate","encoding"],format:function(h){return h.encoding?"rtpmap:%d %s/%s/%s":"rtpmap:%d %s/%s"}},{push:"fmtp",reg:/^fmtp:(\d*) (\S*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(h){return null!=h.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(h){return null!=h.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["value","uri","config"],format:function(h){return null!=h.config?"extmap:%s %s %s":"extmap:%s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(h){return null!=h.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","generation"],format:function(i){var h="candidate:%s %d %s %d %s %d typ %s";return h+=null!=i.raddr?" raddr %s rport %d":"%v%v",null!=i.generation&&(h+=" generation %d"),h}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*):(.*)/,names:["id","attribute","value"],format:"ssrc:%d %s:%s"},{push:"ssrcGroups",reg:/^ssrc-group:(\w*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{push:"invalid",names:["value"]}]};Object.keys(d).forEach(function(i){var h=d[i];h.forEach(function(j){j.reg||(j.reg=/(.*)/),j.format||(j.format="%s")})})},{}],40:[function(g,c,h){var f=g("./parser"),d=g("./writer");h.write=d,h.parse=f.parse,h.parseFmtpConfig=f.parseFmtpConfig,h.parsePayloads=f.parsePayloads,h.parseRemoteCandidates=f.parseRemoteCandidates},{"./parser":41,"./writer":42}],41:[function(j,m,f){var c=function(i){return String(Number(i))===i?Number(i):i},p=function(r,o,u,q){if(q&&!u){o[q]=c(r[1])}else{for(var i=0;i<u.length;i+=1){null!=r[i+1]&&(o[u[i]]=c(r[i+1]))}}},g=function(s,o,u){var q=s.name&&s.names;s.push&&!o[s.push]?o[s.push]=[]:q&&!o[s.name]&&(o[s.name]={});var i=s.push?{}:q?o[s.name]:o;p(u.match(s.reg),i,s.names,s.name),s.push&&o[s.push].push(i)},h=j("./grammar"),d=RegExp.prototype.test.bind(/^([a-z])=(.*)/);f.parse=function(o){var i={},q=[],l=i;return o.split(/(\r\n|\r|\n)/).filter(d).forEach(function(w){var r=w[0],v=w.slice(2);"m"===r&&(q.push({rtp:[],fmtp:[]}),l=q[q.length-1]);for(var x=0;x<(h[r]||[]).length;x+=1){var n=h[r][x];if(n.reg.test(v)){return g(n,l,v)}}}),i.media=q,i};var k=function(l,i){var o=i.split("=");return 2===o.length&&(l[o[0]]=c(o[1])),l};f.parseFmtpConfig=function(i){return i.split(";").reduce(k,{})},f.parsePayloads=function(i){return i.split(" ").map(Number)},f.parseRemoteCandidates=function(o){for(var i=[],q=o.split(" ").map(c),l=0;l<q.length;l+=3){i.push({component:q[l],ip:q[l+1],port:q[l+2]})}return i}},{"./grammar":39}],42:[function(j,m,f){var c=j("./grammar"),p=/%[sdv%]/g,g=function(o){var i=1,q=arguments,l=q.length;return o.replace(p,function(r){if(i>=l){return r}var n=q[i];switch(i+=1,r){case"%%":return"%";case"%s":return String(n);case"%d":return Number(n);case"%v":return""}})},h=function(w,q,y){var v=q.format instanceof Function?q.format(q.push?y:y[q.name]):q.format,u=[w+"="+v];if(q.names){for(var l=0;l<q.names.length;l+=1){var x=q.names[l];u.push(q.name?y[q.name][x]:y[q.names[l]])}}else{u.push(y[q.name])}return g.apply(null,u)},d=["v","o","s","i","u","e","p","c","b","t","r","z","a"],k=["i","c","b","a"];m.exports=function(r,o){o=o||{},null==r.version&&(r.version=0),null==r.name&&(r.name=" "),r.media.forEach(function(l){null==l.payloads&&(l.payloads="")});var u=o.outerOrder||d,q=o.innerOrder||k,i=[];return u.forEach(function(e){c[e].forEach(function(l){l.name in r&&null!=r[l.name]?i.push(h(e,l,r)):l.push in r&&null!=r[l.push]&&r[l.push].forEach(function(n){i.push(h(e,l,n))})})}),r.media.forEach(function(l){i.push(h("m",c.m[0],l)),q.forEach(function(e){c[e].forEach(function(s){s.name in l&&null!=l[s.name]?i.push(h(e,s,l)):s.push in l&&null!=l[s.push]&&l[s.push].forEach(function(n){i.push(h(e,s,n))})})})}),i.join("\r\n")+"\r\n"}},{"./grammar":39}],43:[function(h,d,i){function g(k,j){var l;return l=j?new c(k,j):new c(k)}var f=function(){return this}(),c=f.WebSocket||f.MozWebSocket;d.exports={w3cwebsocket:c?g:null,version:h("./version")}},{"./version":44}],44:[function(d,c,f){c.exports=d("../package.json").version},{"../package.json":45}],45:[function(d,c,f){c.exports={name:"websocket",description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],author:{name:"Brian McKelvey",email:"brian@worlize.com",url:"https://www.worlize.com/"},version:"1.0.19",repository:{type:"git",url:"git+https://github.com/theturtle32/WebSocket-Node.git"},homepage:"https://github.com/theturtle32/WebSocket-Node",engines:{node:">=0.8.0"},dependencies:{debug:"~2.1.0",nan:"1.8.x","typedarray-to-buffer":"~3.0.0"},devDependencies:{"buffer-equal":"0.0.1",faucet:"0.0.1",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-jshint":"^1.9.0","jshint-stylish":"^1.0.0",tape:"^3.0.0"},config:{verbose:!1},scripts:{install:"(node-gyp rebuild 2> builderror.log) || (exit 0)",test:"faucet test/unit",gulp:"gulp"},main:"index",directories:{lib:"./lib"},browser:"lib/browser.js",license:"Apache-2.0",gitHead:"da3bd5b04e9442c84881b2e9c13432cdbbae1f16",bugs:{url:"https://github.com/theturtle32/WebSocket-Node/issues"},_id:"websocket@1.0.19",_shasum:"e62dbf1a3c5e0767425db7187cfa38f921dfb42c",_from:"websocket@>=1.0.19 <2.0.0",_npmVersion:"2.10.1",_nodeVersion:"0.12.4",_npmUser:{name:"theturtle32",email:"brian@worlize.com"},maintainers:[{name:"theturtle32",email:"brian@worlize.com"}],dist:{shasum:"e62dbf1a3c5e0767425db7187cfa38f921dfb42c",tarball:"http://registry.npmjs.org/websocket/-/websocket-1.0.19.tgz"},_resolved:"https://registry.npmjs.org/websocket/-/websocket-1.0.19.tgz"}},{}],46:[function(d,c,f){c.exports={name:"jssip",title:"JsSIP",description:"the Javascript SIP library",version:"0.6.30",homepage:"http://jssip.net",author:"Jos Luis Milln <jmillan@aliax.net> (https://github.com/jmillan)",contributors:["Iaki Baz Castillo <ibc@aliax.net> (https://github.com/ibc)","Sal Ibarra Corretg <saghul@gmail.com> (https://github.com/saghul)"],main:"lib/JsSIP.js",keywords:["sip","websocket","webrtc","node","browser","library"],license:"MIT",repository:{type:"git",url:"https://github.com/versatica/JsSIP.git"},bugs:{url:"https://github.com/versatica/JsSIP/issues"},dependencies:{debug:"^2.2.0",rtcninja:"^0.6.1","sdp-transform":"~1.4.0",websocket:"^1.0.19"},devDependencies:{browserify:"^10.2.3",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-expect-file":"0.0.7","gulp-filelog":"^0.4.1","gulp-header":"^1.2.2","gulp-jshint":"^1.11.0","gulp-nodeunit-runner":"^0.2.2","gulp-rename":"^1.2.2","gulp-uglify":"^1.2.0","gulp-util":"^3.0.5","jshint-stylish":"^1.0.1",pegjs:"0.7.0","vinyl-source-stream":"^1.1.0"},scripts:{test:"gulp test"}}},{}]},{},[7])(7)});var CubeSIPWorker=Class({host:null,engine:null,localVideo:null,remoteVideo:null,bellAudio:null,localStream:null,remoteStream:null,regListener:null,callListener:null,direction:null,videoEnabled:true,sip:null,rtcSession:null,maxFrameRate:15,minFrameRate:5,iceServersUrls:[{urls:["stun:211.103.217.154:3478"]},{urls:["turn:211.103.217.154:3478"],username:"cube",credential:"cube887"}],localVideoReady:null,remoteVideoReady:null,videoCloseHandler:null,ctor:function(a){this.host=a},start:function(d,a,c,e){this.engine=d;this.localVideo=a;this.remoteVideo=c;this.bellAudio=e;var b=this;b.localVideo.addEventListener("loadeddata",function(f){if(null!=b.localVideoReady){b.localVideoReady.call(null,b.localVideo)}},false);b.remoteVideo.addEventListener("loadeddata",function(f){if(null!=b.remoteVideoReady){b.remoteVideoReady.call(null,b.remoteVideo)}},false)},registerWith:function(d,c,a){if(null!=this.sip){if(this.sip.isRegistered()){return true}}var b=this;var e={ws_servers:"ws://"+b.host+":5066",uri:"sip:"+d+"@"+b.host,password:c,display_name:a,register_expires:610,register:true};this.sip=new JsSIP.UA(e);if(null==this.regListener){this.regListener=new CubeSipRegistrationListener(this.engine)}if(null==this.callListener){this.callListener=new CubeSipCallListener(this.engine)}this.sip.on("connected",function(f){b.regListener.onRegistrationProgress(b.engine.session)});this.sip.on("disconnected",function(f){});this.sip.on("registered",function(f){b.regListener.onRegistrationOk(b.engine.session)});this.sip.on("unregistered",function(f){b.regListener.onRegistrationCleared(b.engine.session)});this.sip.on("registrationFailed",function(f){b.regListener.onRegistrationFailed(b.engine.session)});this.sip.on("newRTCSession",function(f){b.onNewSession(f)});this.sip.start()},unregister:function(){if(null!=this.sip){this.sip.unregister({all:true});this.sip.stop();this.sip=null}this.clear()},invite:function(e,d){if(null==this.sip||(this.engine.session.callState!=CubeSignalingState.None&&this.engine.session.callState!=CubeSignalingState.End)){return false}this.direction=CubeCallDirection.Outgoing;this.videoEnabled=d;var b=this;var f=320;var a=240;var g={mandatory:{maxWidth:f,maxHeight:a,minWidth:160,minHeight:120,maxFrameRate:b.maxFrameRate,minFrameRate:b.minFrameRate}};if(window.utils.isFirefox){g={width:{min:160,max:f},height:{min:120,max:a},frameRate:parseInt(b.maxFrameRate),require:["width","height","frameRate"]}}var c={mediaConstraints:{audio:true,video:d?g:false},pcConfig:{iceServers:b.iceServersUrls,gatheringTimeout:2000},rtcConstraints:{optional:[{DtlsSrtpKeyAgreement:true}]},rtcOfferConstraints:{offerToReceiveAudio:1,offerToReceiveVideo:d?1:0}};this.sip.call("sip:"+e+"@"+this.host,c);return true},answer:function(b){if(null==this.rtcSession){return false}this.videoEnabled=b;if(null!=this.rtcSession){var a={mediaConstraints:{audio:true,video:b},pcConfig:{iceServers:self.iceServersUrls,gatheringTimeout:2000},rtcConstraints:{optional:[{DtlsSrtpKeyAgreement:true}]},rtcOfferConstraints:{offerToReceiveAudio:1,offerToReceiveVideo:b?1:0}};this.rtcSession.answer(a)}return true},hangup:function(){if(null==this.rtcSession){return false}try{this.rtcSession.terminate()}catch(a){}return true},consult:function(){},onNewSession:function(g){var d=g.request;var b=g.session;var c=b.remote_identity.uri.toString();this.rtcSession=b;if(null==this.engine.session.callPeer){var f=new CubePeer(b.remote_identity.uri.user);this.engine.session.setCallPeer(f)}this.engine.session.callPeer.name=b.remote_identity.uri.user;this.engine.session.callPeer.displayName=b.remote_identity.display_name||b.remote_identity.uri.user;if(b.direction==="incoming"){this.direction=CubeCallDirection.Incoming}else{this.direction=CubeCallDirection.Outgoing}var a=this;b.on("connecting",function(h){if(b.connection.getLocalStreams().length>0){a.localStream=b.connection.getLocalStreams()[0];a.attachMediaStream(a.localVideo,a.localStream);a.localVideo.volume=0}if(a.direction==CubeCallDirection.Outgoing){a.callListener.onNewCall(a.direction,a.engine.session,a.videoEnabled)}});b.on("progress",function(h){if(h.originator==="remote"){}});b.on("confirmed",function(h){if(h.originator==="local"){a.callListener.onCallConnected(a.engine.session)}else{a.callListener.onCallConnected(a.engine.session)}});b.on("accepted",function(h){if(b.connection.getLocalStreams().length>0&&null==a.localStream){a.localStream=b.connection.getLocalStreams()[0];a.attachMediaStream(a.localVideo,a.localStream);a.localVideo.volume=0}if(h.originator==="remote"){if(h.response.getHeader("X-Can-Renegotiate")==="false"){b.data.remoteCanRenegotiateRTC=false}else{b.data.remoteCanRenegotiateRTC=true}}if(a.direction==CubeCallDirection.Outgoing){a.callListener.onCallRinging(a.engine.session)}});b.on("addstream",function(h){a.remoteStream=h.stream;a.attachMediaStream(a.remoteVideo,a.remoteStream);a.remoteVideo.volume=1});b.on("failed",function(j){var i=j.cause,h=j.response;if(j.originator==="remote"&&i.match("SIP;cause=200","i")){i="answered_elsewhere"}console.log("Failed: "+i);if(i==JsSIP.C.causes.BYE||i==JsSIP.C.causes.CANCELED){a.callListener.onCallEnded(a.engine.session)}a.clear()});b.on("newDTMF",function(h){if(h.originator==="remote"){}});b.on("ended",function(i){var h=i.cause;a.clear();a.callListener.onCallEnded(a.engine.session)});if(a.direction==CubeCallDirection.Incoming){a.callListener.onNewCall(a.direction,a.engine.session,a.videoEnabled)}},attachMediaStream:function(a,b){if(window.URL){a.src=window.URL.createObjectURL(b)}else{a.src=b}a.onloadedmetadata=function(c){a.play()}},clear:function(){if(null!=this.localStream){this.localStream.stop();this.localStream=null}if(null!=this.remoteStream){try{this.remoteStream.getAudioTracks()[0].stop();this.remoteStream.getVideoTracks()[0].stop()}catch(a){Logger.w("SIPWorker#clear",a.message)}this.remoteStream=null}this.localVideo.src="";this.remoteVideo.src="";this.rtcSession=null;if(null!=this.videoCloseHandler){this.videoCloseHandler.call(null,this)}}});var CubeSipCallListener=Class(CubeCallListener,{engine:null,ctor:function(a){this.engine=a},onNewCall:function(c,b,a){Logger.d("CallListener","onNewCall");b.callDirection=c;b.callState=CubeSignalingState.Invite;if(null!=this.engine.callListener){this.engine.callListener.onNewCall(c,b,a)}this.engine.sipWorker.localVideo.style.visibility="visible"},onInProgress:function(a){Logger.d("CallListener","onInProgress");a.callState=CubeSignalingState.Progress;if(null!=this.engine.callListener){this.engine.callListener.onInProgress(a)}},onCallRinging:function(a){Logger.d("CallListener","onCallRinging");a.callState=CubeSignalingState.Ringing;if(null!=this.engine.callListener){this.engine.callListener.onCallRinging(a)}},onCallConnected:function(b){Logger.d("CallListener","onCallConnected");b.callState=CubeSignalingState.Incall;if(null!=this.engine.callListener){this.engine.callListener.onCallConnected(b)}this.engine.sipWorker.remoteVideo.style.visibility="visible";var a=this.engine.cua();if(null!=a&&b.callPeer.name.length<=4){a.notifyJoin(b.callPeer.name,b.name)}},onCallEnded:function(a){Logger.d("CallListener","onCallEnded");a.callState=CubeSignalingState.End;this.engine.sipWorker.localVideo.style.visibility="hidden";this.engine.sipWorker.remoteVideo.style.visibility="hidden";if(null!=this.engine.callListener){this.engine.callListener.onCallEnded(a)}},onCallFailed:function(b,a){Logger.d("CallListener","onCallFailed");this.engine.sipWorker.localVideo.style.visibility="hidden";this.engine.sipWorker.remoteVideo.style.visibility="hidden";if(null!=this.engine.callListener){this.engine.callListener.onCallFailed(b,a)}b.callState=CubeSignalingState.None}});var CubeSipRegistrationListener=Class(CubeRegistrationListener,{engine:null,ctor:function(a){this.engine=a},onRegistrationProgress:function(a){Logger.d("SipRegistrationListener","onRegistrationProgress");a.regState=CubeRegistrationState.Progress;if(null!=this.engine.regListener&&null==this.engine.sspWorker){this.engine.regListener.onRegistrationProgress(a)}},onRegistrationOk:function(a){Logger.d("SipRegistrationListener","onRegistrationOk");a.regState=CubeRegistrationState.Ok;if(null!=this.engine.regListener&&null==this.engine.sspWorker){this.engine.regListener.onRegistrationOk(a)}},onRegistrationCleared:function(a){Logger.d("SipRegistrationListener","onRegistrationCleared");a.regState=CubeRegistrationState.Cleared;if(null!=this.engine.regListener&&null==this.engine.sspWorker){this.engine.regListener.onRegistrationCleared(a)}a.regState=CubeRegistrationState.None},onRegistrationFailed:function(a){Logger.d("SipRegistrationListener","onRegistrationFailed");a.regState=CubeRegistrationState.Failed;if(null!=this.engine.regListener&&null==this.engine.sspWorker){this.engine.regListener.onRegistrationFailed(a)}}});